# Set seed for reproducibility ----

set.seed(...)

# Packages ----

library(rms)
library(riskRegression)
library(cmprsk)
library(prodlim)
library(survival)
library(ggplot2)

# Data ----

SET_2015 <- read.csv(...)
SET_2016 <- read.csv(...)

GWB_CODE_2021_WEALTH_2014 <- read.csv(...)
GWB_CODE_2021_WEALTH_2015 <- read.csv(...)
GWB_CODE_2021_EDUCATION_2014 <- read.csv(...)
GWB_CODE_2021_EDUCATION_2015 <- read.csv(...)
GWB_CODE_2021_WEALTH_2014_EDUCATION_2014 <- merge(GWB_CODE_2021_WEALTH_2014,
                                                  GWB_CODE_2021_EDUCATION_2014,
                                                  by = "GWB_CODE_2021")
GWB_CODE_2021_WEALTH_2015_EDUCATION_2015 <- merge(GWB_CODE_2021_WEALTH_2015,
                                                  GWB_CODE_2021_EDUCATION_2015,
                                                  by = "GWB_CODE_2021")

# Creating DATA_E_MALE and DATA_E_FEMALE for development, and DATA_E_MALE and DATA_E_FEMALE for evaluation ----

SET_2015_SET_2016_UNION_RINPERSOON <- union(SET_2015$RINPERSOON, 
                                            SET_2016$RINPERSOON)
SET_2015_SET_2016_UNION_RINPERSOON <- cbind(SET_2015_SET_2016_UNION_RINPERSOON,
                                            sample(c("D", "E"),
                                                   size = length(SET_2015_SET_2016_UNION_RINPERSOON),
                                                   replace = TRUE,
                                                   prob = c(0.5, 0.5)))
SET_2015_SET_2016_UNION_RINPERSOON <- as.data.frame(SET_2015_SET_2016_UNION_RINPERSOON)
colnames(SET_2015_SET_2016_UNION_RINPERSOON) <- c("RINPERSOON",
                                                  "D_E")

SET_2015_UNIQUE_RINPERSOON <- subset(SET_2015, !c(RINPERSOON %in% SET_2016$RINPERSOON))$RINPERSOON
SET_2015_UNIQUE_RINPERSOON <- cbind(SET_2015_UNIQUE_RINPERSOON,
                                    sample(c("D", "E"),
                                           size = length(SET_2015_UNIQUE_RINPERSOON),
                                           replace = TRUE,
                                           prob = c(0.5, 0.5)))
SET_2015_UNIQUE_RINPERSOON <- as.data.frame(SET_2015_UNIQUE_RINPERSOON)
colnames(SET_2015_UNIQUE_RINPERSOON) <- c("RINPERSOON",
                                          "D_E")

SET_2016_UNIQUE_RINPERSOON <- subset(SET_2016, !c(RINPERSOON %in% SET_2015$RINPERSOON))$RINPERSOON
SET_2016_UNIQUE_RINPERSOON <- cbind(SET_2016_UNIQUE_RINPERSOON,
                                    sample(c("D", "E"),
                                           size = length(SET_2016_UNIQUE_RINPERSOON),
                                           replace = TRUE,
                                           prob = c(0.5, 0.5)))
SET_2016_UNIQUE_RINPERSOON <- as.data.frame(SET_2016_UNIQUE_RINPERSOON)
colnames(SET_2016_UNIQUE_RINPERSOON) <- c("RINPERSOON",
                                          "D_E")

DATA_D <- subset(SET_2015, (RINPERSOON %in% subset(SET_2015_SET_2016_UNION_RINPERSOON, D_E == "D")$RINPERSOON)
                           |
                           (RINPERSOON %in% subset(SET_2015_UNIQUE_RINPERSOON, D_E == "D")$RINPERSOON))
DATA_D_MALE <- subset(DATA_D, MALE == 1)
DATA_D_FEMALE <- subset(DATA_D, MALE == 0)

DATA_E <- subset(SET_2016, (RINPERSOON %in% subset(SET_2015_SET_2016_UNION_RINPERSOON, D_E == "E")$RINPERSOON)
                           |
                           (RINPERSOON %in% subset(SET_2016_UNIQUE_RINPERSOON, D_E == "E")$RINPERSOON))
DATA_E_MALE <- subset(DATA_E, MALE == 1)
DATA_E_FEMALE <- subset(DATA_E, MALE == 0)

# Variables ----

## DATA_D_MALE ----

nrow(DATA_D_MALE)

table(DATA_D_MALE$EVENT)
prop.table(table(DATA_D_MALE$EVENT))

summary(DATA_D_MALE$TIME)
sd(DATA_D_MALE$TIME)

table(subset(DATA_D_MALE, TIME < 4)$EVENT)
prop.table(table(subset(DATA_D_MALE, TIME < 4)$EVENT))

DATA_D_MALE_AJ <- cuminc(ftime = DATA_D_MALE$TIME,
                         fstatus = DATA_D_MALE$EVENT,
                         cencode = 0)
DATA_D_MALE_AJ
plot(DATA_D_MALE_AJ)

summary(DATA_D_MALE$AGE)
sd(DATA_D_MALE$AGE)
DATA_D_MALE$AGE_STD <- (DATA_D_MALE$AGE - mean(DATA_D_MALE$AGE)) / sd(DATA_D_MALE$AGE)

summary(DATA_D_MALE$WEALTH_2014_IMP)
sd(DATA_D_MALE$WEALTH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$WEALTH_2014))
prop.table(table(is.na(DATA_D_MALE$WEALTH_2014)))
DATA_D_MALE$WEALTH_2014_IMP_STD <- (DATA_D_MALE$WEALTH_2014_IMP - mean(DATA_D_MALE$WEALTH_2014_IMP)) / sd(DATA_D_MALE$WEALTH_2014_IMP)

summary(DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP)
sd(DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$EDUCATION_LOW_2014))
prop.table(table(is.na(DATA_D_MALE$EDUCATION_LOW_2014)))
DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP_STD <- (DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP - mean(DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP)) / sd(DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP)

summary(DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)
sd(DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014))
prop.table(table(is.na(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014)))
DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP_STD <- (DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP - mean(DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP)
sd(DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$EDUCATION_HIGH_2014))
prop.table(table(is.na(DATA_D_MALE$EDUCATION_HIGH_2014)))
DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP_STD <- (DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP - mean(DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP)

summary(DATA_D_MALE$PC_PM25_2014)
sd(DATA_D_MALE$PC_PM25_2014)
DATA_D_MALE$PC_PM25_2014_STD <- (DATA_D_MALE$PC_PM25_2014 - mean(DATA_D_MALE$PC_PM25_2014)) / sd(DATA_D_MALE$PC_PM25_2014)

## DATA_D_FEMALE ----

nrow(DATA_D_FEMALE)

table(DATA_D_FEMALE$EVENT)
prop.table(table(DATA_D_FEMALE$EVENT))

summary(DATA_D_FEMALE$TIME)
sd(DATA_D_FEMALE$TIME)

table(subset(DATA_D_FEMALE, TIME < 4)$EVENT)
prop.table(table(subset(DATA_D_FEMALE, TIME < 4)$EVENT))

DATA_D_FEMALE_AJ <- cuminc(ftime = DATA_D_FEMALE$TIME,
                           fstatus = DATA_D_FEMALE$EVENT,
                           cencode = 0)
DATA_D_FEMALE_AJ
plot(DATA_D_FEMALE_AJ)

summary(DATA_D_FEMALE$TIME)
sd(DATA_D_FEMALE$TIME)

summary(DATA_D_FEMALE$AGE)
sd(DATA_D_FEMALE$AGE)
DATA_D_FEMALE$AGE_STD <- (DATA_D_FEMALE$AGE - mean(DATA_D_FEMALE$AGE)) / sd(DATA_D_FEMALE$AGE)

summary(DATA_D_FEMALE$WEALTH_2014_IMP)
sd(DATA_D_FEMALE$WEALTH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$WEALTH_2014))
prop.table(table(is.na(DATA_D_FEMALE$WEALTH_2014)))
DATA_D_FEMALE$WEALTH_2014_IMP_STD <- (DATA_D_FEMALE$WEALTH_2014_IMP - mean(DATA_D_FEMALE$WEALTH_2014_IMP)) / sd(DATA_D_FEMALE$WEALTH_2014_IMP)

summary(DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP)
sd(DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$EDUCATION_LOW_2014))
prop.table(table(is.na(DATA_D_FEMALE$EDUCATION_LOW_2014)))
DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP_STD <- (DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP - mean(DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP)) / sd(DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP)

summary(DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)
sd(DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014))
prop.table(table(is.na(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014)))
DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP_STD <- (DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP - mean(DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP)
sd(DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$EDUCATION_HIGH_2014))
prop.table(table(is.na(DATA_D_FEMALE$EDUCATION_HIGH_2014)))
DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP_STD <- (DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP - mean(DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP)

summary(DATA_D_FEMALE$PM25_2014)
sd(DATA_D_FEMALE$PM25_2014)
DATA_D_FEMALE$PM25_2014_STD <- (DATA_D_FEMALE$PM25_2014 - mean(DATA_D_FEMALE$PM25_2014)) / sd(DATA_D_FEMALE$PM25_2014)

summary(DATA_D_FEMALE$PC_PM25_2014)
sd(DATA_D_FEMALE$PC_PM25_2014)
DATA_D_FEMALE$PC_PM25_2014_STD <- (DATA_D_FEMALE$PC_PM25_2014 - mean(DATA_D_FEMALE$PC_PM25_2014)) / sd(DATA_D_FEMALE$PC_PM25_2014)

## DATA_E_MALE ----

nrow(DATA_E_MALE)

table(DATA_E_MALE$EVENT)
prop.table(table(DATA_E_MALE$EVENT))

summary(DATA_E_MALE$TIME)
sd(DATA_E_MALE$TIME)

table(subset(DATA_E_MALE, TIME < 4)$EVENT)
prop.table(table(subset(DATA_E_MALE, TIME < 4)$EVENT))

DATA_E_MALE_AJ <- cuminc(ftime = DATA_E_MALE$TIME,
                         fstatus = DATA_E_MALE$EVENT,
                         cencode = 0)
DATA_E_MALE_AJ
plot(DATA_E_MALE_AJ)

summary(DATA_E_MALE$AGE)
sd(DATA_E_MALE$AGE)
DATA_E_MALE$AGE_STD <- (DATA_E_MALE$AGE - mean(DATA_D_MALE$AGE)) / sd(DATA_D_MALE$AGE)

summary(DATA_E_MALE$WEALTH_2015_IMP)
sd(DATA_E_MALE$WEALTH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_MALE$WEALTH_2015))
prop.table(table(is.na(DATA_E_MALE$WEALTH_2015)))
DATA_E_MALE$WEALTH_2015_IMP_STD <- (DATA_E_MALE$WEALTH_2015_IMP - mean(DATA_D_MALE$WEALTH_2014_IMP)) / sd(DATA_D_MALE$WEALTH_2014_IMP)

summary(DATA_E_MALE$PC_EDUCATION_LOW_2015_IMP)
sd(DATA_E_MALE$PC_EDUCATION_LOW_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_MALE$EDUCATION_LOW_2015))
prop.table(table(is.na(DATA_E_MALE$EDUCATION_LOW_2015)))
DATA_E_MALE$PC_EDUCATION_LOW_2015_IMP_STD <- (DATA_E_MALE$PC_EDUCATION_LOW_2015_IMP - mean(DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP)) / sd(DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP)

summary(DATA_E_MALE$PC_EDUCATION_INTERMEDIATE_2015_IMP)
sd(DATA_E_MALE$PC_EDUCATION_INTERMEDIATE_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_MALE$EDUCATION_INTERMEDIATE_2015))
prop.table(table(is.na(DATA_E_MALE$EDUCATION_INTERMEDIATE_2015)))
DATA_E_MALE$PC_EDUCATION_INTERMEDIATE_2015_IMP_STD <- (DATA_E_MALE$PC_EDUCATION_INTERMEDIATE_2015_IMP - mean(DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_E_MALE$PC_EDUCATION_HIGH_2015_IMP)
sd(DATA_E_MALE$PC_EDUCATION_HIGH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_MALE$EDUCATION_HIGH_2015))
prop.table(table(is.na(DATA_E_MALE$EDUCATION_HIGH_2015)))
DATA_E_MALE$PC_EDUCATION_HIGH_2015_IMP_STD <- (DATA_E_MALE$PC_EDUCATION_HIGH_2015_IMP - mean(DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP)

summary(DATA_E_MALE$PC_PM25_2015)
sd(DATA_E_MALE$PC_PM25_2015)
DATA_E_MALE$PC_PM25_2015_STD <- (DATA_E_MALE$PC_PM25_2015 - mean(DATA_E_MALE$PC_PM25_2015)) / sd(DATA_E_MALE$PC_PM25_2015)

## DATA_E_FEMALE ----

nrow(DATA_E_FEMALE)

table(DATA_E_FEMALE$EVENT)
prop.table(table(DATA_E_FEMALE$EVENT))

summary(DATA_E_FEMALE$TIME)
sd(DATA_E_FEMALE$TIME)

table(subset(DATA_E_FEMALE, TIME < 4)$EVENT)
prop.table(table(subset(DATA_E_FEMALE, TIME < 4)$EVENT))

DATA_E_FEMALE_AJ <- cuminc(ftime = DATA_E_FEMALE$TIME,
                           fstatus = DATA_E_FEMALE$EVENT,
                           cencode = 0)
DATA_E_FEMALE_AJ
plot(DATA_E_FEMALE_AJ)

summary(DATA_E_FEMALE$AGE)
sd(DATA_E_FEMALE$AGE)
DATA_E_FEMALE$AGE_STD <- (DATA_E_FEMALE$AGE - mean(DATA_D_FEMALE$AGE)) / sd(DATA_D_FEMALE$AGE)

summary(DATA_E_FEMALE$WEALTH_2015_IMP)
sd(DATA_E_FEMALE$WEALTH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_FEMALE$WEALTH_2015))
prop.table(table(is.na(DATA_E_FEMALE$WEALTH_2015)))
DATA_E_FEMALE$WEALTH_2015_IMP_STD <- (DATA_E_FEMALE$WEALTH_2015_IMP - mean(DATA_D_FEMALE$WEALTH_2014_IMP)) / sd(DATA_D_FEMALE$WEALTH_2014_IMP)

summary(DATA_E_FEMALE$PC_EDUCATION_LOW_2015_IMP)
sd(DATA_E_FEMALE$PC_EDUCATION_LOW_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_FEMALE$EDUCATION_LOW_2015))
prop.table(table(is.na(DATA_E_FEMALE$EDUCATION_LOW_2015)))
DATA_E_FEMALE$PC_EDUCATION_LOW_2015_IMP_STD <- (DATA_E_FEMALE$PC_EDUCATION_LOW_2015_IMP - mean(DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP)) / sd(DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP)

summary(DATA_E_FEMALE$PC_EDUCATION_INTERMEDIATE_2015_IMP)
sd(DATA_E_FEMALE$PC_EDUCATION_INTERMEDIATE_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_FEMALE$EDUCATION_INTERMEDIATE_2015))
prop.table(table(is.na(DATA_E_FEMALE$EDUCATION_INTERMEDIATE_2015)))
DATA_E_FEMALE$PC_EDUCATION_INTERMEDIATE_2015_IMP_STD <- (DATA_E_FEMALE$PC_EDUCATION_INTERMEDIATE_2015_IMP - mean(DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_E_FEMALE$PC_EDUCATION_HIGH_2015_IMP)
sd(DATA_E_FEMALE$PC_EDUCATION_HIGH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_E_FEMALE$EDUCATION_HIGH_2015))
prop.table(table(is.na(DATA_E_FEMALE$EDUCATION_HIGH_2015)))
DATA_E_FEMALE$PC_EDUCATION_HIGH_2015_IMP_STD <- (DATA_E_FEMALE$PC_EDUCATION_HIGH_2015_IMP - mean(DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP)

summary(DATA_E_FEMALE$PC_PM25_2015)
sd(DATA_E_FEMALE$PC_PM25_2015)
DATA_E_FEMALE$PC_PM25_2015_STD <- (DATA_E_FEMALE$PC_PM25_2015 - mean(DATA_E_FEMALE$PC_PM25_2015)) / sd(DATA_E_FEMALE$PC_PM25_2015)

# Dimensionality reduction ----

## DATA_D_MALE ----

cor(DATA_D_MALE[, c("AGE_STD",
                    "WEALTH_2014_IMP_STD",
                    "PC_EDUCATION_LOW_2014_IMP_STD",
                    "PC_EDUCATION_INTERMEDIATE_2014_IMP_STD",
                    "PC_EDUCATION_HIGH_2014_IMP_STD",
                    "PC_PM25_2014_STD")])

DATA_D_MALE_PCA <- princomp(cor(DATA_D_MALE[, c("WEALTH_2014_IMP_STD",
                                                "PC_EDUCATION_LOW_2014_IMP_STD",
                                                "PC_EDUCATION_INTERMEDIATE_2014_IMP_STD",
                                                "PC_EDUCATION_HIGH_2014_IMP_STD")]))
summary(DATA_D_MALE_PCA)

DATA_D_MALE_PCA$loadings

DATA_D_MALE$SES_2014 <- DATA_D_MALE_PCA[["loadings"]][[1]] * DATA_D_MALE$WEALTH_2014_IMP_STD + 
                        DATA_D_MALE_PCA[["loadings"]][[2]] * DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[3]] * DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[4]] * DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP_STD 

summary(DATA_D_MALE$SES_2014)
sd(DATA_D_MALE$SES_2014)

## DATA_D_FEMALE ----

cor(DATA_D_FEMALE[, c("AGE_STD",
                      "WEALTH_2014_IMP_STD",
                      "PC_EDUCATION_LOW_2014_IMP_STD",
                      "PC_EDUCATION_INTERMEDIATE_2014_IMP_STD",
                      "PC_EDUCATION_HIGH_2014_IMP_STD",
                      "PC_PM25_2014_STD")])

DATA_D_FEMALE_PCA <- princomp(cor(DATA_D_FEMALE[, c("WEALTH_2014_IMP_STD",
                                                    "PC_EDUCATION_LOW_2014_IMP_STD",
                                                    "PC_EDUCATION_INTERMEDIATE_2014_IMP_STD",
                                                    "PC_EDUCATION_HIGH_2014_IMP_STD")]))
summary(DATA_D_FEMALE_PCA)

DATA_D_FEMALE_PCA$loadings

DATA_D_FEMALE$SES_2014 <- DATA_D_FEMALE_PCA[["loadings"]][[1]] * DATA_D_FEMALE$WEALTH_2014_IMP_STD + 
                          DATA_D_FEMALE_PCA[["loadings"]][[2]] * DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[3]] * DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[4]] * DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP_STD

summary(DATA_D_FEMALE$SES_2014)
sd(DATA_D_FEMALE$SES_2014)

## DATA_E_MALE ----

DATA_E_MALE$SES_2015 <- DATA_D_MALE_PCA[["loadings"]][[1]] * DATA_E_MALE$WEALTH_2015_IMP_STD + 
                        DATA_D_MALE_PCA[["loadings"]][[2]] * DATA_E_MALE$PC_EDUCATION_LOW_2015_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[3]] * DATA_E_MALE$PC_EDUCATION_INTERMEDIATE_2015_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[4]] * DATA_E_MALE$PC_EDUCATION_HIGH_2015_IMP_STD  

## DATA_E_FEMALE ----

DATA_E_FEMALE$SES_2015 <- DATA_D_FEMALE_PCA[["loadings"]][[1]] * DATA_E_FEMALE$WEALTH_2015_IMP_STD + 
                          DATA_D_FEMALE_PCA[["loadings"]][[2]] * DATA_E_FEMALE$PC_EDUCATION_LOW_2015_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[3]] * DATA_E_FEMALE$PC_EDUCATION_INTERMEDIATE_2015_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[4]] * DATA_E_FEMALE$PC_EDUCATION_HIGH_2015_IMP_STD  

## GWB_CODE_2021_SES_MALE_2014 ----

GWB_CODE_2021_SES_MALE_2014 <- GWB_CODE_2021_WEALTH_2014_EDUCATION_2014
GWB_CODE_2021_SES_MALE_2014$SES_MALE_2014 <- DATA_D_MALE_PCA[["loadings"]][[1]] * ((GWB_CODE_2021_SES_MALE_2014$WEALTH_2014_IMP - 48.05) / 10.72) + 
                                             DATA_D_MALE_PCA[["loadings"]][[2]] * ((GWB_CODE_2021_SES_MALE_2014$PC_EDUCATION_LOW_2014_IMP - 28.17) / 7.52) +
                                             DATA_D_MALE_PCA[["loadings"]][[3]] * ((GWB_CODE_2021_SES_MALE_2014$PC_EDUCATION_INTERMEDIATE_2014_IMP - 41.93) / 4.10) +
                                             DATA_D_MALE_PCA[["loadings"]][[4]] * ((GWB_CODE_2021_SES_MALE_2014$PC_EDUCATION_HIGH_2014_IMP - 29.90) / 9.36)
GWB_CODE_2021_SES_MALE_2014 <- GWB_CODE_2021_SES_MALE_2014[, c("GWB_CODE_2021",
                                                               "SES_MALE_2014")]

write.csv(...)

## GWB_CODE_2021_SES_FEMALE_2014 ----

GWB_CODE_2021_SES_FEMALE_2014 <- GWB_CODE_2021_WEALTH_2014_EDUCATION_2014
GWB_CODE_2021_SES_FEMALE_2014$SES_FEMALE_2014 <- DATA_D_FEMALE_PCA[["loadings"]][[1]] * ((GWB_CODE_2021_SES_FEMALE_2014$WEALTH_2014_IMP - 48.07) / 10.78) + 
                                                 DATA_D_FEMALE_PCA[["loadings"]][[2]] * ((GWB_CODE_2021_SES_FEMALE_2014$PC_EDUCATION_LOW_2014_IMP - 28.21) / 7.57) +
                                                 DATA_D_FEMALE_PCA[["loadings"]][[3]] * ((GWB_CODE_2021_SES_FEMALE_2014$PC_EDUCATION_INTERMEDIATE_2014_IMP - 41.86) / 4.09) +
                                                 DATA_D_FEMALE_PCA[["loadings"]][[4]] * ((GWB_CODE_2021_SES_FEMALE_2014$PC_EDUCATION_HIGH_2014_IMP - 29.93) / 9.43)
GWB_CODE_2021_SES_FEMALE_2014 <- GWB_CODE_2021_SES_FEMALE_2014[, c("GWB_CODE_2021",
                                                                   "SES_FEMALE_2014")]

write.csv(...)

# Non-linear terms ----

## DATA_D_MALE ---- 

DATA_D_MALE_AGE_STD_T1 <- quantile(DATA_D_MALE$AGE_STD, 0.050)[[1]]
DATA_D_MALE_AGE_STD_T2 <- quantile(DATA_D_MALE$AGE_STD, 0.275)[[1]]
DATA_D_MALE_AGE_STD_T3 <- quantile(DATA_D_MALE$AGE_STD, 0.500)[[1]]
DATA_D_MALE_AGE_STD_T4 <- quantile(DATA_D_MALE$AGE_STD, 0.725)[[1]]
DATA_D_MALE_AGE_STD_T5 <- quantile(DATA_D_MALE$AGE_STD, 0.950)[[1]]

DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T1) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T2) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T3) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T4) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T5) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3)

DATA_D_MALE_AGE_STD_TAU <- (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) ** 2

DATA_D_MALE$AGE_STD_RCS5K_1 <- DATA_D_MALE$AGE_STD / DATA_D_MALE_AGE_STD_TAU
DATA_D_MALE$AGE_STD_RCS5K_2 <- (DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 - DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_D_MALE_AGE_STD_TAU
DATA_D_MALE$AGE_STD_RCS5K_3 <- (DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 - DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_D_MALE_AGE_STD_TAU
DATA_D_MALE$AGE_STD_RCS5K_4 <- (DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 - DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_D_MALE_AGE_STD_TAU

head(DATA_D_MALE[, c("AGE_STD",
                     "AGE_STD_RCS5K_1",
                     "AGE_STD_RCS5K_2",
                     "AGE_STD_RCS5K_3",
                     "AGE_STD_RCS5K_4")])
head(rcs(DATA_D_MALE$AGE_STD, 5))

DATA_D_MALE_SES_2014_T1 <- quantile(DATA_D_MALE$SES_2014, 0.050)[[1]]
DATA_D_MALE_SES_2014_T2 <- quantile(DATA_D_MALE$SES_2014, 0.275)[[1]]
DATA_D_MALE_SES_2014_T3 <- quantile(DATA_D_MALE$SES_2014, 0.500)[[1]]
DATA_D_MALE_SES_2014_T4 <- quantile(DATA_D_MALE$SES_2014, 0.725)[[1]]
DATA_D_MALE_SES_2014_T5 <- quantile(DATA_D_MALE$SES_2014, 0.950)[[1]]

DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T1) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T2) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T3) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T4) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T5) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3)

DATA_D_MALE_SES_2014_TAU <- (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) ** 2

DATA_D_MALE$SES_2014_RCS5K_1 <- DATA_D_MALE$SES_2014 / DATA_D_MALE_SES_2014_TAU
DATA_D_MALE$SES_2014_RCS5K_2 <- (DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 - DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_D_MALE_SES_2014_TAU
DATA_D_MALE$SES_2014_RCS5K_3 <- (DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 - DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_D_MALE_SES_2014_TAU
DATA_D_MALE$SES_2014_RCS5K_4 <- (DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 - DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_D_MALE_SES_2014_TAU

head(DATA_D_MALE[, c("SES_2014",
                     "SES_2014_RCS5K_1",
                     "SES_2014_RCS5K_2",
                     "SES_2014_RCS5K_3",
                     "SES_2014_RCS5K_4")])
head(rcs(DATA_D_MALE$SES_2014, 5))

DATA_D_MALE_PC_PM25_2014_STD_T1 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.050)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T2 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.275)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T3 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.500)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T4 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.725)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T5 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.950)[[1]]

DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T2) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T3) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T4) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T5) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3)

DATA_D_MALE_PC_PM25_2014_STD_TAU <- (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 2

DATA_D_MALE$PC_PM25_2014_STD_RCS5K_1 <- DATA_D_MALE$PC_PM25_2014_STD / DATA_D_MALE_PC_PM25_2014_STD_TAU
DATA_D_MALE$PC_PM25_2014_STD_RCS5K_2 <- (DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 - DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_D_MALE_PC_PM25_2014_STD_TAU
DATA_D_MALE$PC_PM25_2014_STD_RCS5K_3 <- (DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 - DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_D_MALE_PC_PM25_2014_STD_TAU
DATA_D_MALE$PC_PM25_2014_STD_RCS5K_4 <- (DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 - DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_D_MALE_PC_PM25_2014_STD_TAU

head(DATA_D_MALE[, c("PC_PM25_2014_STD",
                     "PC_PM25_2014_STD_RCS5K_1",
                     "PC_PM25_2014_STD_RCS5K_2",
                     "PC_PM25_2014_STD_RCS5K_3",
                     "PC_PM25_2014_STD_RCS5K_4")])
head(rcs(DATA_D_MALE$PC_PM25_2014_STD, 5))

write.csv(...)

## DATA_D_FEMALE ----

DATA_D_FEMALE_AGE_STD_T1 <- quantile(DATA_D_FEMALE$AGE_STD, 0.050)[[1]]
DATA_D_FEMALE_AGE_STD_T2 <- quantile(DATA_D_FEMALE$AGE_STD, 0.275)[[1]]
DATA_D_FEMALE_AGE_STD_T3 <- quantile(DATA_D_FEMALE$AGE_STD, 0.500)[[1]]
DATA_D_FEMALE_AGE_STD_T4 <- quantile(DATA_D_FEMALE$AGE_STD, 0.725)[[1]]
DATA_D_FEMALE_AGE_STD_T5 <- quantile(DATA_D_FEMALE$AGE_STD, 0.950)[[1]]

DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T1) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T2) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T3) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T4) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T5) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3)

DATA_D_FEMALE_AGE_STD_TAU <- (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) ** 2

DATA_D_FEMALE$AGE_STD_RCS5K_1 <- DATA_D_FEMALE$AGE_STD / DATA_D_FEMALE_AGE_STD_TAU
DATA_D_FEMALE$AGE_STD_RCS5K_2 <- (DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 - DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_D_FEMALE_AGE_STD_TAU
DATA_D_FEMALE$AGE_STD_RCS5K_3 <- (DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 - DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_D_FEMALE_AGE_STD_TAU
DATA_D_FEMALE$AGE_STD_RCS5K_4 <- (DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 - DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_D_FEMALE_AGE_STD_TAU

head(DATA_D_FEMALE[, c("AGE_STD",
                       "AGE_STD_RCS5K_1",
                       "AGE_STD_RCS5K_2",
                       "AGE_STD_RCS5K_3",
                       "AGE_STD_RCS5K_4")])
head(rcs(DATA_D_FEMALE$AGE_STD, 5))

DATA_D_FEMALE_SES_2014_T1 <- quantile(DATA_D_FEMALE$SES_2014, 0.050)[[1]]
DATA_D_FEMALE_SES_2014_T2 <- quantile(DATA_D_FEMALE$SES_2014, 0.275)[[1]]
DATA_D_FEMALE_SES_2014_T3 <- quantile(DATA_D_FEMALE$SES_2014, 0.500)[[1]]
DATA_D_FEMALE_SES_2014_T4 <- quantile(DATA_D_FEMALE$SES_2014, 0.725)[[1]]
DATA_D_FEMALE_SES_2014_T5 <- quantile(DATA_D_FEMALE$SES_2014, 0.950)[[1]]

DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T1) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T2) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T3) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T4) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T5) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3)

DATA_D_FEMALE_SES_2014_TAU <- (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) ** 2

DATA_D_FEMALE$SES_2014_RCS5K_1 <- DATA_D_FEMALE$SES_2014 / DATA_D_FEMALE_SES_2014_TAU
DATA_D_FEMALE$SES_2014_RCS5K_2 <- (DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 - DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_D_FEMALE_SES_2014_TAU
DATA_D_FEMALE$SES_2014_RCS5K_3 <- (DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 - DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_D_FEMALE_SES_2014_TAU
DATA_D_FEMALE$SES_2014_RCS5K_4 <- (DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 - DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_D_FEMALE_SES_2014_TAU

head(DATA_D_FEMALE[, c("SES_2014",
                       "SES_2014_RCS5K_1",
                       "SES_2014_RCS5K_2",
                       "SES_2014_RCS5K_3",
                       "SES_2014_RCS5K_4")])
head(rcs(DATA_D_FEMALE$SES_2014, 5))

DATA_D_FEMALE_PC_PM25_2014_STD_T1 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.050)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T2 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.275)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T3 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.500)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T4 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.725)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T5 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.950)[[1]]

DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T2) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T3) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T4) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T5) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3)

DATA_D_FEMALE_PC_PM25_2014_STD_TAU <- (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 2

DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_1 <- DATA_D_FEMALE$PC_PM25_2014_STD / DATA_D_FEMALE_PC_PM25_2014_STD_TAU
DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_2 <- (DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 - DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_D_FEMALE_PC_PM25_2014_STD_TAU
DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_3 <- (DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 - DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_D_FEMALE_PC_PM25_2014_STD_TAU
DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_4 <- (DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 - DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_D_FEMALE_PC_PM25_2014_STD_TAU

head(DATA_D_FEMALE[, c("PC_PM25_2014_STD",
                       "PC_PM25_2014_STD_RCS5K_1",
                       "PC_PM25_2014_STD_RCS5K_2",
                       "PC_PM25_2014_STD_RCS5K_3",
                       "PC_PM25_2014_STD_RCS5K_4")])
head(rcs(DATA_D_FEMALE$PC_PM25_2014_STD, 5))

write.csv(...)

## DATA_E_MALE ----

DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- (DATA_E_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T1) ** 3
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- ifelse(DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <= 0,
                                                                0,
                                                                DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3)
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- (DATA_E_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T2) ** 3
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- ifelse(DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <= 0,
                                                                0,
                                                                DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3)
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- (DATA_E_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T3) ** 3
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- ifelse(DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <= 0,
                                                                0,
                                                                DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3)
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- (DATA_E_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T4) ** 3
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- ifelse(DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <= 0,
                                                                0,
                                                                DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3)
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- (DATA_E_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T5) ** 3
DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- ifelse(DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <= 0,
                                                                0,
                                                                DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3)

DATA_E_MALE_AGE_STD_TAU <- (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) ** 2

DATA_E_MALE$AGE_STD_RCS5K_1 <- DATA_E_MALE$AGE_STD / DATA_E_MALE_AGE_STD_TAU
DATA_E_MALE$AGE_STD_RCS5K_2 <- (DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 - DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_E_MALE_AGE_STD_TAU
DATA_E_MALE$AGE_STD_RCS5K_3 <- (DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 - DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_E_MALE_AGE_STD_TAU
DATA_E_MALE$AGE_STD_RCS5K_4 <- (DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 - DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_E_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_E_MALE_AGE_STD_TAU

DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- (DATA_E_MALE$SES_2015 - DATA_D_MALE_SES_2014_T1) ** 3
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- ifelse(DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <= 0,
                                                                  0,
                                                                  DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3)
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- (DATA_E_MALE$SES_2015 - DATA_D_MALE_SES_2014_T2) ** 3
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- ifelse(DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <= 0,
                                                                  0,
                                                                  DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3)
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- (DATA_E_MALE$SES_2015 - DATA_D_MALE_SES_2014_T3) ** 3
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- ifelse(DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <= 0,
                                                                  0,
                                                                  DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3)
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- (DATA_E_MALE$SES_2015 - DATA_D_MALE_SES_2014_T4) ** 3
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- ifelse(DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <= 0,
                                                                  0,
                                                                  DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3)
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- (DATA_E_MALE$SES_2015 - DATA_D_MALE_SES_2014_T5) ** 3
DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- ifelse(DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <= 0,
                                                                  0,
                                                                  DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3)

DATA_E_MALE_SES_2015_TAU <- (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) ** 2

DATA_E_MALE$SES_2015_RCS5K_1 <- DATA_E_MALE$SES_2015 / DATA_E_MALE_SES_2015_TAU
DATA_E_MALE$SES_2015_RCS5K_2 <- (DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 - DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_E_MALE_SES_2015_TAU
DATA_E_MALE$SES_2015_RCS5K_3 <- (DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 - DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_E_MALE_SES_2015_TAU
DATA_E_MALE$SES_2015_RCS5K_4 <- (DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 - DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_E_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_E_MALE_SES_2015_TAU

DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_E_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 3
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3)
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_E_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T2) ** 3
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3)
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_E_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T3) ** 3
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3)
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_E_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T4) ** 3
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3)
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_E_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T5) ** 3
DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3)

DATA_E_MALE_PC_PM25_2015_STD_TAU <- (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 2

DATA_E_MALE$PC_PM25_2015_STD_RCS5K_1 <- DATA_E_MALE$PC_PM25_2015_STD / DATA_E_MALE_PC_PM25_2015_STD_TAU
DATA_E_MALE$PC_PM25_2015_STD_RCS5K_2 <- (DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 - DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_E_MALE_PC_PM25_2015_STD_TAU
DATA_E_MALE$PC_PM25_2015_STD_RCS5K_3 <- (DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 - DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_E_MALE_PC_PM25_2015_STD_TAU
DATA_E_MALE$PC_PM25_2015_STD_RCS5K_4 <- (DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 - DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_E_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_E_MALE_PC_PM25_2015_STD_TAU

write.csv(...)

## DATA_E_FEMALE ----

DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- (DATA_E_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T1) ** 3
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- ifelse(DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <= 0,
                                                                    0,
                                                                    DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3)
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- (DATA_E_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T2) ** 3
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- ifelse(DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <= 0,
                                                                    0,
                                                                    DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3)
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- (DATA_E_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T3) ** 3
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- ifelse(DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <= 0,
                                                                    0,
                                                                    DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3)
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- (DATA_E_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T4) ** 3
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- ifelse(DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <= 0,
                                                                    0,
                                                                    DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3)
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- (DATA_E_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T5) ** 3
DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- ifelse(DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <= 0,
                                                                    0,
                                                                    DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3)

DATA_E_FEMALE_AGE_STD_TAU <- (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) ** 2

DATA_E_FEMALE$AGE_STD_RCS5K_1 <- DATA_E_FEMALE$AGE_STD / DATA_E_FEMALE_AGE_STD_TAU
DATA_E_FEMALE$AGE_STD_RCS5K_2 <- (DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 - DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_E_FEMALE_AGE_STD_TAU
DATA_E_FEMALE$AGE_STD_RCS5K_3 <- (DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 - DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_E_FEMALE_AGE_STD_TAU
DATA_E_FEMALE$AGE_STD_RCS5K_4 <- (DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 - DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_E_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_E_FEMALE_AGE_STD_TAU

DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- (DATA_E_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T1) ** 3
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- ifelse(DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <= 0,
                                                                      0,
                                                                      DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3)
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- (DATA_E_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T2) ** 3
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- ifelse(DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <= 0,
                                                                      0,
                                                                      DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3)
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- (DATA_E_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T3) ** 3
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- ifelse(DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <= 0,
                                                                      0,
                                                                      DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3)
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- (DATA_E_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T4) ** 3
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- ifelse(DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <= 0,
                                                                      0,
                                                                      DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3)
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- (DATA_E_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T5) ** 3
DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- ifelse(DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <= 0,
                                                                      0,
                                                                      DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3)

DATA_E_FEMALE_SES_2015_TAU <- (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) ** 2

DATA_E_FEMALE$SES_2015_RCS5K_1 <- DATA_E_FEMALE$SES_2015 / DATA_E_FEMALE_SES_2015_TAU
DATA_E_FEMALE$SES_2015_RCS5K_2 <- (DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 - DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_E_FEMALE_SES_2015_TAU
DATA_E_FEMALE$SES_2015_RCS5K_3 <- (DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 - DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_E_FEMALE_SES_2015_TAU
DATA_E_FEMALE$SES_2015_RCS5K_4 <- (DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 - DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_E_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_E_FEMALE_SES_2015_TAU

DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_E_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 3
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3)
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_E_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T2) ** 3
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3)
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_E_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T3) ** 3
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3)
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_E_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T4) ** 3
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3)
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_E_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T5) ** 3
DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3)

DATA_E_FEMALE_PC_PM25_2015_STD_TAU <- (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 2

DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_1 <- DATA_E_FEMALE$PC_PM25_2015_STD / DATA_E_FEMALE_PC_PM25_2015_STD_TAU
DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_2 <- (DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 - DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_E_FEMALE_PC_PM25_2015_STD_TAU
DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_3 <- (DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 - DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_E_FEMALE_PC_PM25_2015_STD_TAU
DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_4 <- (DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 - DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_E_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_E_FEMALE_PC_PM25_2015_STD_TAU

write.csv(...)

# Models ----

## MALE_SDH_1 ----

MALE_SDH_1 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_1

saveRDS(...)

## MALE_SDH_2 ----

MALE_SDH_2 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_2

saveRDS(...)

## MALE_SDH_3 ----

MALE_SDH_3 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_3

saveRDS(...)

## MALE_SDH_4 ----

MALE_SDH_4 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_4

saveRDS(...)

## MALE_SDH_5 ----

MALE_SDH_5 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_5

saveRDS(...)

## MALE_SDH_6 ----

MALE_SDH_6 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_6

saveRDS(...)

## MALE_SDH_7 ----

MALE_SDH_7 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_7

saveRDS(...)

## MALE_SDH_8 ----

MALE_SDH_8 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    SES_2014_RCS5K_2 +
                    SES_2014_RCS5K_3 +
                    SES_2014_RCS5K_4 +
                    PC_PM25_2014_STD +
                    PC_PM25_2014_STD_RCS5K_2 +
                    PC_PM25_2014_STD_RCS5K_3 +
                    PC_PM25_2014_STD_RCS5K_4,
                  data = DATA_D_MALE,
                  cause = "1")
MALE_SDH_8

saveRDS(...)

## MALE_CSC_1 ----

MALE_CSC_1 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_1

saveRDS(...)

## MALE_CSC_2 ----

MALE_CSC_2 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_2

saveRDS(...)

## MALE_CSC_3 ----

MALE_CSC_3 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_3

saveRDS(...)

## MALE_CSC_4 ----

MALE_CSC_4 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_4

saveRDS(...)

## MALE_CSC_5 ----

MALE_CSC_5 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_5

saveRDS(...)

## MALE_CSC_6 ----

MALE_CSC_6 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_6

saveRDS(...)

## MALE_CSC_7 ----

MALE_CSC_7 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_7

saveRDS(...)

## MALE_CSC_8 ----

MALE_CSC_8 <- CSC(Hist(TIME, EVENT) ~ 
                     AGE_STD +
                     AGE_STD_RCS5K_2 +
                     AGE_STD_RCS5K_3 +
                     AGE_STD_RCS5K_4 + 
                     SES_2014 +
                     SES_2014_RCS5K_2 +
                     SES_2014_RCS5K_3 +
                     SES_2014_RCS5K_4 +
                     PC_PM25_2014_STD +
                     PC_PM25_2014_STD_RCS5K_2 +
                     PC_PM25_2014_STD_RCS5K_3 +
                     PC_PM25_2014_STD_RCS5K_4,
                   data = DATA_D_MALE,
                   cause = "1")
MALE_CSC_8

saveRDS(...)

## FEMALE_SDH_1 ----

FEMALE_SDH_1 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_1

saveRDS(...)

## FEMALE_SDH_2 ----

FEMALE_SDH_2 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_2

saveRDS(...)

## FEMALE_SDH_3 ----

FEMALE_SDH_3 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_3

saveRDS(...)

## FEMALE_SDH_4 ----

FEMALE_SDH_4 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_4

saveRDS(...)

## FEMALE_SDH_5 ----

FEMALE_SDH_5 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_5

saveRDS(...)

## FEMALE_SDH_6 ----

FEMALE_SDH_6 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_6

saveRDS(...)

## FEMALE_SDH_7 ----

FEMALE_SDH_7 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_7

saveRDS(...)

## FEMALE_SDH_8 ----

FEMALE_SDH_8 <- FGR(Hist(TIME, EVENT) ~ 
                     AGE_STD +
                     AGE_STD_RCS5K_2 +
                     AGE_STD_RCS5K_3 +
                     AGE_STD_RCS5K_4 + 
                     SES_2014 +
                     SES_2014_RCS5K_2 +
                     SES_2014_RCS5K_3 +
                     SES_2014_RCS5K_4 +
                     PC_PM25_2014_STD +
                     PC_PM25_2014_STD_RCS5K_2 +
                     PC_PM25_2014_STD_RCS5K_3 +
                     PC_PM25_2014_STD_RCS5K_4,
                   data = DATA_D_FEMALE,
                   cause = "1")
FEMALE_SDH_8

saveRDS(...)

## FEMALE_CSC_1 ----

FEMALE_CSC_1 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_1

saveRDS(...)

## FEMALE_CSC_2 ----

FEMALE_CSC_2 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_2

saveRDS(...)

## FEMALE_CSC_3 ----

FEMALE_CSC_3 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_3

saveRDS(...)

## FEMALE_CSC_4 ----

FEMALE_CSC_4 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_4

saveRDS(...)

## FEMALE_CSC_5 ----

FEMALE_CSC_5 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_5

saveRDS(...)

## FEMALE_CSC_6 ----

FEMALE_CSC_6 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_6

saveRDS(...)

## FEMALE_CSC_7 ----

FEMALE_CSC_7 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_7

saveRDS(...)

## FEMALE_CSC_8 ----

FEMALE_CSC_8 <- CSC(Hist(TIME, EVENT) ~ 
                     AGE_STD +
                     AGE_STD_RCS5K_2 +
                     AGE_STD_RCS5K_3 +
                     AGE_STD_RCS5K_4 + 
                     SES_2014 +
                     SES_2014_RCS5K_2 +
                     SES_2014_RCS5K_3 +
                     SES_2014_RCS5K_4 +
                     PC_PM25_2014_STD +
                     PC_PM25_2014_STD_RCS5K_2 +
                     PC_PM25_2014_STD_RCS5K_3 +
                     PC_PM25_2014_STD_RCS5K_4,
                   data = DATA_D_FEMALE,
                   cause = "1")
FEMALE_CSC_8

saveRDS(...)

# Discrimination ----

## E_MALE_SDH_AUC ----

E_MALE_SDH_AUC <- Score(list(MALE_SDH_1,
                             MALE_SDH_2,
                             MALE_SDH_3,
                             MALE_SDH_4,
                             MALE_SDH_5,
                             MALE_SDH_6,
                             MALE_SDH_7,
                             MALE_SDH_8),
                        formula = Hist(TIME, EVENT) ~ 1,
                        data = data.frame(TIME = DATA_E_MALE$TIME,
                                          EVENT = DATA_E_MALE$EVENT,
                                          AGE_STD = DATA_E_MALE$AGE_STD,
                                          AGE_STD_RCS5K_2 = DATA_E_MALE$AGE_STD_RCS5K_2,
                                          AGE_STD_RCS5K_3 = DATA_E_MALE$AGE_STD_RCS5K_3,
                                          AGE_STD_RCS5K_4 = DATA_E_MALE$AGE_STD_RCS5K_4,
                                          SES_2014 = DATA_E_MALE$SES_2015,
                                          SES_2014_RCS5K_2 = DATA_E_MALE$SES_2015_RCS5K_2,
                                          SES_2014_RCS5K_3 = DATA_E_MALE$SES_2015_RCS5K_3,
                                          SES_2014_RCS5K_4 = DATA_E_MALE$SES_2015_RCS5K_4,
                                          PC_PM25_2014_STD = DATA_E_MALE$PC_PM25_2015_STD,
                                          PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_2,
                                          PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_3,
                                          PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_4),
                        metrics = "AUC",
                        cause = 1,
                        times = 4,
                        se.fit = FALSE)
E_MALE_SDH_AUC
subset(as.data.frame(E_MALE_SDH_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_MALE_SDH_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## E_MALE_CSC_AUC ----

E_MALE_CSC_AUC <- Score(list(MALE_CSC_1,
                             MALE_CSC_2,
                             MALE_CSC_3,
                             MALE_CSC_4,
                             MALE_CSC_5,
                             MALE_CSC_6,
                             MALE_CSC_7,
                             MALE_CSC_8),
                        formula = Hist(TIME, EVENT) ~ 1,
                        data = data.frame(TIME = DATA_E_MALE$TIME,
                                          EVENT = DATA_E_MALE$EVENT,
                                          AGE_STD = DATA_E_MALE$AGE_STD,
                                          AGE_STD_RCS5K_2 = DATA_E_MALE$AGE_STD_RCS5K_2,
                                          AGE_STD_RCS5K_3 = DATA_E_MALE$AGE_STD_RCS5K_3,
                                          AGE_STD_RCS5K_4 = DATA_E_MALE$AGE_STD_RCS5K_4,
                                          SES_2014 = DATA_E_MALE$SES_2015,
                                          SES_2014_RCS5K_2 = DATA_E_MALE$SES_2015_RCS5K_2,
                                          SES_2014_RCS5K_3 = DATA_E_MALE$SES_2015_RCS5K_3,
                                          SES_2014_RCS5K_4 = DATA_E_MALE$SES_2015_RCS5K_4,
                                          PC_PM25_2014_STD = DATA_E_MALE$PC_PM25_2015_STD,
                                          PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_2,
                                          PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_3,
                                          PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_4),
                        metrics = "AUC",
                        cause = 1,
                        times = 4,
                        se.fit = FALSE)
E_MALE_CSC_AUC
subset(as.data.frame(E_MALE_CSC_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_MALE_CSC_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## E_FEMALE_SDH_AUC ----

E_FEMALE_SDH_AUC <- Score(list(FEMALE_SDH_1,
                               FEMALE_SDH_2,
                               FEMALE_SDH_3,
                               FEMALE_SDH_4,
                               FEMALE_SDH_5,
                               FEMALE_SDH_6,
                               FEMALE_SDH_7,
                               FEMALE_SDH_8),
                          formula = Hist(TIME, EVENT) ~ 1,
                          data = data.frame(TIME = DATA_E_FEMALE$TIME,
                                            EVENT = DATA_E_FEMALE$EVENT,
                                            AGE_STD = DATA_E_FEMALE$AGE_STD,
                                            AGE_STD_RCS5K_2 = DATA_E_FEMALE$AGE_STD_RCS5K_2,
                                            AGE_STD_RCS5K_3 = DATA_E_FEMALE$AGE_STD_RCS5K_3,
                                            AGE_STD_RCS5K_4 = DATA_E_FEMALE$AGE_STD_RCS5K_4,
                                            SES_2014 = DATA_E_FEMALE$SES_2015,
                                            SES_2014_RCS5K_2 = DATA_E_FEMALE$SES_2015_RCS5K_2,
                                            SES_2014_RCS5K_3 = DATA_E_FEMALE$SES_2015_RCS5K_3,
                                            SES_2014_RCS5K_4 = DATA_E_FEMALE$SES_2015_RCS5K_4,
                                            PC_PM25_2014_STD = DATA_E_FEMALE$PC_PM25_2015_STD,
                                            PC_PM25_2014_STD_RCS5K_2 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                                            PC_PM25_2014_STD_RCS5K_3 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                                            PC_PM25_2014_STD_RCS5K_4 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_4),
                          metrics = "AUC",
                          cause = 1,
                          times = 4,
                          se.fit = FALSE)
E_FEMALE_SDH_AUC
subset(as.data.frame(E_FEMALE_SDH_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_FEMALE_SDH_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## E_FEMALE_CSC_AUC ----

E_FEMALE_CSC_AUC <- Score(list(FEMALE_CSC_1,
                               FEMALE_CSC_2,
                               FEMALE_CSC_3,
                               FEMALE_CSC_4,
                               FEMALE_CSC_5,
                               FEMALE_CSC_6,
                               FEMALE_CSC_7,
                               FEMALE_CSC_8),
                          formula = Hist(TIME, EVENT) ~ 1,
                          data = data.frame(TIME = DATA_E_FEMALE$TIME,
                                            EVENT = DATA_E_FEMALE$EVENT,
                                            AGE_STD = DATA_E_FEMALE$AGE_STD,
                                            AGE_STD_RCS5K_2 = DATA_E_FEMALE$AGE_STD_RCS5K_2,
                                            AGE_STD_RCS5K_3 = DATA_E_FEMALE$AGE_STD_RCS5K_3,
                                            AGE_STD_RCS5K_4 = DATA_E_FEMALE$AGE_STD_RCS5K_4,
                                            SES_2014 = DATA_E_FEMALE$SES_2015,
                                            SES_2014_RCS5K_2 = DATA_E_FEMALE$SES_2015_RCS5K_2,
                                            SES_2014_RCS5K_3 = DATA_E_FEMALE$SES_2015_RCS5K_3,
                                            SES_2014_RCS5K_4 = DATA_E_FEMALE$SES_2015_RCS5K_4,
                                            PC_PM25_2014_STD = DATA_E_FEMALE$PC_PM25_2015_STD,
                                            PC_PM25_2014_STD_RCS5K_2 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                                            PC_PM25_2014_STD_RCS5K_3 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                                            PC_PM25_2014_STD_RCS5K_4 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_4),
                          metrics = "AUC",
                          cause = 1,
                          times = 4,
                          se.fit = FALSE)
E_FEMALE_CSC_AUC
subset(as.data.frame(E_FEMALE_CSC_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_FEMALE_CSC_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

# Calibration ----

## E_MALE_SDH_EO ----

STRUCTURE <-  c("MALE_SDH_1",
                "MALE_SDH_2",
                "MALE_SDH_3",
                "MALE_SDH_4",
                "MALE_SDH_5",
                "MALE_SDH_6",
                "MALE_SDH_7",
                "MALE_SDH_8")
E_MALE_SDH_EO <- as.data.frame(matrix(nrow = 0,
                                      ncol = 3))
colnames(E_MALE_SDH_EO) <- c("STRUCTURE",
                             "MEAN_PRED_RISK",
                             "AJ")
for(s in STRUCTURE) {
  TEMP_DATA <- data.frame(TIME = DATA_E_MALE$TIME,
                          EVENT = DATA_E_MALE$EVENT,
                          AGE_STD = DATA_E_MALE$AGE_STD,
                          AGE_STD_RCS5K_2 = DATA_E_MALE$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_E_MALE$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_E_MALE$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_E_MALE$SES_2015,
                          SES_2014_RCS5K_2 = DATA_E_MALE$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_E_MALE$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_E_MALE$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_E_MALE$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                     TEMP_DATA,
                                     times = 4,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]
  
  TEMP_E_MALE_SDH_EO <- data.frame(STRUCTURE = s,
                                   MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                   AJ = TEMP_AJ_TIMEPOINT)
  
  E_MALE_SDH_EO <- rbind(E_MALE_SDH_EO,
                         TEMP_E_MALE_SDH_EO)
}

E_MALE_SDH_EO$EO <- E_MALE_SDH_EO$MEAN_PRED_RISK / E_MALE_SDH_EO$AJ

E_MALE_SDH_EO
round(E_MALE_SDH_EO$EO, 4)

saveRDS(...)

## E_MALE_CSC_EO ----

STRUCTURE <-  c("MALE_CSC_1",
                "MALE_CSC_2",
                "MALE_CSC_3",
                "MALE_CSC_4",
                "MALE_CSC_5",
                "MALE_CSC_6",
                "MALE_CSC_7",
                "MALE_CSC_8")
E_MALE_CSC_EO <- as.data.frame(matrix(nrow = 0,
                                      ncol = 3))
colnames(E_MALE_CSC_EO) <- c("STRUCTURE",
                             "MEAN_PRED_RISK",
                             "AJ")
for(s in STRUCTURE) {
  TEMP_DATA <- data.frame(TIME = DATA_E_MALE$TIME,
                          EVENT = DATA_E_MALE$EVENT,
                          AGE_STD = DATA_E_MALE$AGE_STD,
                          AGE_STD_RCS5K_2 = DATA_E_MALE$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_E_MALE$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_E_MALE$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_E_MALE$SES_2015,
                          SES_2014_RCS5K_2 = DATA_E_MALE$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_E_MALE$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_E_MALE$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_E_MALE$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                     TEMP_DATA,
                                     times = 4,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]
  
  TEMP_E_MALE_CSC_EO <- data.frame(STRUCTURE = s,
                                   MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                   AJ = TEMP_AJ_TIMEPOINT)
  
  E_MALE_CSC_EO <- rbind(E_MALE_CSC_EO,
                         TEMP_E_MALE_CSC_EO)
}

E_MALE_CSC_EO$EO <- E_MALE_CSC_EO$MEAN_PRED_RISK / E_MALE_CSC_EO$AJ

E_MALE_CSC_EO
round(E_MALE_CSC_EO$EO, 4)

saveRDS(...)

## E_FEMALE_SDH_EO ----

STRUCTURE <-  c("FEMALE_SDH_1",
                "FEMALE_SDH_2",
                "FEMALE_SDH_3",
                "FEMALE_SDH_4",
                "FEMALE_SDH_5",
                "FEMALE_SDH_6",
                "FEMALE_SDH_7",
                "FEMALE_SDH_8")
E_FEMALE_SDH_EO <- as.data.frame(matrix(nrow = 0,
                                        ncol = 3))
colnames(E_FEMALE_SDH_EO) <- c("STRUCTURE",
                               "MEAN_PRED_RISK",
                               "AJ")
for(s in STRUCTURE) {
  TEMP_DATA <- data.frame(TIME = DATA_E_FEMALE$TIME,
                          EVENT = DATA_E_FEMALE$EVENT,
                          AGE_STD = DATA_E_FEMALE$AGE_STD,
                          AGE_STD_RCS5K_2 = DATA_E_FEMALE$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_E_FEMALE$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_E_FEMALE$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_E_FEMALE$SES_2015,
                          SES_2014_RCS5K_2 = DATA_E_FEMALE$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_E_FEMALE$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_E_FEMALE$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_E_FEMALE$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                     TEMP_DATA,
                                     times = 4,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]
  
  TEMP_E_FEMALE_SDH_EO <- data.frame(STRUCTURE = s,
                                     MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                     AJ = TEMP_AJ_TIMEPOINT)
  
  E_FEMALE_SDH_EO <- rbind(E_FEMALE_SDH_EO,
                           TEMP_E_FEMALE_SDH_EO)
}

E_FEMALE_SDH_EO$EO <- E_FEMALE_SDH_EO$MEAN_PRED_RISK / E_FEMALE_SDH_EO$AJ

E_FEMALE_SDH_EO
round(E_FEMALE_SDH_EO$EO, 4)

saveRDS(...)

## E_FEMALE_CSC_EO ----

STRUCTURE <-  c("FEMALE_CSC_1",
                "FEMALE_CSC_2",
                "FEMALE_CSC_3",
                "FEMALE_CSC_4",
                "FEMALE_CSC_5",
                "FEMALE_CSC_6",
                "FEMALE_CSC_7",
                "FEMALE_CSC_8")
E_FEMALE_CSC_EO <- as.data.frame(matrix(nrow = 0,
                                        ncol = 4))
colnames(E_FEMALE_CSC_EO) <- c("STRUCTURE",
                               "MEAN_PRED_RISK",
                               "AJ")
for(s in STRUCTURE) {
  TEMP_DATA <- data.frame(TIME = DATA_E_FEMALE$TIME,
                          EVENT = DATA_E_FEMALE$EVENT,
                          AGE_STD = DATA_E_FEMALE$AGE_STD,
                          AGE_STD_RCS5K_2 = DATA_E_FEMALE$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_E_FEMALE$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_E_FEMALE$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_E_FEMALE$SES_2015,
                          SES_2014_RCS5K_2 = DATA_E_FEMALE$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_E_FEMALE$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_E_FEMALE$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_E_FEMALE$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_E_FEMALE$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                     TEMP_DATA,
                                     times = 4,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]
  
  TEMP_E_FEMALE_CSC_EO <- data.frame(STRUCTURE = s,
                                     MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                     AJ = TEMP_AJ_TIMEPOINT)
  
  E_FEMALE_CSC_EO <- rbind(E_FEMALE_CSC_EO,
                           TEMP_E_FEMALE_CSC_EO)
}

E_FEMALE_CSC_EO$EO <- E_FEMALE_CSC_EO$MEAN_PRED_RISK / E_FEMALE_CSC_EO$AJ

E_FEMALE_CSC_EO
round(E_FEMALE_CSC_EO$EO, 4)

saveRDS(...)

## E_MALE_SDH_8_CP ----

E_MALE_SDH_8_CP <- as.data.frame(matrix(nrow = 10,
                                        ncol = 1))
colnames(E_MALE_SDH_8_CP) <- "DECILE"
E_MALE_SDH_8_CP$DECILE <- 1:10

TEMP_DATA <- as.data.frame(cbind(TIME = DATA_E_MALE$TIME,
                                 EVENT = DATA_E_MALE$EVENT,
                                 AGE_STD = DATA_E_MALE$AGE_STD,
                                 AGE_STD_RCS5K_2 = DATA_E_MALE$AGE_STD_RCS5K_2,
                                 AGE_STD_RCS5K_3 = DATA_E_MALE$AGE_STD_RCS5K_3,
                                 AGE_STD_RCS5K_4 = DATA_E_MALE$AGE_STD_RCS5K_4,
                                 SES_2014 = DATA_E_MALE$SES_2015,
                                 SES_2014_RCS5K_2 = DATA_E_MALE$SES_2015_RCS5K_2,
                                 SES_2014_RCS5K_3 = DATA_E_MALE$SES_2015_RCS5K_3,
                                 SES_2014_RCS5K_4 = DATA_E_MALE$SES_2015_RCS5K_4,
                                 PC_PM25_2014_STD = DATA_E_MALE$PC_PM25_2015_STD,
                                 PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_2,
                                 PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_3,
                                 PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE$PC_PM25_2015_STD_RCS5K_4))

TEMP_DATA$PRED_RISK <- predictRisk(MALE_SDH_8,
                                   TEMP_DATA,
                                   times = 4,
                                   cause = 1)
  
TEMP_DATA$DECILE <- cut(TEMP_DATA$PRED_RISK,
                        breaks = quantile(TEMP_DATA$PRED_RISK, prob = seq(0, 1, 0.1)),
                        labels = c(1:10),
                        include.lowest = TRUE)
  
TEMP_E_MALE_SDH_8_CP_DECILE_MEAN_PRED_RISK <- aggregate(TEMP_DATA$PRED_RISK,
                                                        list(TEMP_DATA$DECILE),
                                                        mean)
colnames(TEMP_E_MALE_SDH_8_CP_DECILE_MEAN_PRED_RISK) <- c("DECILE",
                                                          "MEAN_PRED_RISK")
E_MALE_SDH_8_CP <- merge(E_MALE_SDH_8_CP,
                         TEMP_E_MALE_SDH_8_CP_DECILE_MEAN_PRED_RISK,
                         by = "DECILE")
  
TEMP_E_MALE_SDH_8_CP_DECILE_AJ_TIMEPOINT <- data.frame(DECILE = 1:10,
                                                       AJ = NA)
for (i in 1:nrow(TEMP_E_MALE_SDH_8_CP_DECILE_AJ_TIMEPOINT)) {
  TEMP_E_MALE_SDH_8_CP_DECILE_AJ <- cuminc(ftime = subset(TEMP_DATA, DECILE == TEMP_E_MALE_SDH_8_CP_DECILE_AJ_TIMEPOINT[i, "DECILE"])$TIME,
                                           fstatus = subset(TEMP_DATA, DECILE == TEMP_E_MALE_SDH_8_CP_DECILE_AJ_TIMEPOINT[i, "DECILE"])$EVENT,
                                           cencode = 0)
  TEMP_E_MALE_SDH_8_CP_DECILE_AJ_TIMEPOINT[i, "AJ"] <- timepoints(TEMP_E_MALE_SDH_8_CP_DECILE_AJ, 4)[[1]][[1]]
}
E_MALE_SDH_8_CP <- merge(E_MALE_SDH_8_CP,
                         TEMP_E_MALE_SDH_8_CP_DECILE_AJ_TIMEPOINT,
                         by = "DECILE")

E_MALE_SDH_8_CP$DECILE <- as.numeric(E_MALE_SDH_8_CP$DECILE)
E_MALE_SDH_8_CP <- E_MALE_SDH_8_CP[order(E_MALE_SDH_8_CP$DECILE), ]

E_MALE_SDH_8_CP

saveRDS(...)

## E_FEMALE_SDH_4_CP ----

E_FEMALE_SDH_4_CP <- as.data.frame(matrix(nrow = 10,
                                          ncol = 1))
colnames(E_FEMALE_SDH_4_CP) <- "DECILE"
E_FEMALE_SDH_4_CP$DECILE <- 1:10

TEMP_DATA <- as.data.frame(cbind(TIME = DATA_E_FEMALE$TIME,
                                 EVENT = DATA_E_FEMALE$EVENT,
                                 AGE_STD = DATA_E_FEMALE$AGE_STD,
                                 SES_2014 = DATA_E_FEMALE$SES_2015,
                                 PC_PM25_2014_STD = DATA_E_FEMALE$PC_PM25_2015_STD))

TEMP_DATA$PRED_RISK <- predictRisk(FEMALE_SDH_4,
                                   TEMP_DATA,
                                   times = 4,
                                   cause = 1)

TEMP_DATA$DECILE <- cut(TEMP_DATA$PRED_RISK,
                        breaks = quantile(TEMP_DATA$PRED_RISK, prob = seq(0, 1, 0.1)),
                        labels = c(1:10),
                        include.lowest = TRUE)

TEMP_E_FEMALE_SDH_4_CP_DECILE_MEAN_PRED_RISK <- aggregate(TEMP_DATA$PRED_RISK,
                                                          list(TEMP_DATA$DECILE),
                                                          mean)
colnames(TEMP_E_FEMALE_SDH_4_CP_DECILE_MEAN_PRED_RISK) <- c("DECILE",
                                                            "MEAN_PRED_RISK")
E_FEMALE_SDH_4_CP <- merge(E_FEMALE_SDH_4_CP,
                           TEMP_E_FEMALE_SDH_4_CP_DECILE_MEAN_PRED_RISK,
                           by = "DECILE")

TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ_TIMEPOINT <- data.frame(DECILE = 1:10,
                                                         AJ = NA)
for (i in 1:nrow(TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ_TIMEPOINT)) {
  TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ <- cuminc(ftime = subset(TEMP_DATA, DECILE == TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ_TIMEPOINT[i, "DECILE"])$TIME,
                                             fstatus = subset(TEMP_DATA, DECILE == TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ_TIMEPOINT[i, "DECILE"])$EVENT,
                                             cencode = 0)
  TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ_TIMEPOINT[i, "AJ"] <- timepoints(TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ, 4)[[1]][[1]]
}
E_FEMALE_SDH_4_CP <- merge(E_FEMALE_SDH_4_CP,
                           TEMP_E_FEMALE_SDH_4_CP_DECILE_AJ_TIMEPOINT,
                           by = "DECILE")

E_FEMALE_SDH_4_CP$DECILE <- as.numeric(E_FEMALE_SDH_4_CP$DECILE)
E_FEMALE_SDH_4_CP <- E_FEMALE_SDH_4_CP[order(E_FEMALE_SDH_4_CP$DECILE), ]

E_FEMALE_SDH_4_CP

saveRDS(...)

## FIG_E_MALE_SDH_8_FEMALE_SDH_4_CP ----

FIG_E_MALE_SDH_8_FEMALE_SDH_4_CP <- 
  ggplot() +
    geom_segment(data = E_MALE_SDH_8_CP,
                 colour = "grey",
                 aes(x = 0, 
                     xend = 0.07, 
                     y = 0, 
                     yend = 0.07)) +
    geom_line(data = E_MALE_SDH_8_CP,
              stat = "smooth",
              se = FALSE, 
              span = 0.80,
              linewidth = 1,
              aes(x = MEAN_PRED_RISK, 
                  y = AJ, 
                  colour = "A")) +
    geom_line(data = E_FEMALE_SDH_4_CP,
              stat = "smooth",
              se = FALSE, 
              span = 0.80,
              linewidth = 1,
              aes(x = MEAN_PRED_RISK, 
                  y = AJ, 
                  colour = "B")) +
    scale_x_continuous(name = "Predicted 4-year ASCVD risk (%)",
                       limits = c(0, 0.07),
                       breaks = seq(0, 0.07, 0.01),
                       labels = seq(0, 7, 1)) +
    scale_y_continuous(name = "Observed 4-year ASCVD risk (%)",
                       limits = c(0, 0.07),
                       breaks = seq(0, 0.07, 0.01),
                       labels = seq(0, 7, 1)) +
    scale_colour_manual(name = NULL,
                        values = c("A" = "skyblue",
                                   "B" = "orange"),
                        labels = c("A" = "Males",
                                   "B" = "Females")) +
    theme_minimal() +
    theme(panel.grid.minor = element_blank())
FIG_E_MALE_SDH_8_FEMALE_SDH_4_CP

# Functions ----

## MALE_SDH_8_FUNCTION ----

# Baseline 

NEW_DATA <- data.frame(matrix(data = 0, 
                              nrow = 1,
                              ncol = ncol(DATA_D_MALE)))
colnames(NEW_DATA) <- colnames(DATA_D_MALE)

MALE_SDH_8_BASELINE <- predictRisk(MALE_SDH_8, 
                                   NEW_DATA, 
                                   4)
1 - MALE_SDH_8_BASELINE

# Function

MALE_SDH_8_FUNCTION <- function(AGE,
                                WEALTH_IMP,
                                PC_EDUCATION_LOW_IMP,
                                PC_EDUCATION_INTERMEDIATE_IMP,
                                PC_EDUCATION_HIGH_IMP,
                                PC_PM25) {
  # Standardisation
  
  AGE_STD <- (AGE - 55.6382) / 8.3622 
  WEALTH_IMP_STD <- (WEALTH_IMP - 48.0596) / 10.7210
  PC_EDUCATION_LOW_IMP_STD <- (PC_EDUCATION_LOW_IMP - 71.7705) / 24.4558
  PC_EDUCATION_INTERMEDIATE_IMP_STD <- (PC_EDUCATION_INTERMEDIATE_IMP - 44.1414) / 21.4385
  PC_EDUCATION_HIGH_IMP_STD <- (PC_EDUCATION_HIGH_IMP - 35.9869) / 26.6516
  PC_PM25_STD <- (PC_PM25 - 59.5623) / 26.0015
  
  # SES
  
  SES <- 0.4819 * WEALTH_IMP_STD +
        -0.5411 * PC_EDUCATION_LOW_IMP_STD +
        -0.3451 * PC_EDUCATION_INTERMEDIATE_IMP_STD +
         0.5964 * PC_EDUCATION_HIGH_IMP_STD
  
  # Non-linear terms
  
  DATA_D_MALE_AGE_STD_T1 <- -1.611008
  DATA_D_MALE_AGE_STD_T2 <- -0.7340432
  DATA_D_MALE_AGE_STD_T3 <- -0.00656125
  DATA_D_MALE_AGE_STD_T4 <- 0.7607827
  DATA_D_MALE_AGE_STD_T5 <- 1.577954
  
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T1) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T2) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T3) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T4) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T5) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3)
  
  AGE_STD_TAU <- (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) ** 2
  
  AGE_STD_RCS5K_2 <- (AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 - AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / AGE_STD_TAU
  AGE_STD_RCS5K_3 <- (AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 - AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / AGE_STD_TAU
  AGE_STD_RCS5K_4 <- (AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 - AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / AGE_STD_TAU
  
  DATA_D_MALE_SES_2014_T1 <- -2.151085
  DATA_D_MALE_SES_2014_T2 <- -1.344966
  DATA_D_MALE_SES_2014_T3 <- -0.1849183
  DATA_D_MALE_SES_2014_T4 <- 1.057879
  DATA_D_MALE_SES_2014_T5 <- 2.870147
  
  SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- (SES - DATA_D_MALE_SES_2014_T1) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- (SES - DATA_D_MALE_SES_2014_T2) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- (SES - DATA_D_MALE_SES_2014_T3) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- (SES - DATA_D_MALE_SES_2014_T4) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- (SES - DATA_D_MALE_SES_2014_T5) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3)
  
  SES_TAU <- (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) ** 2
  
  SES_RCS5K_2 <- (SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 - SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / SES_TAU
  SES_RCS5K_3 <- (SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 - SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / SES_TAU
  SES_RCS5K_4 <- (SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 - SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / SES_TAU
  
  DATA_D_MALE_PC_PM25_2014_STD_T1 <- -1.752299
  DATA_D_MALE_PC_PM25_2014_STD_T2 <- -0.5985177
  DATA_D_MALE_PC_PM25_2014_STD_T3 <- 0.09375118
  DATA_D_MALE_PC_PM25_2014_STD_T4 <- 0.7475607
  DATA_D_MALE_PC_PM25_2014_STD_T5 <- 1.40137
  
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T2) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T3) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T4) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T5) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3)
  
  PC_PM25_STD_TAU <- (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 2
  
  PC_PM25_STD_RCS5K_2 <- (PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 - PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / PC_PM25_STD_TAU
  PC_PM25_STD_RCS5K_3 <- (PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 - PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / PC_PM25_STD_TAU
  PC_PM25_STD_RCS5K_4 <- (PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 - PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / PC_PM25_STD_TAU
  
  # Linear predictor
  
  LP <- 1.4548 * AGE_STD +
       -3.4572 * AGE_STD_RCS5K_2 +
        10.0237 * AGE_STD_RCS5K_3 + 
       -10.2369 * AGE_STD_RCS5K_4 + 
       -0.2900 * SES +
        1.2026 * SES_RCS5K_2 +
       -1.8944 * SES_RCS5K_3 +
        0.4418 * SES_RCS5K_4 +
        0.1869 * PC_PM25_STD +
       -0.5651 * PC_PM25_STD_RCS5K_2 +
        3.4596 * PC_PM25_STD_RCS5K_3 +
       -7.1875 * PC_PM25_STD_RCS5K_4
  
  # Predicted risk 
  
  PRED_RISK <- 1 - 0.9357485 ** exp(LP) 
  
  # Return
  
  return(PRED_RISK)
}

# Rounding error 

DATA_D_MALE$MALE_SDH_8_PRED_RISK <- predictRisk(MALE_SDH_8, 
                                                DATA_D_MALE, 
                                                4)
DATA_D_MALE$MALE_SDH_8_PRED_RISK_FUNCTION <- MALE_SDH_8_FUNCTION(AGE = DATA_D_MALE$AGE,
                                                                 WEALTH_IMP = DATA_D_MALE$WEALTH_2014_IMP,
                                                                 PC_EDUCATION_LOW_IMP = DATA_D_MALE$PC_EDUCATION_LOW_2014_IMP,
                                                                 PC_EDUCATION_INTERMEDIATE_IMP = DATA_D_MALE$PC_EDUCATION_INTERMEDIATE_2014_IMP,
                                                                 PC_EDUCATION_HIGH_IMP = DATA_D_MALE$PC_EDUCATION_HIGH_2014_IMP,
                                                                 PC_PM25 = DATA_D_MALE$PC_PM25_2014)
MALE_SDH_8_PRED_RISK_FUNCTION_ROUNDING_ERROR <- DATA_D_MALE$MALE_SDH_8_PRED_RISK - DATA_D_MALE$MALE_SDH_8_PRED_RISK_FUNCTION
summary(MALE_SDH_8_PRED_RISK_FUNCTION_ROUNDING_ERROR)
sd(MALE_SDH_8_PRED_RISK_FUNCTION_ROUNDING_ERROR)

## FEMALE_SDH_4_FUNCTION ----

# Baseline 

NEW_DATA <- data.frame(matrix(data = 0, 
                              nrow = 1,
                              ncol = ncol(DATA_D_FEMALE)))
colnames(NEW_DATA) <- colnames(DATA_D_FEMALE)

FEMALE_SDH_4_BASELINE <- predictRisk(FEMALE_SDH_4, 
                                     NEW_DATA, 
                                     4)
1 - FEMALE_SDH_4_BASELINE

# Function

FEMALE_SDH_4_FUNCTION <- function(AGE,
                                  WEALTH_IMP,
                                  PC_EDUCATION_LOW_IMP,
                                  PC_EDUCATION_INTERMEDIATE_IMP,
                                  PC_EDUCATION_HIGH_IMP,
                                  PC_PM25) {
  # Standardisation
  
  AGE_STD <- (AGE - 55.6368) / 8.3682 
  WEALTH_IMP_STD <- (WEALTH_IMP - 48.0748) / 10.7743
  PC_EDUCATION_LOW_IMP_STD <- (PC_EDUCATION_LOW_IMP - 71.7464) / 24.5332
  PC_EDUCATION_INTERMEDIATE_IMP_STD <- (PC_EDUCATION_INTERMEDIATE_IMP - 43.6705) / 21.2367
  PC_EDUCATION_HIGH_IMP_STD <- (PC_EDUCATION_HIGH_IMP - 36.1346) / 26.7807
  PC_PM25_STD <- (PC_PM25 - 59.5074) / 25.8898
  
  # SES
  
  SES <- 0.4834 * WEALTH_IMP_STD +
        -0.5415 * PC_EDUCATION_LOW_IMP_STD +
        -0.3448 * PC_EDUCATION_INTERMEDIATE_IMP_STD +
         0.5951 * PC_EDUCATION_HIGH_IMP_STD
  
  # Linear predictor  
  
  LP <- 0.6134 * AGE_STD +
       -0.1386 * SES +
        0.0530 * PC_PM25_STD
  
  # Predicted risk
  
  PRED_RISK <- 1 - 0.9877781 ** exp(LP) 
  
  # Return
  
  return(PRED_RISK)
}

# Rounding error

DATA_D_FEMALE$FEMALE_SDH_4_PRED_RISK <- predictRisk(FEMALE_SDH_4, 
                                                    DATA_D_FEMALE, 
                                                    4)
DATA_D_FEMALE$FEMALE_SDH_4_PRED_RISK_FUNCTION <- FEMALE_SDH_4_FUNCTION(AGE = DATA_D_FEMALE$AGE,
                                                                       WEALTH_IMP = DATA_D_FEMALE$WEALTH_2014_IMP,
                                                                       PC_EDUCATION_LOW_IMP = DATA_D_FEMALE$PC_EDUCATION_LOW_2014_IMP,
                                                                       PC_EDUCATION_INTERMEDIATE_IMP = DATA_D_FEMALE$PC_EDUCATION_INTERMEDIATE_2014_IMP,
                                                                       PC_EDUCATION_HIGH_IMP = DATA_D_FEMALE$PC_EDUCATION_HIGH_2014_IMP,
                                                                       PC_PM25 = DATA_D_FEMALE$PC_PM25_2014)
FEMALE_SDH_4_PRED_RISK_FUNCTION_ROUNDING_ERROR <- DATA_D_FEMALE$FEMALE_SDH_4_PRED_RISK - DATA_D_FEMALE$FEMALE_SDH_4_PRED_RISK_FUNCTION
summary(FEMALE_SDH_4_PRED_RISK_FUNCTION_ROUNDING_ERROR)
sd(FEMALE_SDH_4_PRED_RISK_FUNCTION_ROUNDING_ERROR)

# Sensitivity analysis ----

## Subsets ----

### DATA_E_MALE_CC ----

DATA_E_MALE_CC <- DATA_E_MALE[complete.cases(DATA_E_MALE), ]
nrow(DATA_E_MALE_CC)

### DATA_E_MALE_IMP ----

DATA_E_MALE_IMP <- DATA_E_MALE[!complete.cases(DATA_E_MALE), ]
nrow(DATA_E_MALE_IMP)

### DATA_E_FEMALE_CC ----

DATA_E_FEMALE_CC <- DATA_E_FEMALE[complete.cases(DATA_E_FEMALE), ]
nrow(DATA_E_FEMALE_CC)

### DATA_E_FEMALE_IMP ----

DATA_E_FEMALE_IMP <- DATA_E_FEMALE[!complete.cases(DATA_E_FEMALE), ]
nrow(DATA_E_FEMALE_IMP)

## Discrimination ----

### E_MALE_CC_SDH_8_AUC ----

E_MALE_CC_SDH_8_AUC <- Score(list(MALE_SDH_8),
                             formula = Hist(TIME, EVENT) ~ 1,
                             data = data.frame(TIME = DATA_E_MALE_CC$TIME,
                                               EVENT = DATA_E_MALE_CC$EVENT,
                                               AGE_STD = DATA_E_MALE_CC$AGE_STD,
                                               AGE_STD_RCS5K_2 = DATA_E_MALE_CC$AGE_STD_RCS5K_2,
                                               AGE_STD_RCS5K_3 = DATA_E_MALE_CC$AGE_STD_RCS5K_3,
                                               AGE_STD_RCS5K_4 = DATA_E_MALE_CC$AGE_STD_RCS5K_4,
                                               SES_2014 = DATA_E_MALE_CC$SES_2015,
                                               SES_2014_RCS5K_2 = DATA_E_MALE_CC$SES_2015_RCS5K_2,
                                               SES_2014_RCS5K_3 = DATA_E_MALE_CC$SES_2015_RCS5K_3,
                                               SES_2014_RCS5K_4 = DATA_E_MALE_CC$SES_2015_RCS5K_4,
                                               PC_PM25_2014_STD = DATA_E_MALE_CC$PC_PM25_2015_STD,
                                               PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE_CC$PC_PM25_2015_STD_RCS5K_2,
                                               PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE_CC$PC_PM25_2015_STD_RCS5K_3,
                                               PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE_CC$PC_PM25_2015_STD_RCS5K_4),
                             metrics = "AUC",
                             cause = 1,
                             times = 4,
                             se.fit = FALSE)
E_MALE_CC_SDH_8_AUC
subset(as.data.frame(E_MALE_CC_SDH_8_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_MALE_CC_SDH_8_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

### E_MALE_IMP_SDH_8_AUC ----

E_MALE_IMP_SDH_8_AUC <- Score(list(MALE_SDH_8),
                              formula = Hist(TIME, EVENT) ~ 1,
                              data = data.frame(TIME = DATA_E_MALE_IMP$TIME,
                                                EVENT = DATA_E_MALE_IMP$EVENT,
                                                AGE_STD = DATA_E_MALE_IMP$AGE_STD,
                                                AGE_STD_RCS5K_2 = DATA_E_MALE_IMP$AGE_STD_RCS5K_2,
                                                AGE_STD_RCS5K_3 = DATA_E_MALE_IMP$AGE_STD_RCS5K_3,
                                                AGE_STD_RCS5K_4 = DATA_E_MALE_IMP$AGE_STD_RCS5K_4,
                                                SES_2014 = DATA_E_MALE_IMP$SES_2015,
                                                SES_2014_RCS5K_2 = DATA_E_MALE_IMP$SES_2015_RCS5K_2,
                                                SES_2014_RCS5K_3 = DATA_E_MALE_IMP$SES_2015_RCS5K_3,
                                                SES_2014_RCS5K_4 = DATA_E_MALE_IMP$SES_2015_RCS5K_4,
                                                PC_PM25_2014_STD = DATA_E_MALE_IMP$PC_PM25_2015_STD,
                                                PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE_IMP$PC_PM25_2015_STD_RCS5K_2,
                                                PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE_IMP$PC_PM25_2015_STD_RCS5K_3,
                                                PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE_IMP$PC_PM25_2015_STD_RCS5K_4),
                              metrics = "AUC",
                              cause = 1,
                              times = 4,
                              se.fit = FALSE)
E_MALE_IMP_SDH_8_AUC
subset(as.data.frame(E_MALE_IMP_SDH_8_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_MALE_IMP_SDH_8_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

### E_FEMALE_CC_SDH_4_AUC ----

E_FEMALE_CC_SDH_4_AUC <- Score(list(FEMALE_SDH_4),
                               formula = Hist(TIME, EVENT) ~ 1,
                               data = data.frame(TIME = DATA_E_FEMALE_CC$TIME,
                                                 EVENT = DATA_E_FEMALE_CC$EVENT,
                                                 AGE_STD = DATA_E_FEMALE_CC$AGE_STD,
                                                 SES_2014 = DATA_E_FEMALE_CC$SES_2015,
                                                 PC_PM25_2014_STD = DATA_E_FEMALE_CC$PC_PM25_2015_STD),
                               metrics = "AUC",
                               cause = 1,
                               times = 4,
                               se.fit = FALSE)
E_FEMALE_CC_SDH_4_AUC
subset(as.data.frame(E_FEMALE_CC_SDH_4_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_FEMALE_CC_SDH_4_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

### E_FEMALE_IMP_SDH_4_AUC ----

E_FEMALE_IMP_SDH_4_AUC <- Score(list(FEMALE_SDH_4),
                                formula = Hist(TIME, EVENT) ~ 1,
                                data = data.frame(TIME = DATA_E_FEMALE_IMP$TIME,
                                                  EVENT = DATA_E_FEMALE_IMP$EVENT,
                                                  AGE_STD = DATA_E_FEMALE_IMP$AGE_STD,
                                                  SES_2014 = DATA_E_FEMALE_IMP$SES_2015,
                                                  PC_PM25_2014_STD = DATA_E_FEMALE_IMP$PC_PM25_2015_STD),
                                metrics = "AUC",
                                cause = 1,
                                times = 4,
                                se.fit = FALSE)
E_FEMALE_IMP_SDH_4_AUC
subset(as.data.frame(E_FEMALE_IMP_SDH_4_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"]
round(subset(as.data.frame(E_FEMALE_IMP_SDH_4_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## Calibration ----

### E_MALE_CC_SDH_8_EO ----

TEMP_DATA <- data.frame(TIME = DATA_E_MALE_CC$TIME,
                        EVENT = DATA_E_MALE_CC$EVENT,
                        AGE_STD = DATA_E_MALE_CC$AGE_STD,
                        AGE_STD_RCS5K_2 = DATA_E_MALE_CC$AGE_STD_RCS5K_2,
                        AGE_STD_RCS5K_3 = DATA_E_MALE_CC$AGE_STD_RCS5K_3,
                        AGE_STD_RCS5K_4 = DATA_E_MALE_CC$AGE_STD_RCS5K_4,
                        SES_2014 = DATA_E_MALE_CC$SES_2015,
                        SES_2014_RCS5K_2 = DATA_E_MALE_CC$SES_2015_RCS5K_2,
                        SES_2014_RCS5K_3 = DATA_E_MALE_CC$SES_2015_RCS5K_3,
                        SES_2014_RCS5K_4 = DATA_E_MALE_CC$SES_2015_RCS5K_4,
                        PC_PM25_2014_STD = DATA_E_MALE_CC$PC_PM25_2015_STD,
                        PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE_CC$PC_PM25_2015_STD_RCS5K_2,
                        PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE_CC$PC_PM25_2015_STD_RCS5K_3,
                        PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE_CC$PC_PM25_2015_STD_RCS5K_4)

TEMP_DATA$PRED_RISK <- predictRisk(MALE_SDH_8,                                           
                                   TEMP_DATA,
                                   times = 4,
                                   cause = 1)

TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)

TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                  fstatus = TEMP_DATA$EVENT,
                  cencode = 0)
TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]

E_MALE_CC_SDH_8_EO <- data.frame(MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                 AJ = TEMP_AJ_TIMEPOINT)

E_MALE_CC_SDH_8_EO$EO <- E_MALE_CC_SDH_8_EO$MEAN_PRED_RISK / E_MALE_CC_SDH_8_EO$AJ

E_MALE_CC_SDH_8_EO
round(E_MALE_CC_SDH_8_EO$EO, 4)

saveRDS(...)

### E_MALE_IMP_SDH_8_EO ----

TEMP_DATA <- data.frame(TIME = DATA_E_MALE_IMP$TIME,
                        EVENT = DATA_E_MALE_IMP$EVENT,
                        AGE_STD = DATA_E_MALE_IMP$AGE_STD,
                        AGE_STD_RCS5K_2 = DATA_E_MALE_IMP$AGE_STD_RCS5K_2,
                        AGE_STD_RCS5K_3 = DATA_E_MALE_IMP$AGE_STD_RCS5K_3,
                        AGE_STD_RCS5K_4 = DATA_E_MALE_IMP$AGE_STD_RCS5K_4,
                        SES_2014 = DATA_E_MALE_IMP$SES_2015,
                        SES_2014_RCS5K_2 = DATA_E_MALE_IMP$SES_2015_RCS5K_2,
                        SES_2014_RCS5K_3 = DATA_E_MALE_IMP$SES_2015_RCS5K_3,
                        SES_2014_RCS5K_4 = DATA_E_MALE_IMP$SES_2015_RCS5K_4,
                        PC_PM25_2014_STD = DATA_E_MALE_IMP$PC_PM25_2015_STD,
                        PC_PM25_2014_STD_RCS5K_2 = DATA_E_MALE_IMP$PC_PM25_2015_STD_RCS5K_2,
                        PC_PM25_2014_STD_RCS5K_3 = DATA_E_MALE_IMP$PC_PM25_2015_STD_RCS5K_3,
                        PC_PM25_2014_STD_RCS5K_4 = DATA_E_MALE_IMP$PC_PM25_2015_STD_RCS5K_4)

TEMP_DATA$PRED_RISK <- predictRisk(MALE_SDH_8,                                           
                                   TEMP_DATA,
                                   times = 4,
                                   cause = 1)

TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)

TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                  fstatus = TEMP_DATA$EVENT,
                  cencode = 0)
TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]

E_MALE_IMP_SDH_8_EO <- data.frame(MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                  AJ = TEMP_AJ_TIMEPOINT)

E_MALE_IMP_SDH_8_EO$EO <- E_MALE_IMP_SDH_8_EO$MEAN_PRED_RISK / E_MALE_IMP_SDH_8_EO$AJ

E_MALE_IMP_SDH_8_EO
round(E_MALE_IMP_SDH_8_EO$EO, 4)

saveRDS(...)

### E_FEMALE_CC_SDH_4_EO ----

TEMP_DATA <- data.frame(TIME = DATA_E_FEMALE_CC$TIME,
                        EVENT = DATA_E_FEMALE_CC$EVENT,
                        AGE_STD = DATA_E_FEMALE_CC$AGE_STD,
                        SES_2014 = DATA_E_FEMALE_CC$SES_2015,
                        PC_PM25_2014_STD = DATA_E_FEMALE_CC$PC_PM25_2015_STD)

TEMP_DATA$PRED_RISK <- predictRisk(FEMALE_SDH_4,                                           
                                   TEMP_DATA,
                                   times = 4,
                                   cause = 1)

TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)

TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                  fstatus = TEMP_DATA$EVENT,
                  cencode = 0)
TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]

E_FEMALE_CC_SDH_4_EO <- data.frame(MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                   AJ = TEMP_AJ_TIMEPOINT)

E_FEMALE_CC_SDH_4_EO$EO <- E_FEMALE_CC_SDH_4_EO$MEAN_PRED_RISK / E_FEMALE_CC_SDH_4_EO$AJ

E_FEMALE_CC_SDH_4_EO
round(E_FEMALE_CC_SDH_4_EO$EO, 4)

saveRDS(...)

### E_FEMALE_IMP_SDH_4_EO ----

TEMP_DATA <- data.frame(TIME = DATA_E_FEMALE_IMP$TIME,
                        EVENT = DATA_E_FEMALE_IMP$EVENT,
                        AGE_STD = DATA_E_FEMALE_IMP$AGE_STD,
                        SES_2014 = DATA_E_FEMALE_IMP$SES_2015,
                        PC_PM25_2014_STD = DATA_E_FEMALE_IMP$PC_PM25_2015_STD)

TEMP_DATA$PRED_RISK <- predictRisk(FEMALE_SDH_4,                                           
                                   TEMP_DATA,
                                   times = 4,
                                   cause = 1)

TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK)

TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                  fstatus = TEMP_DATA$EVENT,
                  cencode = 0)
TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, 4)[[1]][[1]]

E_FEMALE_IMP_SDH_4_EO <- data.frame(MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                    AJ = TEMP_AJ_TIMEPOINT)

E_FEMALE_IMP_SDH_4_EO$EO <- E_FEMALE_IMP_SDH_4_EO$MEAN_PRED_RISK / E_FEMALE_IMP_SDH_4_EO$AJ

E_FEMALE_IMP_SDH_4_EO
round(E_FEMALE_IMP_SDH_4_EO$EO, 4)

saveRDS(...)

# Session info ----

sessionInfo()
