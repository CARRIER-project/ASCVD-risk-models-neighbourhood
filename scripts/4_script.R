# Set seed for reproducibility ----

set.seed(...)

# Packages ----

library(rms)
library(riskRegression)
library(cmprsk)
library(prodlim)
library(survival)
library(ggplot2)
library(cowplot)

# Data ----

SET_2015 <- read.csv(...)
SET_2016 <- read.csv(...)

GWB_CODE_2021_EDUCATION_2014 <- read.csv(...)
GWB_CODE_2021_EDUCATION_2015 <- read.csv(...)
GWB_CODE_2021_WEALTH_2014 <- read.csv(...)
GWB_CODE_2021_WEALTH_2015 <- read.csv(...)
GWB_CODE_2021_EDUCATION_2014_WEALTH_2014 <- merge(GWB_CODE_2021_EDUCATION_2014,
                                                  GWB_CODE_2021_WEALTH_2014,
                                                  by = "GWB_CODE_2021")
GWB_CODE_2021_EDUCATION_2015_WEALTH_2015 <- merge(GWB_CODE_2021_EDUCATION_2015,
                                                  GWB_CODE_2021_WEALTH_2015,
                                                  by = "GWB_CODE_2021")

# Creating DATA_D_MALE and DATA_D_FEMALE for development, and DATA_V_MALE and DATA_V_FEMALE for validation ----

UNION_RINPERSOON <- union(SET_2015$RINPERSOON, 
                          SET_2016$RINPERSOON)
UNION_RINPERSOON <- cbind(UNION_RINPERSOON,
                          sample(c("D", "V"),
                                 size = length(UNION_RINPERSOON),
                                 replace = TRUE,
                                 prob = c(0.5, 0.5)))
UNION_RINPERSOON <- as.data.frame(UNION_RINPERSOON)
colnames(UNION_RINPERSOON) <- c("RINPERSOON",
                                "D_V")

DATA_D <- subset(SET_2015, (!c(RINPERSOON %in% SET_2016$RINPERSOON))
                           |
                           (RINPERSOON %in% subset(UNION_RINPERSOON, D_V == "D")$RINPERSOON))
DATA_D_MALE <- subset(DATA_D, MALE == 1)
DATA_D_FEMALE <- subset(DATA_D, MALE == 0)

DATA_V <- subset(SET_2016, (!c(RINPERSOON %in% SET_2015$RINPERSOON))
                           |
                           (RINPERSOON %in% subset(UNION_RINPERSOON, D_V == "V")$RINPERSOON))
DATA_V_MALE <- subset(DATA_V, MALE == 1)
DATA_V_FEMALE <- subset(DATA_V, MALE == 0)

# Variables ----

## DATA_D_MALE ----

nrow(DATA_D_MALE)

table(DATA_D_MALE$EVENT)
prop.table(table(DATA_D_MALE$EVENT))

summary(DATA_D_MALE$TIME)
sd(DATA_D_MALE$TIME)

summary(DATA_D_MALE$AGE)
sd(DATA_D_MALE$AGE)
DATA_D_MALE$AGE_STD <- (DATA_D_MALE$AGE - mean(DATA_D_MALE$AGE)) / sd(DATA_D_MALE$AGE)

summary(DATA_D_MALE$WEALTH_2014_IMP)
sd(DATA_D_MALE$WEALTH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$WEALTH_2014))
prop.table(table(is.na(DATA_D_MALE$WEALTH_2014)))
DATA_D_MALE$WEALTH_2014_IMP_STD <- (DATA_D_MALE$WEALTH_2014_IMP - mean(DATA_D_MALE$WEALTH_2014_IMP)) / sd(DATA_D_MALE$WEALTH_2014_IMP)

summary(DATA_D_MALE$EDUCATION_LOW_2014_IMP)
sd(DATA_D_MALE$EDUCATION_LOW_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$EDUCATION_LOW_2014))
prop.table(table(is.na(DATA_D_MALE$EDUCATION_LOW_2014)))
DATA_D_MALE$EDUCATION_LOW_2014_IMP_STD <- (DATA_D_MALE$EDUCATION_LOW_2014_IMP - mean(DATA_D_MALE$EDUCATION_LOW_2014_IMP)) / sd(DATA_D_MALE$EDUCATION_LOW_2014_IMP)

summary(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP)
sd(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014))
prop.table(table(is.na(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014)))
DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP_STD <- (DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP - mean(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_D_MALE$EDUCATION_HIGH_2014_IMP)
sd(DATA_D_MALE$EDUCATION_HIGH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_MALE$EDUCATION_HIGH_2014))
prop.table(table(is.na(DATA_D_MALE$EDUCATION_HIGH_2014)))
DATA_D_MALE$EDUCATION_HIGH_2014_IMP_STD <- (DATA_D_MALE$EDUCATION_HIGH_2014_IMP - mean(DATA_D_MALE$EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_MALE$EDUCATION_HIGH_2014_IMP)

summary(DATA_D_MALE$PM25_2014)
sd(DATA_D_MALE$PM25_2014)
DATA_D_MALE$PM25_2014_STD <- (DATA_D_MALE$PM25_2014 - mean(DATA_D_MALE$PM25_2014)) / sd(DATA_D_MALE$PM25_2014)

summary(DATA_D_MALE$PC_PM25_2014)
sd(DATA_D_MALE$PC_PM25_2014)
DATA_D_MALE$PC_PM25_2014_STD <- (DATA_D_MALE$PC_PM25_2014 - mean(DATA_D_MALE$PC_PM25_2014)) / sd(DATA_D_MALE$PC_PM25_2014)

## DATA_D_FEMALE ----

nrow(DATA_D_FEMALE)

table(DATA_D_FEMALE$EVENT)
prop.table(table(DATA_D_FEMALE$EVENT))

summary(DATA_D_FEMALE$TIME)
sd(DATA_D_FEMALE$TIME)

summary(DATA_D_FEMALE$AGE)
sd(DATA_D_FEMALE$AGE)
DATA_D_FEMALE$AGE_STD <- (DATA_D_FEMALE$AGE - mean(DATA_D_FEMALE$AGE)) / sd(DATA_D_FEMALE$AGE)

summary(DATA_D_FEMALE$WEALTH_2014_IMP)
sd(DATA_D_FEMALE$WEALTH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$WEALTH_2014))
prop.table(table(is.na(DATA_D_FEMALE$WEALTH_2014)))
DATA_D_FEMALE$WEALTH_2014_IMP_STD <- (DATA_D_FEMALE$WEALTH_2014_IMP - mean(DATA_D_FEMALE$WEALTH_2014_IMP)) / sd(DATA_D_FEMALE$WEALTH_2014_IMP)

summary(DATA_D_FEMALE$EDUCATION_LOW_2014_IMP)
sd(DATA_D_FEMALE$EDUCATION_LOW_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$EDUCATION_LOW_2014))
prop.table(table(is.na(DATA_D_FEMALE$EDUCATION_LOW_2014)))
DATA_D_FEMALE$EDUCATION_LOW_2014_IMP_STD <- (DATA_D_FEMALE$EDUCATION_LOW_2014_IMP - mean(DATA_D_FEMALE$EDUCATION_LOW_2014_IMP)) / sd(DATA_D_FEMALE$EDUCATION_LOW_2014_IMP)

summary(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP)
sd(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014))
prop.table(table(is.na(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014)))
DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP_STD <- (DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP - mean(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP)
sd(DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP, na.rm = TRUE)
table(is.na(DATA_D_FEMALE$EDUCATION_HIGH_2014))
prop.table(table(is.na(DATA_D_FEMALE$EDUCATION_HIGH_2014)))
DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP_STD <- (DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP - mean(DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP)

summary(DATA_D_FEMALE$PM25_2014)
sd(DATA_D_FEMALE$PM25_2014)
DATA_D_FEMALE$PM25_2014_STD <- (DATA_D_FEMALE$PM25_2014 - mean(DATA_D_FEMALE$PM25_2014)) / sd(DATA_D_FEMALE$PM25_2014)

summary(DATA_D_FEMALE$PC_PM25_2014)
sd(DATA_D_FEMALE$PC_PM25_2014)
DATA_D_FEMALE$PC_PM25_2014_STD <- (DATA_D_FEMALE$PC_PM25_2014 - mean(DATA_D_FEMALE$PC_PM25_2014)) / sd(DATA_D_FEMALE$PC_PM25_2014)

## DATA_V_MALE ----

nrow(DATA_V_MALE)

table(DATA_V_MALE$EVENT)
prop.table(table(DATA_V_MALE$EVENT))

summary(DATA_V_MALE$TIME)
sd(DATA_V_MALE$TIME)

summary(DATA_V_MALE$AGE)
sd(DATA_V_MALE$AGE)
DATA_V_MALE$AGE_STD <- (DATA_V_MALE$AGE - mean(DATA_D_MALE$AGE)) / sd(DATA_D_MALE$AGE)

summary(DATA_V_MALE$WEALTH_2015_IMP)
sd(DATA_V_MALE$WEALTH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_MALE$WEALTH_2015))
prop.table(table(is.na(DATA_V_MALE$WEALTH_2015)))
DATA_V_MALE$WEALTH_2015_IMP_STD <- (DATA_V_MALE$WEALTH_2015_IMP - mean(DATA_D_MALE$WEALTH_2014_IMP)) / sd(DATA_D_MALE$WEALTH_2014_IMP)

summary(DATA_V_MALE$EDUCATION_LOW_2015_IMP)
sd(DATA_V_MALE$EDUCATION_LOW_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_MALE$EDUCATION_LOW_2015))
prop.table(table(is.na(DATA_V_MALE$EDUCATION_LOW_2015)))
DATA_V_MALE$EDUCATION_LOW_2015_IMP_STD <- (DATA_V_MALE$EDUCATION_LOW_2015_IMP - mean(DATA_D_MALE$EDUCATION_LOW_2014_IMP)) / sd(DATA_D_MALE$EDUCATION_LOW_2014_IMP)

summary(DATA_V_MALE$EDUCATION_INTERMEDIATE_2015_IMP)
sd(DATA_V_MALE$EDUCATION_INTERMEDIATE_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_MALE$EDUCATION_INTERMEDIATE_2015))
prop.table(table(is.na(DATA_V_MALE$EDUCATION_INTERMEDIATE_2015)))
DATA_V_MALE$EDUCATION_INTERMEDIATE_2015_IMP_STD <- (DATA_V_MALE$EDUCATION_INTERMEDIATE_2015_IMP - mean(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_V_MALE$EDUCATION_HIGH_2015_IMP)
sd(DATA_V_MALE$EDUCATION_HIGH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_MALE$EDUCATION_HIGH_2015))
prop.table(table(is.na(DATA_V_MALE$EDUCATION_HIGH_2015)))
DATA_V_MALE$EDUCATION_HIGH_2015_IMP_STD <- (DATA_V_MALE$EDUCATION_HIGH_2015_IMP - mean(DATA_D_MALE$EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_MALE$EDUCATION_HIGH_2014_IMP)

summary(DATA_V_MALE$PM25_2015)
sd(DATA_V_MALE$PM25_2015)
DATA_V_MALE$PM25_2015_STD <- (DATA_V_MALE$PM25_2015 - mean(DATA_V_MALE$PM25_2015)) / sd(DATA_V_MALE$PM25_2015)

summary(DATA_V_MALE$PC_PM25_2015)
sd(DATA_V_MALE$PC_PM25_2015)
DATA_V_MALE$PC_PM25_2015_STD <- (DATA_V_MALE$PC_PM25_2015 - mean(DATA_V_MALE$PC_PM25_2015)) / sd(DATA_V_MALE$PC_PM25_2015)

## DATA_V_FEMALE ----

nrow(DATA_V_FEMALE)

table(DATA_V_FEMALE$EVENT)
prop.table(table(DATA_V_FEMALE$EVENT))

summary(DATA_V_FEMALE$TIME)
sd(DATA_V_FEMALE$TIME)

summary(DATA_V_FEMALE$AGE)
sd(DATA_V_FEMALE$AGE)
DATA_V_FEMALE$AGE_STD <- (DATA_V_FEMALE$AGE - mean(DATA_D_FEMALE$AGE)) / sd(DATA_D_FEMALE$AGE)

summary(DATA_V_FEMALE$WEALTH_2015_IMP)
sd(DATA_V_FEMALE$WEALTH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_FEMALE$WEALTH_2015))
prop.table(table(is.na(DATA_V_FEMALE$WEALTH_2015)))
DATA_V_FEMALE$WEALTH_2015_IMP_STD <- (DATA_V_FEMALE$WEALTH_2015_IMP - mean(DATA_D_FEMALE$WEALTH_2014_IMP)) / sd(DATA_D_FEMALE$WEALTH_2014_IMP)

summary(DATA_V_FEMALE$EDUCATION_LOW_2015_IMP)
sd(DATA_V_FEMALE$EDUCATION_LOW_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_FEMALE$EDUCATION_LOW_2015))
prop.table(table(is.na(DATA_V_FEMALE$EDUCATION_LOW_2015)))
DATA_V_FEMALE$EDUCATION_LOW_2015_IMP_STD <- (DATA_V_FEMALE$EDUCATION_LOW_2015_IMP - mean(DATA_D_FEMALE$EDUCATION_LOW_2014_IMP)) / sd(DATA_D_FEMALE$EDUCATION_LOW_2014_IMP)

summary(DATA_V_FEMALE$EDUCATION_INTERMEDIATE_2015_IMP)
sd(DATA_V_FEMALE$EDUCATION_INTERMEDIATE_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_FEMALE$EDUCATION_INTERMEDIATE_2015))
prop.table(table(is.na(DATA_V_FEMALE$EDUCATION_INTERMEDIATE_2015)))
DATA_V_FEMALE$EDUCATION_INTERMEDIATE_2015_IMP_STD <- (DATA_V_FEMALE$EDUCATION_INTERMEDIATE_2015_IMP - mean(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP)) / sd(DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP)

summary(DATA_V_FEMALE$EDUCATION_HIGH_2015_IMP)
sd(DATA_V_FEMALE$EDUCATION_HIGH_2015_IMP, na.rm = TRUE)
table(is.na(DATA_V_FEMALE$EDUCATION_HIGH_2015))
prop.table(table(is.na(DATA_V_FEMALE$EDUCATION_HIGH_2015)))
DATA_V_FEMALE$EDUCATION_HIGH_2015_IMP_STD <- (DATA_V_FEMALE$EDUCATION_HIGH_2015_IMP - mean(DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP)) / sd(DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP)

summary(DATA_V_FEMALE$PM25_2015)
sd(DATA_V_FEMALE$PM25_2015)
DATA_V_FEMALE$PM25_2015_STD <- (DATA_V_FEMALE$PM25_2015 - mean(DATA_V_FEMALE$PM25_2015)) / sd(DATA_V_FEMALE$PM25_2015)

summary(DATA_V_FEMALE$PC_PM25_2015)
sd(DATA_V_FEMALE$PC_PM25_2015)
DATA_V_FEMALE$PC_PM25_2015_STD <- (DATA_V_FEMALE$PC_PM25_2015 - mean(DATA_V_FEMALE$PC_PM25_2015)) / sd(DATA_V_FEMALE$PC_PM25_2015)

# Dimensionality reduction ----

## DATA_D_MALE ----

cor(DATA_D_MALE[, c("AGE",
                    "WEALTH_2014_IMP",
                    "EDUCATION_LOW_2014_IMP",
                    "EDUCATION_INTERMEDIATE_2014_IMP",
                    "EDUCATION_HIGH_2014_IMP",
                    "PC_PM25_2014")])

DATA_D_MALE_PCA <- princomp(cor(DATA_D_MALE[, c("WEALTH_2014_IMP_STD",
                                                "EDUCATION_LOW_2014_IMP_STD",
                                                "EDUCATION_INTERMEDIATE_2014_IMP_STD",
                                                "EDUCATION_HIGH_2014_IMP_STD")]))
summary(DATA_D_MALE_PCA)

DATA_D_MALE_PCA$loadings

DATA_D_MALE$SES_2014 <- DATA_D_MALE_PCA[["loadings"]][[1]] * DATA_D_MALE$WEALTH_2014_IMP_STD + 
                        DATA_D_MALE_PCA[["loadings"]][[2]] * DATA_D_MALE$EDUCATION_LOW_2014_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[3]] * DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[4]] * DATA_D_MALE$EDUCATION_HIGH_2014_IMP_STD 

summary(DATA_D_MALE$SES_2014)
sd(DATA_D_MALE$SES_2014)

## DATA_D_FEMALE ----

cor(DATA_D_FEMALE[, c("AGE",
                      "WEALTH_2014_IMP",
                      "EDUCATION_LOW_2014_IMP",
                      "EDUCATION_INTERMEDIATE_2014_IMP",
                      "EDUCATION_HIGH_2014_IMP",
                      "PC_PM25_2014")])

DATA_D_FEMALE_PCA <- princomp(cor(DATA_D_FEMALE[, c("WEALTH_2014_IMP_STD",
                                                    "EDUCATION_LOW_2014_IMP_STD",
                                                    "EDUCATION_INTERMEDIATE_2014_IMP_STD",
                                                    "EDUCATION_HIGH_2014_IMP_STD")]))
summary(DATA_D_FEMALE_PCA)

DATA_D_FEMALE_PCA$loadings

DATA_D_FEMALE$SES_2014 <- DATA_D_FEMALE_PCA[["loadings"]][[1]] * DATA_D_FEMALE$WEALTH_2014_IMP_STD + 
                          DATA_D_FEMALE_PCA[["loadings"]][[2]] * DATA_D_FEMALE$EDUCATION_LOW_2014_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[3]] * DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[4]] * DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP_STD

summary(DATA_D_FEMALE$SES_2014)
sd(DATA_D_FEMALE$SES_2014)

## DATA_V_MALE ----

DATA_V_MALE$SES_2015 <- DATA_D_MALE_PCA[["loadings"]][[1]] * DATA_V_MALE$WEALTH_2015_IMP_STD + 
                        DATA_D_MALE_PCA[["loadings"]][[2]] * DATA_V_MALE$EDUCATION_LOW_2015_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[3]] * DATA_V_MALE$EDUCATION_INTERMEDIATE_2015_IMP_STD +
                        DATA_D_MALE_PCA[["loadings"]][[4]] * DATA_V_MALE$EDUCATION_HIGH_2015_IMP_STD  

## DATA_V_FEMALE ----

DATA_V_FEMALE$SES_2015 <- DATA_D_FEMALE_PCA[["loadings"]][[1]] * DATA_V_FEMALE$WEALTH_2015_IMP_STD + 
                          DATA_D_FEMALE_PCA[["loadings"]][[2]] * DATA_V_FEMALE$EDUCATION_LOW_2015_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[3]] * DATA_V_FEMALE$EDUCATION_INTERMEDIATE_2015_IMP_STD +
                          DATA_D_FEMALE_PCA[["loadings"]][[4]] * DATA_V_FEMALE$EDUCATION_HIGH_2015_IMP_STD  

## GWB_CODE_2021_SES_MALE_2014 ----

GWB_CODE_2021_SES_MALE_2014 <- GWB_CODE_2021_EDUCATION_2014_WEALTH_2014
GWB_CODE_2021_SES_MALE_2014$SES_MALE_2014 <- DATA_D_MALE_PCA[["loadings"]][[1]] * ((GWB_CODE_2021_SES_MALE_2014$WEALTH_2014_IMP - 48.05) / 10.72) + 
                                             DATA_D_MALE_PCA[["loadings"]][[2]] * ((GWB_CODE_2021_SES_MALE_2014$EDUCATION_LOW_2014_IMP - 28.17) / 7.52) +
                                             DATA_D_MALE_PCA[["loadings"]][[3]] * ((GWB_CODE_2021_SES_MALE_2014$EDUCATION_INTERMEDIATE_2014_IMP - 41.93) / 4.10) +
                                             DATA_D_MALE_PCA[["loadings"]][[4]] * ((GWB_CODE_2021_SES_MALE_2014$EDUCATION_HIGH_2014_IMP - 29.90) / 9.36)
GWB_CODE_2021_SES_MALE_2014 <- GWB_CODE_2021_SES_MALE_2014[, c("GWB_CODE_2021",
                                                               "SES_MALE_2014")]

write.csv(...)

## GWB_CODE_2021_SES_FEMALE_2014 ----

GWB_CODE_2021_SES_FEMALE_2014 <- GWB_CODE_2021_EDUCATION_2014_WEALTH_2014
GWB_CODE_2021_SES_FEMALE_2014$SES_FEMALE_2014 <- DATA_D_FEMALE_PCA[["loadings"]][[1]] * ((GWB_CODE_2021_SES_FEMALE_2014$WEALTH_2014_IMP - 48.07) / 10.78) + 
                                                 DATA_D_FEMALE_PCA[["loadings"]][[2]] * ((GWB_CODE_2021_SES_FEMALE_2014$EDUCATION_LOW_2014_IMP - 28.21) / 7.57) +
                                                 DATA_D_FEMALE_PCA[["loadings"]][[3]] * ((GWB_CODE_2021_SES_FEMALE_2014$EDUCATION_INTERMEDIATE_2014_IMP - 41.86) / 4.09) +
                                                 DATA_D_FEMALE_PCA[["loadings"]][[4]] * ((GWB_CODE_2021_SES_FEMALE_2014$EDUCATION_HIGH_2014_IMP - 29.93) / 9.43)
GWB_CODE_2021_SES_FEMALE_2014 <- GWB_CODE_2021_SES_FEMALE_2014[, c("GWB_CODE_2021",
                                                                   "SES_FEMALE_2014")]

write.csv(...)

# Non-linear terms ----

## DATA_D_MALE ---- 

DATA_D_MALE_AGE_STD_T1 <- quantile(DATA_D_MALE$AGE_STD, 0.050)[[1]]
DATA_D_MALE_AGE_STD_T2 <- quantile(DATA_D_MALE$AGE_STD, 0.275)[[1]]
DATA_D_MALE_AGE_STD_T3 <- quantile(DATA_D_MALE$AGE_STD, 0.500)[[1]]
DATA_D_MALE_AGE_STD_T4 <- quantile(DATA_D_MALE$AGE_STD, 0.725)[[1]]
DATA_D_MALE_AGE_STD_T5 <- quantile(DATA_D_MALE$AGE_STD, 0.950)[[1]]

DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T1) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T2) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T3) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T4) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3)
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- (DATA_D_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T5) ** 3
DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- ifelse(DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <= 0,
                                                                0,
                                                                DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3)

DATA_D_MALE_AGE_STD_TAU <- (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) ** 2

DATA_D_MALE$AGE_STD_RCS5K_1 <- DATA_D_MALE$AGE_STD / DATA_D_MALE_AGE_STD_TAU
DATA_D_MALE$AGE_STD_RCS5K_2 <- (DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 - DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_D_MALE_AGE_STD_TAU
DATA_D_MALE$AGE_STD_RCS5K_3 <- (DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 - DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_D_MALE_AGE_STD_TAU
DATA_D_MALE$AGE_STD_RCS5K_4 <- (DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 - DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_D_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_D_MALE_AGE_STD_TAU

head(DATA_D_MALE[, c("AGE_STD",
                     "AGE_STD_RCS5K_1",
                     "AGE_STD_RCS5K_2",
                     "AGE_STD_RCS5K_3",
                     "AGE_STD_RCS5K_4")])
head(rcs(DATA_D_MALE$AGE_STD, 5))

DATA_D_MALE_SES_2014_T1 <- quantile(DATA_D_MALE$SES_2014, 0.050)[[1]]
DATA_D_MALE_SES_2014_T2 <- quantile(DATA_D_MALE$SES_2014, 0.275)[[1]]
DATA_D_MALE_SES_2014_T3 <- quantile(DATA_D_MALE$SES_2014, 0.500)[[1]]
DATA_D_MALE_SES_2014_T4 <- quantile(DATA_D_MALE$SES_2014, 0.725)[[1]]
DATA_D_MALE_SES_2014_T5 <- quantile(DATA_D_MALE$SES_2014, 0.950)[[1]]

DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T1) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T2) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T3) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T4) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3)
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- (DATA_D_MALE$SES_2014 - DATA_D_MALE_SES_2014_T5) ** 3
DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- ifelse(DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <= 0,
                                                                  0,
                                                                  DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3)

DATA_D_MALE_SES_2014_TAU <- (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) ** 2

DATA_D_MALE$SES_2014_RCS5K_1 <- DATA_D_MALE$SES_2014 / DATA_D_MALE_SES_2014_TAU
DATA_D_MALE$SES_2014_RCS5K_2 <- (DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 - DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_D_MALE_SES_2014_TAU
DATA_D_MALE$SES_2014_RCS5K_3 <- (DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 - DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_D_MALE_SES_2014_TAU
DATA_D_MALE$SES_2014_RCS5K_4 <- (DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 - DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_D_MALE_SES_2014_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_D_MALE_SES_2014_TAU

head(DATA_D_MALE[, c("SES_2014",
                     "SES_2014_RCS5K_1",
                     "SES_2014_RCS5K_2",
                     "SES_2014_RCS5K_3",
                     "SES_2014_RCS5K_4")])
head(rcs(DATA_D_MALE$SES_2014, 5))

DATA_D_MALE_PC_PM25_2014_STD_T1 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.050)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T2 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.275)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T3 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.500)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T4 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.725)[[1]]
DATA_D_MALE_PC_PM25_2014_STD_T5 <- quantile(DATA_D_MALE$PC_PM25_2014_STD, 0.950)[[1]]

DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T2) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T3) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T4) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3)
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_D_MALE$PC_PM25_2014_STD - DATA_D_MALE_PC_PM25_2014_STD_T5) ** 3
DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3)

DATA_D_MALE_PC_PM25_2014_STD_TAU <- (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 2

DATA_D_MALE$PC_PM25_2014_STD_RCS5K_1 <- DATA_D_MALE$PC_PM25_2014_STD / DATA_D_MALE_PC_PM25_2014_STD_TAU
DATA_D_MALE$PC_PM25_2014_STD_RCS5K_2 <- (DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 - DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_D_MALE_PC_PM25_2014_STD_TAU
DATA_D_MALE$PC_PM25_2014_STD_RCS5K_3 <- (DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 - DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_D_MALE_PC_PM25_2014_STD_TAU
DATA_D_MALE$PC_PM25_2014_STD_RCS5K_4 <- (DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 - DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_D_MALE_PC_PM25_2014_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_D_MALE_PC_PM25_2014_STD_TAU

head(DATA_D_MALE[, c("PC_PM25_2014_STD",
                     "PC_PM25_2014_STD_RCS5K_1",
                     "PC_PM25_2014_STD_RCS5K_2",
                     "PC_PM25_2014_STD_RCS5K_3",
                     "PC_PM25_2014_STD_RCS5K_4")])
head(rcs(DATA_D_MALE$PC_PM25_2014_STD, 5))

write.csv(...)

## DATA_D_FEMALE ----

DATA_D_FEMALE_AGE_STD_T1 <- quantile(DATA_D_FEMALE$AGE_STD, 0.050)[[1]]
DATA_D_FEMALE_AGE_STD_T2 <- quantile(DATA_D_FEMALE$AGE_STD, 0.275)[[1]]
DATA_D_FEMALE_AGE_STD_T3 <- quantile(DATA_D_FEMALE$AGE_STD, 0.500)[[1]]
DATA_D_FEMALE_AGE_STD_T4 <- quantile(DATA_D_FEMALE$AGE_STD, 0.725)[[1]]
DATA_D_FEMALE_AGE_STD_T5 <- quantile(DATA_D_FEMALE$AGE_STD, 0.950)[[1]]

DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T1) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T2) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T3) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T4) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3)
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- (DATA_D_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T5) ** 3
DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- ifelse(DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <= 0,
                                                                    0,
                                                                    DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3)

DATA_D_FEMALE_AGE_STD_TAU <- (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) ** 2

DATA_D_FEMALE$AGE_STD_RCS5K_1 <- DATA_D_FEMALE$AGE_STD / DATA_D_FEMALE_AGE_STD_TAU
DATA_D_FEMALE$AGE_STD_RCS5K_2 <- (DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 - DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_D_FEMALE_AGE_STD_TAU
DATA_D_FEMALE$AGE_STD_RCS5K_3 <- (DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 - DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_D_FEMALE_AGE_STD_TAU
DATA_D_FEMALE$AGE_STD_RCS5K_4 <- (DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 - DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_D_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_D_FEMALE_AGE_STD_TAU

head(DATA_D_FEMALE[, c("AGE_STD",
                       "AGE_STD_RCS5K_1",
                       "AGE_STD_RCS5K_2",
                       "AGE_STD_RCS5K_3",
                       "AGE_STD_RCS5K_4")])
head(rcs(DATA_D_FEMALE$AGE_STD, 5))

DATA_D_FEMALE_SES_2014_T1 <- quantile(DATA_D_FEMALE$SES_2014, 0.050)[[1]]
DATA_D_FEMALE_SES_2014_T2 <- quantile(DATA_D_FEMALE$SES_2014, 0.275)[[1]]
DATA_D_FEMALE_SES_2014_T3 <- quantile(DATA_D_FEMALE$SES_2014, 0.500)[[1]]
DATA_D_FEMALE_SES_2014_T4 <- quantile(DATA_D_FEMALE$SES_2014, 0.725)[[1]]
DATA_D_FEMALE_SES_2014_T5 <- quantile(DATA_D_FEMALE$SES_2014, 0.950)[[1]]

DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T1) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T2) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T3) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T4) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3)
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- (DATA_D_FEMALE$SES_2014 - DATA_D_FEMALE_SES_2014_T5) ** 3
DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- ifelse(DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <= 0,
                                                                      0,
                                                                      DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3)

DATA_D_FEMALE_SES_2014_TAU <- (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) ** 2

DATA_D_FEMALE$SES_2014_RCS5K_1 <- DATA_D_FEMALE$SES_2014 / DATA_D_FEMALE_SES_2014_TAU
DATA_D_FEMALE$SES_2014_RCS5K_2 <- (DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 - DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_D_FEMALE_SES_2014_TAU
DATA_D_FEMALE$SES_2014_RCS5K_3 <- (DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 - DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_D_FEMALE_SES_2014_TAU
DATA_D_FEMALE$SES_2014_RCS5K_4 <- (DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 - DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_D_FEMALE_SES_2014_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_D_FEMALE_SES_2014_TAU

head(DATA_D_FEMALE[, c("SES_2014",
                       "SES_2014_RCS5K_1",
                       "SES_2014_RCS5K_2",
                       "SES_2014_RCS5K_3",
                       "SES_2014_RCS5K_4")])
head(rcs(DATA_D_FEMALE$SES_2014, 5))

DATA_D_FEMALE_PC_PM25_2014_STD_T1 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.050)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T2 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.275)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T3 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.500)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T4 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.725)[[1]]
DATA_D_FEMALE_PC_PM25_2014_STD_T5 <- quantile(DATA_D_FEMALE$PC_PM25_2014_STD, 0.950)[[1]]

DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T2) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T3) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T4) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3)
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_D_FEMALE$PC_PM25_2014_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T5) ** 3
DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3)

DATA_D_FEMALE_PC_PM25_2014_STD_TAU <- (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 2

DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_1 <- DATA_D_FEMALE$PC_PM25_2014_STD / DATA_D_FEMALE_PC_PM25_2014_STD_TAU
DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_2 <- (DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 - DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_D_FEMALE_PC_PM25_2014_STD_TAU
DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_3 <- (DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 - DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_D_FEMALE_PC_PM25_2014_STD_TAU
DATA_D_FEMALE$PC_PM25_2014_STD_RCS5K_4 <- (DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 - DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_D_FEMALE_PC_PM25_2014_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_D_FEMALE_PC_PM25_2014_STD_TAU

head(DATA_D_FEMALE[, c("PC_PM25_2014_STD",
                       "PC_PM25_2014_STD_RCS5K_1",
                       "PC_PM25_2014_STD_RCS5K_2",
                       "PC_PM25_2014_STD_RCS5K_3",
                       "PC_PM25_2014_STD_RCS5K_4")])
head(rcs(DATA_D_FEMALE$PC_PM25_2014_STD, 5))

write.csv(...)

## DATA_V_MALE ----

DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- (DATA_V_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T1) ** 3
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- ifelse(DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <= 0,
                                                                0,
                                                                DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3)
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- (DATA_V_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T2) ** 3
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- ifelse(DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <= 0,
                                                                0,
                                                                DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3)
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- (DATA_V_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T3) ** 3
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- ifelse(DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <= 0,
                                                                0,
                                                                DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3)
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- (DATA_V_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T4) ** 3
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- ifelse(DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <= 0,
                                                                0,
                                                                DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3)
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- (DATA_V_MALE$AGE_STD - DATA_D_MALE_AGE_STD_T5) ** 3
DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- ifelse(DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <= 0,
                                                                0,
                                                                DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3)

DATA_V_MALE_AGE_STD_TAU <- (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) ** 2

DATA_V_MALE$AGE_STD_RCS5K_1 <- DATA_V_MALE$AGE_STD / DATA_V_MALE_AGE_STD_TAU
DATA_V_MALE$AGE_STD_RCS5K_2 <- (DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 - DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_V_MALE_AGE_STD_TAU
DATA_V_MALE$AGE_STD_RCS5K_3 <- (DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 - DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_V_MALE_AGE_STD_TAU
DATA_V_MALE$AGE_STD_RCS5K_4 <- (DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 - DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + DATA_V_MALE_AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / DATA_V_MALE_AGE_STD_TAU

DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- (DATA_V_MALE$SES_2015 - DATA_D_MALE_SES_2014_T1) ** 3
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- ifelse(DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <= 0,
                                                                  0,
                                                                  DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3)
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- (DATA_V_MALE$SES_2015 - DATA_D_MALE_SES_2014_T2) ** 3
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- ifelse(DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <= 0,
                                                                  0,
                                                                  DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3)
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- (DATA_V_MALE$SES_2015 - DATA_D_MALE_SES_2014_T3) ** 3
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- ifelse(DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <= 0,
                                                                  0,
                                                                  DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3)
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- (DATA_V_MALE$SES_2015 - DATA_D_MALE_SES_2014_T4) ** 3
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- ifelse(DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <= 0,
                                                                  0,
                                                                  DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3)
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- (DATA_V_MALE$SES_2015 - DATA_D_MALE_SES_2014_T5) ** 3
DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- ifelse(DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <= 0,
                                                                  0,
                                                                  DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3)

DATA_V_MALE_SES_2015_TAU <- (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) ** 2

DATA_V_MALE$SES_2015_RCS5K_1 <- DATA_V_MALE$SES_2015 / DATA_V_MALE_SES_2015_TAU
DATA_V_MALE$SES_2015_RCS5K_2 <- (DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 - DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_V_MALE_SES_2015_TAU
DATA_V_MALE$SES_2015_RCS5K_3 <- (DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 - DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_V_MALE_SES_2015_TAU
DATA_V_MALE$SES_2015_RCS5K_4 <- (DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 - DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + DATA_V_MALE_SES_2015_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / DATA_V_MALE_SES_2015_TAU

DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_V_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 3
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3)
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_V_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T2) ** 3
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3)
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_V_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T3) ** 3
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3)
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_V_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T4) ** 3
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3)
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_V_MALE$PC_PM25_2015_STD - DATA_D_MALE_PC_PM25_2014_STD_T5) ** 3
DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                  0,
                                                                                  DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3)

DATA_V_MALE_PC_PM25_2015_STD_TAU <- (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 2

DATA_V_MALE$PC_PM25_2015_STD_RCS5K_1 <- DATA_V_MALE$PC_PM25_2015_STD / DATA_V_MALE_PC_PM25_2015_STD_TAU
DATA_V_MALE$PC_PM25_2015_STD_RCS5K_2 <- (DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 - DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_V_MALE_PC_PM25_2015_STD_TAU
DATA_V_MALE$PC_PM25_2015_STD_RCS5K_3 <- (DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 - DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_V_MALE_PC_PM25_2015_STD_TAU
DATA_V_MALE$PC_PM25_2015_STD_RCS5K_4 <- (DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 - DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + DATA_V_MALE_PC_PM25_2015_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / DATA_V_MALE_PC_PM25_2015_STD_TAU

write.csv(...)

## DATA_V_FEMALE ----

DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- (DATA_V_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T1) ** 3
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <- ifelse(DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 <= 0,
                                                                    0,
                                                                    DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3)
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- (DATA_V_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T2) ** 3
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <- ifelse(DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 <= 0,
                                                                    0,
                                                                    DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3)
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- (DATA_V_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T3) ** 3
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <- ifelse(DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 <= 0,
                                                                    0,
                                                                    DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3)
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- (DATA_V_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T4) ** 3
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <- ifelse(DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 <= 0,
                                                                    0,
                                                                    DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3)
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- (DATA_V_FEMALE$AGE_STD - DATA_D_FEMALE_AGE_STD_T5) ** 3
DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <- ifelse(DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3 <= 0,
                                                                    0,
                                                                    DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3)

DATA_V_FEMALE_AGE_STD_TAU <- (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) ** 2

DATA_V_FEMALE$AGE_STD_RCS5K_1 <- DATA_V_FEMALE$AGE_STD / DATA_V_FEMALE_AGE_STD_TAU
DATA_V_FEMALE$AGE_STD_RCS5K_2 <- (DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T1_TRP3 - DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T1) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_V_FEMALE_AGE_STD_TAU
DATA_V_FEMALE$AGE_STD_RCS5K_3 <- (DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T2_TRP3 - DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T2) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_V_FEMALE_AGE_STD_TAU
DATA_V_FEMALE$AGE_STD_RCS5K_4 <- (DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T3_TRP3 - DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T4_TRP3 * (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4) + DATA_V_FEMALE_AGE_STD_MINUS_DATA_D_FEMALE_AGE_STD_T5_TRP3  * (DATA_D_FEMALE_AGE_STD_T4 - DATA_D_FEMALE_AGE_STD_T3) / (DATA_D_FEMALE_AGE_STD_T5 - DATA_D_FEMALE_AGE_STD_T4)) / DATA_V_FEMALE_AGE_STD_TAU

DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- (DATA_V_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T1) ** 3
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <- ifelse(DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 <= 0,
                                                                      0,
                                                                      DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3)
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- (DATA_V_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T2) ** 3
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <- ifelse(DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 <= 0,
                                                                      0,
                                                                      DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3)
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- (DATA_V_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T3) ** 3
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <- ifelse(DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 <= 0,
                                                                      0,
                                                                      DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3)
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- (DATA_V_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T4) ** 3
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <- ifelse(DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 <= 0,
                                                                      0,
                                                                      DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3)
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- (DATA_V_FEMALE$SES_2015 - DATA_D_FEMALE_SES_2014_T5) ** 3
DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <- ifelse(DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3 <= 0,
                                                                      0,
                                                                      DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3)

DATA_V_FEMALE_SES_2015_TAU <- (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) ** 2

DATA_V_FEMALE$SES_2015_RCS5K_1 <- DATA_V_FEMALE$SES_2015 / DATA_V_FEMALE_SES_2015_TAU
DATA_V_FEMALE$SES_2015_RCS5K_2 <- (DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T1_TRP3 - DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T1) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_V_FEMALE_SES_2015_TAU
DATA_V_FEMALE$SES_2015_RCS5K_3 <- (DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T2_TRP3 - DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T2) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_V_FEMALE_SES_2015_TAU
DATA_V_FEMALE$SES_2015_RCS5K_4 <- (DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T3_TRP3 - DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T4_TRP3 * (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4) + DATA_V_FEMALE_SES_2015_MINUS_DATA_D_FEMALE_SES_2014_T5_TRP3  * (DATA_D_FEMALE_SES_2014_T4 - DATA_D_FEMALE_SES_2014_T3) / (DATA_D_FEMALE_SES_2014_T5 - DATA_D_FEMALE_SES_2014_T4)) / DATA_V_FEMALE_SES_2015_TAU

DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- (DATA_V_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 3
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3)
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- (DATA_V_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T2) ** 3
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3)
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- (DATA_V_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T3) ** 3
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3)
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- (DATA_V_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T4) ** 3
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3)
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- (DATA_V_FEMALE$PC_PM25_2015_STD - DATA_D_FEMALE_PC_PM25_2014_STD_T5) ** 3
DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                                      0,
                                                                                      DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3)

DATA_V_FEMALE_PC_PM25_2015_STD_TAU <- (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) ** 2

DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_1 <- DATA_V_FEMALE$PC_PM25_2015_STD / DATA_V_FEMALE_PC_PM25_2015_STD_TAU
DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_2 <- (DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T1_TRP3 - DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T1) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_V_FEMALE_PC_PM25_2015_STD_TAU
DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_3 <- (DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T2_TRP3 - DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T2) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_V_FEMALE_PC_PM25_2015_STD_TAU
DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_4 <- (DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T3_TRP3 - DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4) + DATA_V_FEMALE_PC_PM25_2015_STD_MINUS_DATA_D_FEMALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_FEMALE_PC_PM25_2014_STD_T4 - DATA_D_FEMALE_PC_PM25_2014_STD_T3) / (DATA_D_FEMALE_PC_PM25_2014_STD_T5 - DATA_D_FEMALE_PC_PM25_2014_STD_T4)) / DATA_V_FEMALE_PC_PM25_2015_STD_TAU

write.csv(...)

# Models ----

## MALE_SDH_1 ----

MALE_SDH_1 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_1

saveRDS(...)

## MALE_SDH_2 ----

MALE_SDH_2 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_2

saveRDS(...)

## MALE_SDH_3 ----

MALE_SDH_3 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_3

saveRDS(...)

## MALE_SDH_4 ----

MALE_SDH_4 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_4

saveRDS(...)

## MALE_SDH_5 ----

MALE_SDH_5 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_5

saveRDS(...)

## MALE_SDH_6 ----

MALE_SDH_6 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_6

saveRDS(...)

## MALE_SDH_7 ----

MALE_SDH_7 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_SDH_7

saveRDS(...)

## MALE_SDH_8 ----

MALE_SDH_8 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    SES_2014_RCS5K_2 +
                    SES_2014_RCS5K_3 +
                    SES_2014_RCS5K_4 +
                    PC_PM25_2014_STD +
                    PC_PM25_2014_STD_RCS5K_2 +
                    PC_PM25_2014_STD_RCS5K_3 +
                    PC_PM25_2014_STD_RCS5K_4,
                  data = DATA_D_MALE,
                  cause = "1")
MALE_SDH_8

saveRDS(...)

## MALE_CSC_1 ----

MALE_CSC_1 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_1

saveRDS(...)

## MALE_CSC_2 ----

MALE_CSC_2 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_2

saveRDS(...)

## MALE_CSC_3 ----

MALE_CSC_3 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_3

saveRDS(...)

## MALE_CSC_4 ----

MALE_CSC_4 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_4

saveRDS(...)

## MALE_CSC_5 ----

MALE_CSC_5 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_5

saveRDS(...)

## MALE_CSC_6 ----

MALE_CSC_6 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_6

saveRDS(...)

## MALE_CSC_7 ----

MALE_CSC_7 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_MALE, 
                  cause = "1")
MALE_CSC_7

saveRDS(...)

## MALE_CSC_8 ----

MALE_CSC_8 <- CSC(Hist(TIME, EVENT) ~ 
                     AGE_STD +
                     AGE_STD_RCS5K_2 +
                     AGE_STD_RCS5K_3 +
                     AGE_STD_RCS5K_4 + 
                     SES_2014 +
                     SES_2014_RCS5K_2 +
                     SES_2014_RCS5K_3 +
                     SES_2014_RCS5K_4 +
                     PC_PM25_2014_STD +
                     PC_PM25_2014_STD_RCS5K_2 +
                     PC_PM25_2014_STD_RCS5K_3 +
                     PC_PM25_2014_STD_RCS5K_4,
                   data = DATA_D_MALE,
                   cause = "1")
MALE_CSC_8

saveRDS(...)

## FEMALE_SDH_1 ----

FEMALE_SDH_1 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_1

saveRDS(...)

## FEMALE_SDH_2 ----

FEMALE_SDH_2 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_2

saveRDS(...)

## FEMALE_SDH_3 ----

FEMALE_SDH_3 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_3

saveRDS(...)

## FEMALE_SDH_4 ----

FEMALE_SDH_4 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_4

saveRDS(...)

## FEMALE_SDH_5 ----

FEMALE_SDH_5 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_5

saveRDS(...)

## FEMALE_SDH_6 ----

FEMALE_SDH_6 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_6

saveRDS(...)

## FEMALE_SDH_7 ----

FEMALE_SDH_7 <- FGR(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_SDH_7

saveRDS(...)

## FEMALE_SDH_8 ----

FEMALE_SDH_8 <- FGR(Hist(TIME, EVENT) ~ 
                     AGE_STD +
                     AGE_STD_RCS5K_2 +
                     AGE_STD_RCS5K_3 +
                     AGE_STD_RCS5K_4 + 
                     SES_2014 +
                     SES_2014_RCS5K_2 +
                     SES_2014_RCS5K_3 +
                     SES_2014_RCS5K_4 +
                     PC_PM25_2014_STD +
                     PC_PM25_2014_STD_RCS5K_2 +
                     PC_PM25_2014_STD_RCS5K_3 +
                     PC_PM25_2014_STD_RCS5K_4,
                   data = DATA_D_FEMALE,
                   cause = "1")
FEMALE_SDH_8

saveRDS(...)

## FEMALE_CSC_1 ----

FEMALE_CSC_1 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_1

saveRDS(...)

## FEMALE_CSC_2 ----

FEMALE_CSC_2 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_2

saveRDS(...)

## FEMALE_CSC_3 ----

FEMALE_CSC_3 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_3

saveRDS(...)

## FEMALE_CSC_4 ----

FEMALE_CSC_4 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_4

saveRDS(...)

## FEMALE_CSC_5 ----

FEMALE_CSC_5 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_5

saveRDS(...)

## FEMALE_CSC_6 ----

FEMALE_CSC_6 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_6

saveRDS(...)

## FEMALE_CSC_7 ----

FEMALE_CSC_7 <- CSC(Hist(TIME, EVENT) ~ 
                    AGE_STD +
                    AGE_STD_RCS5K_2 +
                    AGE_STD_RCS5K_3 +
                    AGE_STD_RCS5K_4 + 
                    SES_2014 +
                    PC_PM25_2014_STD,
                  data = DATA_D_FEMALE, 
                  cause = "1")
FEMALE_CSC_7

saveRDS(...)

## FEMALE_CSC_8 ----

FEMALE_CSC_8 <- CSC(Hist(TIME, EVENT) ~ 
                     AGE_STD +
                     AGE_STD_RCS5K_2 +
                     AGE_STD_RCS5K_3 +
                     AGE_STD_RCS5K_4 + 
                     SES_2014 +
                     SES_2014_RCS5K_2 +
                     SES_2014_RCS5K_3 +
                     SES_2014_RCS5K_4 +
                     PC_PM25_2014_STD +
                     PC_PM25_2014_STD_RCS5K_2 +
                     PC_PM25_2014_STD_RCS5K_3 +
                     PC_PM25_2014_STD_RCS5K_4,
                   data = DATA_D_FEMALE,
                   cause = "1")
FEMALE_CSC_8

saveRDS(...)

# Discrimination ----

## V_MALE_SDH_AUC ----

V_MALE_SDH_AUC <- Score(list(MALE_SDH_1,
                             MALE_SDH_2,
                             MALE_SDH_3,
                             MALE_SDH_4,
                             MALE_SDH_5,
                             MALE_SDH_6,
                             MALE_SDH_7,
                             MALE_SDH_8),
                        formula = Hist(TIME, EVENT) ~ 1,
                        data = data.frame(TIME = DATA_V_MALE$TIME,
                                          EVENT = DATA_V_MALE$EVENT,
                                          AGE_STD = DATA_V_MALE$AGE_STD,
                                          AGE_STD_RCS5K_1 = DATA_V_MALE$AGE_STD_RCS5K_1,
                                          AGE_STD_RCS5K_2 = DATA_V_MALE$AGE_STD_RCS5K_2,
                                          AGE_STD_RCS5K_3 = DATA_V_MALE$AGE_STD_RCS5K_3,
                                          AGE_STD_RCS5K_4 = DATA_V_MALE$AGE_STD_RCS5K_4,
                                          SES_2014 = DATA_V_MALE$SES_2015,
                                          SES_2014_RCS5K_1 = DATA_V_MALE$SES_2015_RCS5K_1,
                                          SES_2014_RCS5K_2 = DATA_V_MALE$SES_2015_RCS5K_2,
                                          SES_2014_RCS5K_3 = DATA_V_MALE$SES_2015_RCS5K_3,
                                          SES_2014_RCS5K_4 = DATA_V_MALE$SES_2015_RCS5K_4,
                                          PC_PM25_2014_STD = DATA_V_MALE$PC_PM25_2015_STD,
                                          PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_1,
                                          PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_2,
                                          PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_3,
                                          PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_4),
                        metrics = "AUC",
                        cause = 1,
                        times = seq(1, 4, 1/12),
                        se.fit = FALSE)

round(subset(as.data.frame(V_MALE_SDH_AUC[["AUC"]][["score"]]), times == 1)[, "AUC"], 4)
round(subset(as.data.frame(V_MALE_SDH_AUC[["AUC"]][["score"]]), times == 2)[, "AUC"], 4)
round(subset(as.data.frame(V_MALE_SDH_AUC[["AUC"]][["score"]]), times == 3)[, "AUC"], 4)
round(subset(as.data.frame(V_MALE_SDH_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## V_MALE_CSC_AUC ----

V_MALE_CSC_AUC <- Score(list(MALE_CSC_1,
                             MALE_CSC_2,
                             MALE_CSC_3,
                             MALE_CSC_4,
                             MALE_CSC_5,
                             MALE_CSC_6,
                             MALE_CSC_7,
                             MALE_CSC_8),
                        formula = Hist(TIME, EVENT) ~ 1,
                        data = data.frame(TIME = DATA_V_MALE$TIME,
                                          EVENT = DATA_V_MALE$EVENT,
                                          AGE_STD = DATA_V_MALE$AGE_STD,
                                          AGE_STD_RCS5K_1 = DATA_V_MALE$AGE_STD_RCS5K_1,
                                          AGE_STD_RCS5K_2 = DATA_V_MALE$AGE_STD_RCS5K_2,
                                          AGE_STD_RCS5K_3 = DATA_V_MALE$AGE_STD_RCS5K_3,
                                          AGE_STD_RCS5K_4 = DATA_V_MALE$AGE_STD_RCS5K_4,
                                          SES_2014 = DATA_V_MALE$SES_2015,
                                          SES_2014_RCS5K_1 = DATA_V_MALE$SES_2015_RCS5K_1,
                                          SES_2014_RCS5K_2 = DATA_V_MALE$SES_2015_RCS5K_2,
                                          SES_2014_RCS5K_3 = DATA_V_MALE$SES_2015_RCS5K_3,
                                          SES_2014_RCS5K_4 = DATA_V_MALE$SES_2015_RCS5K_4,
                                          PC_PM25_2014_STD = DATA_V_MALE$PC_PM25_2015_STD,
                                          PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_1,
                                          PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_2,
                                          PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_3,
                                          PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_4),
                        metrics = "AUC",
                        cause = 1,
                        times = seq(1, 4, 1/12),
                        se.fit = FALSE)

round(subset(as.data.frame(V_MALE_CSC_AUC[["AUC"]][["score"]]), times == 1)[, "AUC"], 4)
round(subset(as.data.frame(V_MALE_CSC_AUC[["AUC"]][["score"]]), times == 2)[, "AUC"], 4)
round(subset(as.data.frame(V_MALE_CSC_AUC[["AUC"]][["score"]]), times == 3)[, "AUC"], 4)
round(subset(as.data.frame(V_MALE_CSC_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## V_FEMALE_SDH_AUC ----

V_FEMALE_SDH_AUC <- Score(list(FEMALE_SDH_1,
                               FEMALE_SDH_2,
                               FEMALE_SDH_3,
                               FEMALE_SDH_4,
                               FEMALE_SDH_5,
                               FEMALE_SDH_6,
                               FEMALE_SDH_7,
                               FEMALE_SDH_8),
                          formula = Hist(TIME, EVENT) ~ 1,
                          data = data.frame(TIME = DATA_V_FEMALE$TIME,
                                            EVENT = DATA_V_FEMALE$EVENT,
                                            AGE_STD = DATA_V_FEMALE$AGE_STD,
                                            AGE_STD_RCS5K_1 = DATA_V_FEMALE$AGE_STD_RCS5K_1,
                                            AGE_STD_RCS5K_2 = DATA_V_FEMALE$AGE_STD_RCS5K_2,
                                            AGE_STD_RCS5K_3 = DATA_V_FEMALE$AGE_STD_RCS5K_3,
                                            AGE_STD_RCS5K_4 = DATA_V_FEMALE$AGE_STD_RCS5K_4,
                                            SES_2014 = DATA_V_FEMALE$SES_2015,
                                            SES_2014_RCS5K_1 = DATA_V_FEMALE$SES_2015_RCS5K_1,
                                            SES_2014_RCS5K_2 = DATA_V_FEMALE$SES_2015_RCS5K_2,
                                            SES_2014_RCS5K_3 = DATA_V_FEMALE$SES_2015_RCS5K_3,
                                            SES_2014_RCS5K_4 = DATA_V_FEMALE$SES_2015_RCS5K_4,
                                            PC_PM25_2014_STD = DATA_V_FEMALE$PC_PM25_2015_STD,
                                            PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_1,
                                            PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                                            PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                                            PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_4),
                          metrics = "AUC",
                          cause = 1,
                          times = seq(1, 4, 1/12),
                          se.fit = FALSE)

round(subset(as.data.frame(V_FEMALE_SDH_AUC[["AUC"]][["score"]]), times == 1)[, "AUC"], 4)
round(subset(as.data.frame(V_FEMALE_SDH_AUC[["AUC"]][["score"]]), times == 2)[, "AUC"], 4)
round(subset(as.data.frame(V_FEMALE_SDH_AUC[["AUC"]][["score"]]), times == 3)[, "AUC"], 4)
round(subset(as.data.frame(V_FEMALE_SDH_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## V_FEMALE_CSC_AUC ----

V_FEMALE_CSC_AUC <- Score(list(FEMALE_CSC_1,
                               FEMALE_CSC_2,
                               FEMALE_CSC_3,
                               FEMALE_CSC_4,
                               FEMALE_CSC_5,
                               FEMALE_CSC_6,
                               FEMALE_CSC_7,
                               FEMALE_CSC_8),
                          formula = Hist(TIME, EVENT) ~ 1,
                          data = data.frame(TIME = DATA_V_FEMALE$TIME,
                                            EVENT = DATA_V_FEMALE$EVENT,
                                            AGE_STD = DATA_V_FEMALE$AGE_STD,
                                            AGE_STD_RCS5K_1 = DATA_V_FEMALE$AGE_STD_RCS5K_1,
                                            AGE_STD_RCS5K_2 = DATA_V_FEMALE$AGE_STD_RCS5K_2,
                                            AGE_STD_RCS5K_3 = DATA_V_FEMALE$AGE_STD_RCS5K_3,
                                            AGE_STD_RCS5K_4 = DATA_V_FEMALE$AGE_STD_RCS5K_4,
                                            SES_2014 = DATA_V_FEMALE$SES_2015,
                                            SES_2014_RCS5K_1 = DATA_V_FEMALE$SES_2015_RCS5K_1,
                                            SES_2014_RCS5K_2 = DATA_V_FEMALE$SES_2015_RCS5K_2,
                                            SES_2014_RCS5K_3 = DATA_V_FEMALE$SES_2015_RCS5K_3,
                                            SES_2014_RCS5K_4 = DATA_V_FEMALE$SES_2015_RCS5K_4,
                                            PC_PM25_2014_STD = DATA_V_FEMALE$PC_PM25_2015_STD,
                                            PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_1,
                                            PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                                            PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                                            PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_4),
                          metrics = "AUC",
                          cause = 1,
                          times = seq(1, 4, 1/12),
                          se.fit = FALSE)

round(subset(as.data.frame(V_FEMALE_CSC_AUC[["AUC"]][["score"]]), times == 1)[, "AUC"], 4)
round(subset(as.data.frame(V_FEMALE_CSC_AUC[["AUC"]][["score"]]), times == 2)[, "AUC"], 4)
round(subset(as.data.frame(V_FEMALE_CSC_AUC[["AUC"]][["score"]]), times == 3)[, "AUC"], 4)
round(subset(as.data.frame(V_FEMALE_CSC_AUC[["AUC"]][["score"]]), times == 4)[, "AUC"], 4)

saveRDS(...)

## FIG_V_AUC_WO_LEGEND & FIG_V_AUC_LEGEND ----

# FIG_V_MALE_SDH_AUC 

DATA_FIG_V_MALE_SDH_AUC <- as.data.frame(V_MALE_SDH_AUC[["AUC"]][["score"]])
colnames(DATA_FIG_V_MALE_SDH_AUC)[colnames(DATA_FIG_V_MALE_SDH_AUC) == "model"] <- "STRUCTURE"
colnames(DATA_FIG_V_MALE_SDH_AUC)[colnames(DATA_FIG_V_MALE_SDH_AUC) == "times"] <- "TIME"

FIG_V_MALE_SDH_AUC <- 
  ggplot(DATA_FIG_V_MALE_SDH_AUC, aes(x = TIME, 
                                      y = AUC, 
                                      colour = STRUCTURE)) +
  geom_line() +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.635, 0.665),
                     breaks = seq(0.64, 0.66, 0.01),
                     labels = format(seq(0.64, 0.66, 0.01), digits = 3)) +
  scale_colour_manual(name = "Model structure",
                      values = c("FGR" = "black",
                                 "FGR.1" = "green",
                                 "FGR.2" = "lightskyblue",
                                 "FGR.3" = "orange",
                                 "FGR.4" = "green4",
                                 "FGR.5" = "blue",
                                 "FGR.6" = "red",
                                 "FGR.7" = "violet"),
                      labels = c("FGR" = "age",
                                 "FGR.1" = "age + SES",
                                 "FGR.2" = "age + PM",
                                 "FGR.3" = "age + SES + PM",
                                 "FGR.4" = "rcs(age, 5) + SES",
                                 "FGR.5" = "rcs(age, 5) + PM",
                                 "FGR.6" = "rcs(age, 5) + SES + PM",
                                 "FGR.7" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(legend.position = "none")

# FIG_V_MALE_CSC_AUC 

DATA_FIG_V_MALE_CSC_AUC <- as.data.frame(V_MALE_CSC_AUC[["AUC"]][["score"]])
colnames(DATA_FIG_V_MALE_CSC_AUC)[colnames(DATA_FIG_V_MALE_CSC_AUC) == "model"] <- "STRUCTURE"
colnames(DATA_FIG_V_MALE_CSC_AUC)[colnames(DATA_FIG_V_MALE_CSC_AUC) == "times"] <- "TIME"

FIG_V_MALE_CSC_AUC <- 
  ggplot(DATA_FIG_V_MALE_CSC_AUC, aes(x = TIME, 
                                      y = AUC, 
                                      colour = STRUCTURE)) +
  geom_line() +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.635, 0.665),
                     breaks = seq(0.64, 0.66, 0.01),
                     labels = format(seq(0.64, 0.66, 0.01), digits = 3)) +
  scale_colour_manual(name = "Model structure",
                      values = c("CauseSpecificCox" = "black",
                                 "CauseSpecificCox.1" = "green",
                                 "CauseSpecificCox.2" = "lightskyblue",
                                 "CauseSpecificCox.3" = "orange",
                                 "CauseSpecificCox.4" = "green4",
                                 "CauseSpecificCox.5" = "blue",
                                 "CauseSpecificCox.6" = "red",
                                 "CauseSpecificCox.7" = "violet"),
                      labels = c("CauseSpecificCox" = "age",
                                 "CauseSpecificCox.1" = "age + SES",
                                 "CauseSpecificCox.2" = "age + PM",
                                 "CauseSpecificCox.3" = "age + SES + PM",
                                 "CauseSpecificCox.4" = "rcs(age, 5) + SES",
                                 "CauseSpecificCox.5" = "rcs(age, 5) + PM",
                                 "CauseSpecificCox.6" = "rcs(age, 5) + SES + PM",
                                 "CauseSpecificCox.7" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(legend.position = "none")

# FIG_V_FEMALE_SDH_AUC 

DATA_FIG_V_FEMALE_SDH_AUC <- as.data.frame(V_FEMALE_SDH_AUC[["AUC"]][["score"]])
colnames(DATA_FIG_V_FEMALE_SDH_AUC)[colnames(DATA_FIG_V_FEMALE_SDH_AUC) == "model"] <- "STRUCTURE"
colnames(DATA_FIG_V_FEMALE_SDH_AUC)[colnames(DATA_FIG_V_FEMALE_SDH_AUC) == "times"] <- "TIME"

FIG_V_FEMALE_SDH_AUC <- 
  ggplot(DATA_FIG_V_FEMALE_SDH_AUC, aes(x = TIME, 
                                        y = AUC, 
                                        colour = STRUCTURE)) +
  geom_line() +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.655, 0.685),
                     breaks = seq(0.66, 0.68, 0.01),
                     labels = format(seq(0.66, 0.68, 0.01), digits = 3)) +  
  scale_colour_manual(name = "Model structure",
                      values = c("FGR" = "black",
                                 "FGR.1" = "green",
                                 "FGR.2" = "lightskyblue",
                                 "FGR.3" = "orange",
                                 "FGR.4" = "green4",
                                 "FGR.5" = "blue",
                                 "FGR.6" = "red",
                                 "FGR.7" = "violet"),
                      labels = c("FGR" = "age",
                                 "FGR.1" = "age + SES",
                                 "FGR.2" = "age + PM",
                                 "FGR.3" = "age + SES + PM",
                                 "FGR.4" = "rcs(age, 5) + SES",
                                 "FGR.5" = "rcs(age, 5) + PM",
                                 "FGR.6" = "rcs(age, 5) + SES + PM",
                                 "FGR.7" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "none")

# FIG_V_FEMALE_CSC_AUC 

DATA_FIG_V_FEMALE_CSC_AUC <- as.data.frame(V_FEMALE_CSC_AUC[["AUC"]][["score"]])
colnames(DATA_FIG_V_FEMALE_CSC_AUC)[colnames(DATA_FIG_V_FEMALE_CSC_AUC) == "model"] <- "STRUCTURE"
colnames(DATA_FIG_V_FEMALE_CSC_AUC)[colnames(DATA_FIG_V_FEMALE_CSC_AUC) == "times"] <- "TIME"

FIG_V_FEMALE_CSC_AUC <- 
  ggplot(DATA_FIG_V_FEMALE_CSC_AUC, aes(x = TIME, 
                                        y = AUC, 
                                        colour = STRUCTURE)) +
  geom_line() +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.655, 0.685),
                     breaks = seq(0.64, 0.68, 0.01),
                     labels = format(seq(0.64, 0.68, 0.01), digits = 3)) +
  scale_colour_manual(name = "Model structure",
                      values = c("CauseSpecificCox" = "black",
                                 "CauseSpecificCox.1" = "green",
                                 "CauseSpecificCox.2" = "lightskyblue",
                                 "CauseSpecificCox.3" = "orange",
                                 "CauseSpecificCox.4" = "green4",
                                 "CauseSpecificCox.5" = "blue",
                                 "CauseSpecificCox.6" = "red",
                                 "CauseSpecificCox.7" = "violet"),
                      labels = c("CauseSpecificCox" = "age",
                                 "CauseSpecificCox.1" = "age + SES",
                                 "CauseSpecificCox.2" = "age + PM",
                                 "CauseSpecificCox.3" = "age + SES + PM",
                                 "CauseSpecificCox.4" = "rcs(age, 5) + SES",
                                 "CauseSpecificCox.5" = "rcs(age, 5) + PM",
                                 "CauseSpecificCox.6" = "rcs(age, 5) + SES + PM",
                                 "CauseSpecificCox.7" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(legend.position = "none")

# FIG_V_AUC_WO_LEGEND 

FIG_V_AUC_WO_LEGEND <- plot_grid(FIG_V_MALE_SDH_AUC, 
                                 FIG_V_MALE_CSC_AUC,
                                 FIG_V_FEMALE_SDH_AUC,
                                 FIG_V_FEMALE_CSC_AUC,
                                 labels = c("A",
                                            "B",
                                            "C",
                                            "D")) + 
                                  panel_border(color = "black")
FIG_V_AUC_WO_LEGEND

min(subset(DATA_FIG_V_MALE_SDH_AUC, STRUCTURE == "FGR.7")$AUC)
max(subset(DATA_FIG_V_MALE_SDH_AUC, STRUCTURE == "FGR.7")$AUC)

min(subset(DATA_FIG_V_FEMALE_SDH_AUC, STRUCTURE == "FGR.3")$AUC)
max(subset(DATA_FIG_V_FEMALE_SDH_AUC, STRUCTURE == "FGR.3")$AUC)

# FIG_V_AUC_LEGEND

FIG_V_AUC_LEGEND <- 
  ggplot(DATA_FIG_V_MALE_SDH_AUC, aes(x = TIME, 
                                      y = AUC, 
                                      colour = STRUCTURE)) +
  geom_line() +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.635, 0.665),
                     breaks = seq(0.64, 0.66, 0.01),
                     labels = format(seq(0.64, 0.66, 0.01), digits = 3)) +
  scale_colour_manual(name = "Model structure",
                      values = c("FGR" = "black",
                                 "FGR.1" = "green",
                                 "FGR.2" = "lightskyblue",
                                 "FGR.3" = "orange",
                                 "FGR.4" = "green4",
                                 "FGR.5" = "blue",
                                 "FGR.6" = "red",
                                 "FGR.7" = "violet"),
                      labels = c("FGR" = "age",
                                 "FGR.1" = "age + SES",
                                 "FGR.2" = "age + PM",
                                 "FGR.3" = "age + SES + PM",
                                 "FGR.4" = "rcs(age, 5) + SES",
                                 "FGR.5" = "rcs(age, 5) + PM",
                                 "FGR.6" = "rcs(age, 5) + SES + PM",
                                 "FGR.7" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() 

FIG_V_AUC_LEGEND <- get_legend(FIG_V_AUC_LEGEND)

FIG_V_AUC_LEGEND <- plot_grid(FIG_V_AUC_LEGEND,
                              labels = "Legend") + 
                              panel_border(color = "black")

FIG_V_AUC_LEGEND <- plot_grid(FIG_V_AUC_LEGEND) 
FIG_V_AUC_LEGEND

# Calibration ----

## V_MALE_SDH_EO ----

STRUCTURE <-  c("MALE_SDH_1",
                "MALE_SDH_2",
                "MALE_SDH_3",
                "MALE_SDH_4",
                "MALE_SDH_5",
                "MALE_SDH_6",
                "MALE_SDH_7",
                "MALE_SDH_8")
TIME <- seq(1, 4, 1/12)
V_MALE_SDH_EO <- as.data.frame(matrix(nrow = 0,
                                      ncol = 4))
colnames(V_MALE_SDH_EO) <- c("STRUCTURE",
                             "TIME",
                             "MEAN_PRED_RISK",
                             "AJ")
for(s in STRUCTURE) {
  for (t in TIME) {
    TEMP_DATA <- data.frame(TIME = DATA_V_MALE$TIME,
                            EVENT = DATA_V_MALE$EVENT,
                            AGE_STD = DATA_V_MALE$AGE_STD,
                            AGE_STD_RCS5K_1 = DATA_V_MALE$AGE_STD_RCS5K_1,
                            AGE_STD_RCS5K_2 = DATA_V_MALE$AGE_STD_RCS5K_2,
                            AGE_STD_RCS5K_3 = DATA_V_MALE$AGE_STD_RCS5K_3,
                            AGE_STD_RCS5K_4 = DATA_V_MALE$AGE_STD_RCS5K_4,
                            SES_2014 = DATA_V_MALE$SES_2015,
                            SES_2014_RCS5K_1 = DATA_V_MALE$SES_2015_RCS5K_1,
                            SES_2014_RCS5K_2 = DATA_V_MALE$SES_2015_RCS5K_2,
                            SES_2014_RCS5K_3 = DATA_V_MALE$SES_2015_RCS5K_3,
                            SES_2014_RCS5K_4 = DATA_V_MALE$SES_2015_RCS5K_4,
                            PC_PM25_2014_STD = DATA_V_MALE$PC_PM25_2015_STD,
                            PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_1,
                            PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_2,
                            PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_3,
                            PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_4)
    
    TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                       TEMP_DATA,
                                       times = t,
                                       cause = 1)
    
    TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)

    TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                      fstatus = TEMP_DATA$EVENT,
                      cencode = 0)
    TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
  
    TEMP_V_MALE_SDH_EO <- data.frame(STRUCTURE = s,
                                     TIME = t,
                                     MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                     AJ = TEMP_AJ_TIMEPOINT)
    
    V_MALE_SDH_EO <- rbind(V_MALE_SDH_EO,
                           TEMP_V_MALE_SDH_EO)
  }
}

saveRDS(...)

## V_MALE_CSC_EO ----

STRUCTURE <-  c("MALE_CSC_1",
                "MALE_CSC_2",
                "MALE_CSC_3",
                "MALE_CSC_4",
                "MALE_CSC_5",
                "MALE_CSC_6",
                "MALE_CSC_7",
                "MALE_CSC_8")
TIME <- seq(1, 4, 1/12)
V_MALE_CSC_EO <- as.data.frame(matrix(nrow = 0,
                                      ncol = 4))
colnames(V_MALE_CSC_EO) <- c("STRUCTURE",
                             "TIME",
                             "MEAN_PRED_RISK",
                             "AJ")
for(s in STRUCTURE) {
  for (t in TIME) {
    TEMP_DATA <- data.frame(TIME = DATA_V_MALE$TIME,
                            EVENT = DATA_V_MALE$EVENT,
                            AGE_STD = DATA_V_MALE$AGE_STD,
                            AGE_STD_RCS5K_1 = DATA_V_MALE$AGE_STD_RCS5K_1,
                            AGE_STD_RCS5K_2 = DATA_V_MALE$AGE_STD_RCS5K_2,
                            AGE_STD_RCS5K_3 = DATA_V_MALE$AGE_STD_RCS5K_3,
                            AGE_STD_RCS5K_4 = DATA_V_MALE$AGE_STD_RCS5K_4,
                            SES_2014 = DATA_V_MALE$SES_2015,
                            SES_2014_RCS5K_1 = DATA_V_MALE$SES_2015_RCS5K_1,
                            SES_2014_RCS5K_2 = DATA_V_MALE$SES_2015_RCS5K_2,
                            SES_2014_RCS5K_3 = DATA_V_MALE$SES_2015_RCS5K_3,
                            SES_2014_RCS5K_4 = DATA_V_MALE$SES_2015_RCS5K_4,
                            PC_PM25_2014_STD = DATA_V_MALE$PC_PM25_2015_STD,
                            PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_1,
                            PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_2,
                            PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_3,
                            PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_4)
    
    TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                       TEMP_DATA,
                                       times = t,
                                       cause = 1)
    
    TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)
    
    TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                      fstatus = TEMP_DATA$EVENT,
                      cencode = 0)
    TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
    
    TEMP_V_MALE_CSC_EO <- data.frame(STRUCTURE = s,
                                     TIME = t,
                                     MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                     AJ = TEMP_AJ_TIMEPOINT)
    
    V_MALE_CSC_EO <- rbind(V_MALE_CSC_EO,
                           TEMP_V_MALE_CSC_EO)
  }
}

saveRDS(...)

## V_FEMALE_SDH_EO ----

STRUCTURE <-  c("FEMALE_SDH_1",
                "FEMALE_SDH_2",
                "FEMALE_SDH_3",
                "FEMALE_SDH_4",
                "FEMALE_SDH_5",
                "FEMALE_SDH_6",
                "FEMALE_SDH_7",
                "FEMALE_SDH_8")
TIME <- seq(1, 4, 1/12)
V_FEMALE_SDH_EO <- as.data.frame(matrix(nrow = 0,
                                        ncol = 4))
colnames(V_FEMALE_SDH_EO) <- c("STRUCTURE",
                               "TIME",
                               "MEAN_PRED_RISK",
                               "AJ")
for(s in STRUCTURE) {
  for (t in TIME) {
    TEMP_DATA <- data.frame(TIME = DATA_V_FEMALE$TIME,
                            EVENT = DATA_V_FEMALE$EVENT,
                            AGE_STD = DATA_V_FEMALE$AGE_STD,
                            AGE_STD_RCS5K_1 = DATA_V_FEMALE$AGE_STD_RCS5K_1,
                            AGE_STD_RCS5K_2 = DATA_V_FEMALE$AGE_STD_RCS5K_2,
                            AGE_STD_RCS5K_3 = DATA_V_FEMALE$AGE_STD_RCS5K_3,
                            AGE_STD_RCS5K_4 = DATA_V_FEMALE$AGE_STD_RCS5K_4,
                            SES_2014 = DATA_V_FEMALE$SES_2015,
                            SES_2014_RCS5K_1 = DATA_V_FEMALE$SES_2015_RCS5K_1,
                            SES_2014_RCS5K_2 = DATA_V_FEMALE$SES_2015_RCS5K_2,
                            SES_2014_RCS5K_3 = DATA_V_FEMALE$SES_2015_RCS5K_3,
                            SES_2014_RCS5K_4 = DATA_V_FEMALE$SES_2015_RCS5K_4,
                            PC_PM25_2014_STD = DATA_V_FEMALE$PC_PM25_2015_STD,
                            PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_1,
                            PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                            PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                            PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_4)
    
    TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                       TEMP_DATA,
                                       times = t,
                                       cause = 1)
    
    TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)
    
    TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                      fstatus = TEMP_DATA$EVENT,
                      cencode = 0)
    TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
    
    TEMP_V_FEMALE_SDH_EO <- data.frame(STRUCTURE = s,
                                       TIME = t,
                                       MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                       AJ = TEMP_AJ_TIMEPOINT)
    
    V_FEMALE_SDH_EO <- rbind(V_FEMALE_SDH_EO,
                           TEMP_V_FEMALE_SDH_EO)
  }
}

saveRDS(...)

## V_FEMALE_CSC_EO ----

STRUCTURE <-  c("FEMALE_CSC_1",
                "FEMALE_CSC_2",
                "FEMALE_CSC_3",
                "FEMALE_CSC_4",
                "FEMALE_CSC_5",
                "FEMALE_CSC_6",
                "FEMALE_CSC_7",
                "FEMALE_CSC_8")
TIME <- seq(1, 4, 1/12)
V_FEMALE_CSC_EO <- as.data.frame(matrix(nrow = 0,
                                        ncol = 4))
colnames(V_FEMALE_CSC_EO) <- c("STRUCTURE",
                               "TIME",
                               "MEAN_PRED_RISK",
                               "AJ")
for(s in STRUCTURE) {
  for (t in TIME) {
    TEMP_DATA <- data.frame(TIME = DATA_V_FEMALE$TIME,
                            EVENT = DATA_V_FEMALE$EVENT,
                            AGE_STD = DATA_V_FEMALE$AGE_STD,
                            AGE_STD_RCS5K_1 = DATA_V_FEMALE$AGE_STD_RCS5K_1,
                            AGE_STD_RCS5K_2 = DATA_V_FEMALE$AGE_STD_RCS5K_2,
                            AGE_STD_RCS5K_3 = DATA_V_FEMALE$AGE_STD_RCS5K_3,
                            AGE_STD_RCS5K_4 = DATA_V_FEMALE$AGE_STD_RCS5K_4,
                            SES_2014 = DATA_V_FEMALE$SES_2015,
                            SES_2014_RCS5K_1 = DATA_V_FEMALE$SES_2015_RCS5K_1,
                            SES_2014_RCS5K_2 = DATA_V_FEMALE$SES_2015_RCS5K_2,
                            SES_2014_RCS5K_3 = DATA_V_FEMALE$SES_2015_RCS5K_3,
                            SES_2014_RCS5K_4 = DATA_V_FEMALE$SES_2015_RCS5K_4,
                            PC_PM25_2014_STD = DATA_V_FEMALE$PC_PM25_2015_STD,
                            PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_1,
                            PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                            PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                            PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_4)
    
    TEMP_DATA$PRED_RISK <- predictRisk(get(s),                                           
                                       TEMP_DATA,
                                       times = t,
                                       cause = 1)
    
    TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)
    
    TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                      fstatus = TEMP_DATA$EVENT,
                      cencode = 0)
    TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
    
    TEMP_V_FEMALE_CSC_EO <- data.frame(STRUCTURE = s,
                                       TIME = t,
                                       MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                       AJ = TEMP_AJ_TIMEPOINT)
    
    V_FEMALE_CSC_EO <- rbind(V_FEMALE_CSC_EO,
                             TEMP_V_FEMALE_CSC_EO)
  }
}

saveRDS(...)

## FIG_V_EO_WO_LEGEND & FIG_V_EO_LEGEND ----

# FIG_V_MALE_SDH_EO 

FIG_V_MALE_SDH_EO <- 
  ggplot() +
  geom_line(data = V_MALE_SDH_EO, aes(x = MEAN_PRED_RISK, 
                                      y = AJ, 
                                      colour = STRUCTURE)) +
  geom_abline(intercept = 0, slope = 1) +
  geom_point(data = subset(V_MALE_SDH_EO, TIME == 1), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_MALE_SDH_EO, TIME == 2), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_MALE_SDH_EO, TIME == 3), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_MALE_SDH_EO, TIME == 4), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  annotate("text",
           x = 0.0091,
           y = 0.0070,
           label = "1 year") +
  annotate("text",
           x = 0.0155,
           y = 0.0149,
           label = "2 years") +
  annotate("text",
           x = 0.0223,
           y = 0.0231,
           label = "3 years") +
  annotate("text",
           x = 0.0309,
           y = 0.0311,
           label = "4 years") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.005, 0.033),
                     breaks = seq(0.005, 0.033, 0.001),
                     labels = format(seq(0.005, 0.033, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.005, 0.033),
                     breaks = seq(0.005, 0.033, 0.001),
                     labels = format(seq(0.005, 0.033, 0.001) * 100, digits = 1)) +
  scale_colour_manual(name = "Model structure",
                      values = c("MALE_SDH_1" = "black",
                                 "MALE_SDH_2" = "green",
                                 "MALE_SDH_3" = "lightskyblue",
                                 "MALE_SDH_4" = "orange",
                                 "MALE_SDH_5" = "green4",
                                 "MALE_SDH_6" = "blue",
                                 "MALE_SDH_7" = "red",
                                 "MALE_SDH_8" = "violet"),
                      labels = c("MALE_SDH_1" = "age",
                                 "MALE_SDH_2" = "age + SES",
                                 "MALE_SDH_3" = "age + PM",
                                 "MALE_SDH_4" = "age + SES + PM",
                                 "MALE_SDH_5" = "rcs(age, 5) + SES",
                                 "MALE_SDH_6" = "rcs(age, 5) + PM",
                                 "MALE_SDH_7" = "rcs(age, 5) + SES + PM",
                                 "MALE_SDH_8" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "none")

# FIG_V_MALE_CSC_EO 

FIG_V_MALE_CSC_EO <- 
  ggplot() +
  geom_line(data = V_MALE_CSC_EO, aes(x = MEAN_PRED_RISK, 
                                      y = AJ, 
                                      colour = STRUCTURE)) +
  geom_abline(intercept = 0, slope = 1) +
  geom_point(data = subset(V_MALE_CSC_EO, TIME == 1), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_MALE_CSC_EO, TIME == 2), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_MALE_CSC_EO, TIME == 3), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_MALE_CSC_EO, TIME == 4), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ, 
                                                          fill = STRUCTURE),
             shape = 23,
             size = 2) +
  annotate("text",
           x = 0.0091,
           y = 0.0070,
           label = "1 year") +
  annotate("text",
           x = 0.0155,
           y = 0.0149,
           label = "2 years") +
  annotate("text",
           x = 0.0223,
           y = 0.0231,
           label = "3 years") +
  annotate("text",
           x = 0.0309,
           y = 0.0311,
           label = "4 years") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.005, 0.033),
                     breaks = seq(0.005, 0.033, 0.001),
                     labels = format(seq(0.005, 0.033, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.005, 0.033),
                     breaks = seq(0.005, 0.033, 0.001),
                     labels = format(seq(0.005, 0.033, 0.001) * 100, digits = 1)) +
  scale_colour_manual(name = "Model structure",
                      values = c("MALE_CSC_1" = "black",
                                 "MALE_CSC_2" = "green",
                                 "MALE_CSC_3" = "lightskyblue",
                                 "MALE_CSC_4" = "orange",
                                 "MALE_CSC_5" = "green4",
                                 "MALE_CSC_6" = "blue",
                                 "MALE_CSC_7" = "red",
                                 "MALE_CSC_8" = "violet"),
                      labels = c("MALE_CSC_1" = "age",
                                 "MALE_CSC_2" = "age + SES",
                                 "MALE_CSC_3" = "age + PM",
                                 "MALE_CSC_4" = "age + SES + PM",
                                 "MALE_CSC_5" = "rcs(age, 5) + SES",
                                 "MALE_CSC_6" = "rcs(age, 5) + PM",
                                 "MALE_CSC_7" = "rcs(age, 5) + SES + PM",
                                 "MALE_CSC_8" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "none")

# FIG_V_FEMALE_SDH_EO 

FIG_V_FEMALE_SDH_EO <- 
  ggplot() +
  geom_line(data = V_FEMALE_SDH_EO, aes(x = MEAN_PRED_RISK, 
                                        y = AJ, 
                                        colour = STRUCTURE)) +
  geom_abline(intercept = 0, slope = 1) +
  geom_point(data = subset(V_FEMALE_SDH_EO, TIME == 1), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_FEMALE_SDH_EO, TIME == 2), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_FEMALE_SDH_EO, TIME == 3), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_FEMALE_SDH_EO, TIME == 4), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  annotate("text",
           x = 0.0037,
           y = 0.0030,
           label = "1 year") +
  annotate("text",
           x = 0.0075,
           y = 0.0063,
           label = "2 years") +
  annotate("text",
           x = 0.0110,
           y = 0.0099,
           label = "3 years") +
  annotate("text",
           x = 0.0150,
           y = 0.0142,
           label = "4 years") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.002, 0.015),
                     breaks = seq(0.002, 0.015, 0.001),
                     labels = format(seq(0.002, 0.015, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.002, 0.015),
                     breaks = seq(0.002, 0.015, 0.001),
                     labels = format(seq(0.002, 0.015, 0.001) * 100, digits = 1)) +
  scale_colour_manual(name = "Model structure",
                      values = c("FEMALE_SDH_1" = "black",
                                 "FEMALE_SDH_2" = "green",
                                 "FEMALE_SDH_3" = "lightskyblue",
                                 "FEMALE_SDH_4" = "orange",
                                 "FEMALE_SDH_5" = "green4",
                                 "FEMALE_SDH_6" = "blue",
                                 "FEMALE_SDH_7" = "red",
                                 "FEMALE_SDH_8" = "violet"),
                      labels = c("FEMALE_SDH_1" = "age",
                                 "FEMALE_SDH_2" = "age + SES",
                                 "FEMALE_SDH_3" = "age + PM",
                                 "FEMALE_SDH_4" = "age + SES + PM",
                                 "FEMALE_SDH_5" = "rcs(age, 5) + SES",
                                 "FEMALE_SDH_6" = "rcs(age, 5) + PM",
                                 "FEMALE_SDH_7" = "rcs(age, 5) + SES + PM",
                                 "FEMALE_SDH_8" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "none")

# FIG_V_FEMALE_CSC_EO 

FIG_V_FEMALE_CSC_EO <- 
  ggplot() +
  geom_line(data = V_FEMALE_CSC_EO, aes(x = MEAN_PRED_RISK, 
                                        y = AJ, 
                                        colour = STRUCTURE)) +
  geom_abline(intercept = 0, slope = 1) +
  geom_point(data = subset(V_FEMALE_CSC_EO, TIME == 1), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_FEMALE_CSC_EO, TIME == 2), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_FEMALE_CSC_EO, TIME == 3), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  geom_point(data = subset(V_FEMALE_CSC_EO, TIME == 4), aes(x = MEAN_PRED_RISK, 
                                                            y = AJ, 
                                                            fill = STRUCTURE),
             shape = 23,
             size = 2) +
  annotate("text",
           x = 0.0037,
           y = 0.0030,
           label = "1 year") +
  annotate("text",
           x = 0.0075,
           y = 0.0063,
           label = "2 years") +
  annotate("text",
           x = 0.0110,
           y = 0.0099,
           label = "3 years") +
  annotate("text",
           x = 0.0150,
           y = 0.0142,
           label = "4 years") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.002, 0.015),
                     breaks = seq(0.002, 0.015, 0.001),
                     labels = format(seq(0.002, 0.015, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.002, 0.015),
                     breaks = seq(0.002, 0.015, 0.001),
                     labels = format(seq(0.002, 0.015, 0.001) * 100, digits = 1)) +
  scale_colour_manual(name = "Model structure",
                      values = c("FEMALE_CSC_1" = "black",
                                 "FEMALE_CSC_2" = "green",
                                 "FEMALE_CSC_3" = "lightskyblue",
                                 "FEMALE_CSC_4" = "orange",
                                 "FEMALE_CSC_5" = "green4",
                                 "FEMALE_CSC_6" = "blue",
                                 "FEMALE_CSC_7" = "red",
                                 "FEMALE_CSC_8" = "violet"),
                      labels = c("FEMALE_CSC_1" = "age",
                                 "FEMALE_CSC_2" = "age + SES",
                                 "FEMALE_CSC_3" = "age + PM",
                                 "FEMALE_CSC_4" = "age + SES + PM",
                                 "FEMALE_CSC_5" = "rcs(age, 5) + SES",
                                 "FEMALE_CSC_6" = "rcs(age, 5) + PM",
                                 "FEMALE_CSC_7" = "rcs(age, 5) + SES + PM",
                                 "FEMALE_CSC_8" = "rcs(age, 5) + rcs(SES, 5) + rcs(PM, 5)")) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "none")

# FIG_V_EO_WO_LEGEND 

FIG_V_EO_WO_LEGEND <- plot_grid(FIG_V_MALE_SDH_EO, 
                                FIG_V_MALE_CSC_EO,
                                FIG_V_FEMALE_SDH_EO,
                                FIG_V_FEMALE_CSC_EO,
                                labels = c("A",
                                           "B",
                                           "C",
                                           "D")) + 
                                panel_border(color = "black")
FIG_V_EO_WO_LEGEND

min(abs(subset(V_MALE_SDH_EO, STRUCTURE == "MALE_SDH_8")$MEAN_PRED_RISK - subset(V_MALE_SDH_EO, STRUCTURE == "MALE_SDH_8")$AJ))
max(abs(subset(V_MALE_SDH_EO, STRUCTURE == "MALE_SDH_8")$MEAN_PRED_RISK - subset(V_MALE_SDH_EO, STRUCTURE == "MALE_SDH_8")$AJ))

min(abs(subset(V_FEMALE_SDH_EO, STRUCTURE == "FEMALE_SDH_4")$MEAN_PRED_RISK - subset(V_FEMALE_SDH_EO, STRUCTURE == "FEMALE_SDH_4")$AJ))
max(abs(subset(V_FEMALE_SDH_EO, STRUCTURE == "FEMALE_SDH_4")$MEAN_PRED_RISK - subset(V_FEMALE_SDH_EO, STRUCTURE == "FEMALE_SDH_4")$AJ))

# FIG_V_EO_LEGEND

FIG_V_EO_LEGEND <- FIG_V_AUC_LEGEND

## V_MALE_SDH_8_CALIBRATION_DECILE ----

TIME <- seq(1, 4, 1)
V_MALE_SDH_8_CALIBRATION_DECILE <- as.data.frame(matrix(nrow = 0,
                                                        ncol = 4))
colnames(V_MALE_SDH_8_CALIBRATION_DECILE) <- c("TIME",
                                               "DECILE",
                                               "MEAN_PRED_RISK",
                                               "AJ")
for (t in TIME) {
  TEMP <- as.data.frame(cbind(TIME = DATA_V_MALE$TIME,
                              EVENT = DATA_V_MALE$EVENT,
                              AGE_STD = DATA_V_MALE$AGE_STD,
                              AGE_STD_RCS5K_1 = DATA_V_MALE$AGE_STD_RCS5K_1,
                              AGE_STD_RCS5K_2 = DATA_V_MALE$AGE_STD_RCS5K_2,
                              AGE_STD_RCS5K_3 = DATA_V_MALE$AGE_STD_RCS5K_3,
                              AGE_STD_RCS5K_4 = DATA_V_MALE$AGE_STD_RCS5K_4,
                              SES_2014 = DATA_V_MALE$SES_2015,
                              SES_2014_RCS5K_1 = DATA_V_MALE$SES_2015_RCS5K_1,
                              SES_2014_RCS5K_2 = DATA_V_MALE$SES_2015_RCS5K_2,
                              SES_2014_RCS5K_3 = DATA_V_MALE$SES_2015_RCS5K_3,
                              SES_2014_RCS5K_4 = DATA_V_MALE$SES_2015_RCS5K_4,
                              PC_PM25_2014_STD = DATA_V_MALE$PC_PM25_2015_STD,
                              PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_1,
                              PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_2,
                              PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_3,
                              PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE$PC_PM25_2015_STD_RCS5K_4))
    
  TEMP$PRED_RISK <- predictRisk(MALE_SDH_8,
                                TEMP,
                                times = t,
                                cause = 1)
  
  TEMP$DECILE <- cut(TEMP$PRED_RISK,
                     breaks = quantile(TEMP$PRED_RISK, prob = seq(0, 1, 0.1)),
                     labels = c(1:10),
                     include.lowest = TRUE)
  
  DECILE_MEAN_PRED_RISK <- aggregate(TEMP$PRED_RISK,
                                     list(TEMP$DECILE),
                                     mean)
  colnames(DECILE_MEAN_PRED_RISK) <- c("DECILE",
                                       "MEAN_PRED_RISK")
  
  DECILE_AJ <- data.frame(DECILE = 1:10,
                          AJ = NA)
  for (i in 1:nrow(DECILE_AJ)) {
    TEMP_DECILE_AJ <- cuminc(ftime = subset(TEMP, DECILE == DECILE_AJ[i, "DECILE"])$TIME,
                             fstatus = subset(TEMP, DECILE == DECILE_AJ[i, "DECILE"])$EVENT,
                             cencode = 0)
    DECILE_AJ[i, "AJ"] <- timepoints(TEMP_DECILE_AJ, t)[[1]][[1]]
  }
  DECILE_MEAN_PRED_RISK_AJ <- merge(DECILE_MEAN_PRED_RISK,
                                    DECILE_AJ,
                                    by = "DECILE")
  DECILE_MEAN_PRED_RISK_AJ$DECILE <- as.numeric(DECILE_MEAN_PRED_RISK_AJ$DECILE)
  DECILE_MEAN_PRED_RISK_AJ <- DECILE_MEAN_PRED_RISK_AJ[order(DECILE_MEAN_PRED_RISK_AJ$DECILE), ]
  
  DECILE_MEAN_PRED_RISK_AJ$TIME <- t
  
  DECILE_MEAN_PRED_RISK_AJ <- DECILE_MEAN_PRED_RISK_AJ[, c("TIME",
                                                           "DECILE",
                                                           "MEAN_PRED_RISK",
                                                           "AJ")]
  
  V_MALE_SDH_8_CALIBRATION_DECILE <- rbind(V_MALE_SDH_8_CALIBRATION_DECILE,
                                           DECILE_MEAN_PRED_RISK_AJ)
}

max(V_MALE_SDH_8_CALIBRATION_DECILE$AJ - V_MALE_SDH_8_CALIBRATION_DECILE$MEAN_PRED_RISK)
max(V_MALE_SDH_8_CALIBRATION_DECILE$MEAN_PRED_RISK - V_MALE_SDH_8_CALIBRATION_DECILE$AJ)

saveRDS(...)

## FIG_V_MALE_SDH_8_CALIBRATION_DECILE_1Y_2Y_3Y_4Y ----

# FIG_V_MALE_SDH_8_CALIBRATION_DECILE_1Y

FIG_V_MALE_SDH_8_CALIBRATION_DECILE_1Y <-
  ggplot(subset(V_MALE_SDH_8_CALIBRATION_DECILE, TIME == 1), aes(x = MEAN_PRED_RISK,
                                                                 y = AJ)) +
  geom_abline() +
  geom_point(colour = "violet", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "violet") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.020),
                     breaks = seq(0.000, 0.020, 0.001),
                     labels = format(seq(0.000, 0.020, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.020),
                     breaks = seq(0.000, 0.020, 0.001),
                     labels = format(seq(0.000, 0.020, 0.001) * 100, digits = 1)) +
  
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

# FIG_V_MALE_SDH_8_CALIBRATION_DECILE_2Y

BREAKS <- seq(0.000, 0.035, 0.001) 
LABELS <- as.data.frame(BREAKS)
LABELS$DIVISION <- LABELS$BREAKS / 0.005
LABELS$LABELS <- ifelse((LABELS$DIVISION %% 1 < 1e-5),
                        format(BREAKS * 100, digits = 1),
                        "")

FIG_V_MALE_SDH_8_CALIBRATION_DECILE_2Y <-
  ggplot(subset(V_MALE_SDH_8_CALIBRATION_DECILE, TIME == 2), aes(x = MEAN_PRED_RISK,
                                                                 y = AJ)) +
  geom_abline() +
  geom_point(colour = "violet", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "violet") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.035),
                     breaks = seq(0.000, 0.035, 0.001),
                     labels = LABELS$LABELS) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.035),
                     breaks = seq(0.000, 0.035, 0.001),
                     labels = LABELS$LABELS) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

# FIG_V_MALE_SDH_8_CALIBRATION_DECILE_3Y

BREAKS <- seq(0.000, 0.050, 0.001) 
LABELS <- as.data.frame(BREAKS)
LABELS$DIVISION <- LABELS$BREAKS / 0.005
LABELS$LABELS <- ifelse((LABELS$DIVISION %% 1 < 1e-5),
                        format(BREAKS * 100, digits = 1),
                        "")

FIG_V_MALE_SDH_8_CALIBRATION_DECILE_3Y <-
  ggplot(subset(V_MALE_SDH_8_CALIBRATION_DECILE, TIME == 3), aes(x = MEAN_PRED_RISK,
                                                                 y = AJ)) +
  geom_abline() +
  geom_point(colour = "violet", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "violet") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.050),
                     breaks = seq(0.000, 0.050, 0.001),
                     labels = LABELS$LABELS) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.050),
                     breaks = seq(0.000, 0.050, 0.001),
                     labels = LABELS$LABELS) +
  theme_minimal() +
  theme()

# FIG_V_MALE_SDH_8_CALIBRATION_DECILE_4Y

BREAKS <- seq(0.000, 0.065, 0.001) 
LABELS <- as.data.frame(BREAKS)
LABELS$DIVISION <- LABELS$BREAKS / 0.005
LABELS$LABELS <- ifelse((LABELS$DIVISION %% 1 < 1e-5),
                        format(BREAKS * 100, digits = 1),
                        "")

FIG_V_MALE_SDH_8_CALIBRATION_DECILE_4Y <-
  ggplot(subset(V_MALE_SDH_8_CALIBRATION_DECILE, TIME == 4), aes(x = MEAN_PRED_RISK,
                                                                 y = AJ)) +
  geom_abline() +
  geom_point(colour = "violet", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "violet") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.065),
                     breaks = seq(0.000, 0.065, 0.001),
                     labels = LABELS$LABELS) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.065),
                     breaks = seq(0.000, 0.065, 0.001),
                     labels = LABELS$LABELS) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

# FIG_V_MALE_SDH_8_CALIBRATION_DECILE_1Y_2Y_3Y_4Y 

FIG_V_MALE_SDH_8_CALIBRATION_DECILE_1Y_2Y_3Y_4Y <- plot_grid(FIG_V_MALE_SDH_8_CALIBRATION_DECILE_1Y,
                                                             FIG_V_MALE_SDH_8_CALIBRATION_DECILE_2Y,
                                                             FIG_V_MALE_SDH_8_CALIBRATION_DECILE_3Y,
                                                             FIG_V_MALE_SDH_8_CALIBRATION_DECILE_4Y, 
                                                             labels = c("A",
                                                                        "B",
                                                                        "C",
                                                                        "D")) + 
                                                             panel_border(color = "black")
FIG_V_MALE_SDH_8_CALIBRATION_DECILE_1Y_2Y_3Y_4Y

## V_FEMALE_SDH_4_CALIBRATION_DECILE ----

TIME <- seq(1, 4, 1)
V_FEMALE_SDH_4_CALIBRATION_DECILE <- as.data.frame(matrix(nrow = 0,
                                                        ncol = 4))
colnames(V_FEMALE_SDH_4_CALIBRATION_DECILE) <- c("TIME",
                                                 "DECILE",
                                                 "MEAN_PRED_RISK",
                                                 "AJ")
for (t in TIME) {
  TEMP <- as.data.frame(cbind(TIME = DATA_V_FEMALE$TIME,
                              EVENT = DATA_V_FEMALE$EVENT,
                              AGE_STD = DATA_V_FEMALE$AGE_STD,
                              AGE_STD_RCS5K_1 = DATA_V_FEMALE$AGE_STD_RCS5K_1,
                              AGE_STD_RCS5K_2 = DATA_V_FEMALE$AGE_STD_RCS5K_2,
                              AGE_STD_RCS5K_3 = DATA_V_FEMALE$AGE_STD_RCS5K_3,
                              AGE_STD_RCS5K_4 = DATA_V_FEMALE$AGE_STD_RCS5K_4,
                              SES_2014 = DATA_V_FEMALE$SES_2015,
                              SES_2014_RCS5K_1 = DATA_V_FEMALE$SES_2015_RCS5K_1,
                              SES_2014_RCS5K_2 = DATA_V_FEMALE$SES_2015_RCS5K_2,
                              SES_2014_RCS5K_3 = DATA_V_FEMALE$SES_2015_RCS5K_3,
                              SES_2014_RCS5K_4 = DATA_V_FEMALE$SES_2015_RCS5K_4,
                              PC_PM25_2014_STD = DATA_V_FEMALE$PC_PM25_2015_STD,
                              PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_1,
                              PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_2,
                              PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_3,
                              PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE$PC_PM25_2015_STD_RCS5K_4))
  
  TEMP$PRED_RISK <- predictRisk(FEMALE_SDH_4,
                                TEMP,
                                times = t,
                                cause = 1)
  
  TEMP$DECILE <- cut(TEMP$PRED_RISK,
                     breaks = quantile(TEMP$PRED_RISK, prob = seq(0, 1, 0.1)),
                     labels = c(1:10),
                     include.lowest = TRUE)
  
  DECILE_MEAN_PRED_RISK <- aggregate(TEMP$PRED_RISK,
                                     list(TEMP$DECILE),
                                     mean)
  colnames(DECILE_MEAN_PRED_RISK) <- c("DECILE",
                                       "MEAN_PRED_RISK")
  
  DECILE_AJ <- data.frame(DECILE = 1:10,
                          AJ = NA)
  for (i in 1:nrow(DECILE_AJ)) {
    TEMP_DECILE_AJ <- cuminc(ftime = subset(TEMP, DECILE == DECILE_AJ[i, "DECILE"])$TIME,
                             fstatus = subset(TEMP, DECILE == DECILE_AJ[i, "DECILE"])$EVENT,
                             cencode = 0)
    DECILE_AJ[i, "AJ"] <- timepoints(TEMP_DECILE_AJ, t)[[1]][[1]]
  }
  DECILE_MEAN_PRED_RISK_AJ <- merge(DECILE_MEAN_PRED_RISK,
                                    DECILE_AJ,
                                    by = "DECILE")
  DECILE_MEAN_PRED_RISK_AJ$DECILE <- as.numeric(DECILE_MEAN_PRED_RISK_AJ$DECILE)
  DECILE_MEAN_PRED_RISK_AJ <- DECILE_MEAN_PRED_RISK_AJ[order(DECILE_MEAN_PRED_RISK_AJ$DECILE), ]
  
  DECILE_MEAN_PRED_RISK_AJ$TIME <- t
  
  DECILE_MEAN_PRED_RISK_AJ <- DECILE_MEAN_PRED_RISK_AJ[, c("TIME",
                                                           "DECILE",
                                                           "MEAN_PRED_RISK",
                                                           "AJ")]
  
  V_FEMALE_SDH_4_CALIBRATION_DECILE <- rbind(V_FEMALE_SDH_4_CALIBRATION_DECILE,
                                             DECILE_MEAN_PRED_RISK_AJ)
}

max(V_FEMALE_SDH_4_CALIBRATION_DECILE$AJ - V_FEMALE_SDH_4_CALIBRATION_DECILE$MEAN_PRED_RISK)
max(V_FEMALE_SDH_4_CALIBRATION_DECILE$MEAN_PRED_RISK - V_FEMALE_SDH_4_CALIBRATION_DECILE$AJ)

saveRDS(...)

## FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_1Y_2Y_3Y_4Y ----

# FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_1Y

FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_1Y <-
  ggplot(subset(V_FEMALE_SDH_4_CALIBRATION_DECILE, TIME == 1), aes(x = MEAN_PRED_RISK,
                                                                   y = AJ)) +
  geom_abline() +
  geom_point(colour = "orange", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "orange") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.010),
                     breaks = seq(0.000, 0.010, 0.001),
                     labels = format(seq(0.000, 0.010, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.010),
                     breaks = seq(0.000, 0.010, 0.001),
                     labels = format(seq(0.000, 0.010, 0.001) * 100, digits = 1)) +
  
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

# FIG_V_FEMALE_SDH_8_CALIBRATION_DECILE_2Y

FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_2Y <-
  ggplot(subset(V_FEMALE_SDH_4_CALIBRATION_DECILE, TIME == 2), aes(x = MEAN_PRED_RISK,
                                                                 y = AJ)) +
  geom_abline() +
  geom_point(colour = "orange", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "orange") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.020),
                     breaks = seq(0.000, 0.020, 0.001),
                     labels = format(seq(0.000, 0.020, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.020),
                     breaks = seq(0.000, 0.020, 0.001),
                     labels = format(seq(0.000, 0.020, 0.001) * 100, digits = 1)) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

# FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_3Y

BREAKS <- seq(0.000, 0.030, 0.001) 
LABELS <- as.data.frame(BREAKS)
LABELS$DIVISION <- LABELS$BREAKS / 0.005
LABELS$LABELS <- ifelse((LABELS$DIVISION %% 1 < 1e-5),
                        format(BREAKS * 100, digits = 1),
                        "")

FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_3Y <-
  ggplot(subset(V_FEMALE_SDH_4_CALIBRATION_DECILE, TIME == 3), aes(x = MEAN_PRED_RISK,
                                                                 y = AJ)) +
  geom_abline() +
  geom_point(colour = "orange", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "orange") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.030),
                     breaks = seq(0.000, 0.030, 0.001),
                     labels = LABELS$LABELS) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.030),
                     breaks = seq(0.000, 0.030, 0.001),
                     labels = LABELS$LABELS) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

# FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_4Y

BREAKS <- seq(0.000, 0.040, 0.001) 
LABELS <- as.data.frame(BREAKS)
LABELS$DIVISION <- LABELS$BREAKS / 0.005
LABELS$LABELS <- ifelse((LABELS$DIVISION %% 1 < 1e-5),
                        format(BREAKS * 100, digits = 1),
                        "")

FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_4Y <-
  ggplot(subset(V_FEMALE_SDH_4_CALIBRATION_DECILE, TIME == 4), aes(x = MEAN_PRED_RISK,
                                                                 y = AJ)) +
  geom_abline() +
  geom_point(colour = "orange", 
             alpha = 0.5) +
  geom_smooth(se = FALSE, 
              span = 0.8, 
              colour = "orange") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.000, 0.040),
                     breaks = seq(0.000, 0.040, 0.001),
                     labels = LABELS$LABELS) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.000, 0.040),
                     breaks = seq(0.000, 0.040, 0.001),
                     labels = LABELS$LABELS) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank())

# FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_1Y_2Y_3Y_4Y 

FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_1Y_2Y_3Y_4Y <- plot_grid(FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_1Y,
                                                               FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_2Y,
                                                               FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_3Y,
                                                               FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_4Y, 
                                                               labels = c("A",
                                                                          "B",
                                                                          "C",
                                                                          "D")) + 
                                                               panel_border(color = "black")
FIG_V_FEMALE_SDH_4_CALIBRATION_DECILE_1Y_2Y_3Y_4Y

# Functions ----

## MALE_SDH_8_FUNCTION ----

# Baseline 

NEW_DATA <- data.frame(matrix(data = 0, 
                              nrow = 1,
                              ncol = ncol(DATA_D_MALE)))
colnames(NEW_DATA) <- colnames(DATA_D_MALE)

MALE_SDH_8_1Y_BASELINE <- predictRisk(MALE_SDH_8, newdata = NEW_DATA, times = 1)
1 - MALE_SDH_8_1Y_BASELINE

MALE_SDH_8_2Y_BASELINE <- predictRisk(MALE_SDH_8, newdata = NEW_DATA, times = 2)
1 - MALE_SDH_8_2Y_BASELINE

MALE_SDH_8_3Y_BASELINE <- predictRisk(MALE_SDH_8, newdata = NEW_DATA, times = 3)
1 - MALE_SDH_8_3Y_BASELINE

MALE_SDH_8_4Y_BASELINE <- predictRisk(MALE_SDH_8, newdata = NEW_DATA, times = 4)
1 - MALE_SDH_8_4Y_BASELINE

# Function

MALE_SDH_8_FUNCTION <- function(AGE,
                                WEALTH_IMP,
                                EDUCATION_LOW_IMP,
                                EDUCATION_INTERMEDIATE_IMP,
                                EDUCATION_HIGH_IMP,
                                PC_PM25,
                                TIME) {
  # Standardisation
  
  AGE_STD <- (AGE - 55.85) / 8.48 
  WEALTH_IMP_STD <- (WEALTH_IMP - 48.05) / 10.72
  EDUCATION_LOW_IMP_STD <- (EDUCATION_LOW_IMP - 28.17) / 7.52
  EDUCATION_INTERMEDIATE_IMP_STD <- (EDUCATION_INTERMEDIATE_IMP - 41.93) / 4.10
  EDUCATION_HIGH_IMP_STD <- (EDUCATION_HIGH_IMP - 29.90) / 9.36
  PC_PM25_STD <- (PC_PM25 - 60.07) / 26.01
  
  # SES
  
  SES <- 0.4941481 * WEALTH_IMP_STD +
        -0.5297561 * EDUCATION_LOW_IMP_STD +
        -0.3640974 * EDUCATION_INTERMEDIATE_IMP_STD +
         0.5853283 * EDUCATION_HIGH_IMP_STD
  
  # Non-linear terms
  
  DATA_D_MALE_AGE_STD_T1 <- -1.61372
  DATA_D_MALE_AGE_STD_T2 <- -0.7387971
  DATA_D_MALE_AGE_STD_T3 <- -0.01133325
  DATA_D_MALE_AGE_STD_T4 <- 0.7652835
  DATA_D_MALE_AGE_STD_T5 <- 1.571392
  
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T1) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T2) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T3) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T4) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3)
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- (AGE_STD - DATA_D_MALE_AGE_STD_T5) ** 3
  AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <- ifelse(AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3 <= 0,
                                                      0,
                                                      AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3)
  
  AGE_STD_TAU <- (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) ** 2
  
  AGE_STD_RCS5K_1 <- AGE_STD / AGE_STD_TAU
  AGE_STD_RCS5K_2 <- (AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T1_TRP3 - AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T1) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / AGE_STD_TAU
  AGE_STD_RCS5K_3 <- (AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T2_TRP3 - AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T2) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / AGE_STD_TAU
  AGE_STD_RCS5K_4 <- (AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T3_TRP3 - AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T4_TRP3 * (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4) + AGE_STD_MINUS_DATA_D_MALE_AGE_STD_T5_TRP3  * (DATA_D_MALE_AGE_STD_T4 - DATA_D_MALE_AGE_STD_T3) / (DATA_D_MALE_AGE_STD_T5 - DATA_D_MALE_AGE_STD_T4)) / AGE_STD_TAU
  
  DATA_D_MALE_SES_2014_T1 <- -2.592317
  DATA_D_MALE_SES_2014_T2 <- -1.117932
  DATA_D_MALE_SES_2014_T3 <- -0.001548897
  DATA_D_MALE_SES_2014_T4 <- 0.9845193
  DATA_D_MALE_SES_2014_T5 <- 2.576786
  
  SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- (SES - DATA_D_MALE_SES_2014_T1) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- (SES - DATA_D_MALE_SES_2014_T2) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- (SES - DATA_D_MALE_SES_2014_T3) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- (SES - DATA_D_MALE_SES_2014_T4) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3)
  SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- (SES - DATA_D_MALE_SES_2014_T5) ** 3
  SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <- ifelse(SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3 <= 0,
                                                   0,
                                                   SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3)
  
  SES_TAU <- (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) ** 2
  
  SES_RCS5K_1 <- SES / SES_TAU
  SES_RCS5K_2 <- (SES_MINUS_DATA_D_MALE_SES_2014_T1_TRP3 - SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T1) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / SES_TAU
  SES_RCS5K_3 <- (SES_MINUS_DATA_D_MALE_SES_2014_T2_TRP3 - SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T2) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / SES_TAU
  SES_RCS5K_4 <- (SES_MINUS_DATA_D_MALE_SES_2014_T3_TRP3 - SES_MINUS_DATA_D_MALE_SES_2014_T4_TRP3 * (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4) + SES_MINUS_DATA_D_MALE_SES_2014_T5_TRP3  * (DATA_D_MALE_SES_2014_T4 - DATA_D_MALE_SES_2014_T3) / (DATA_D_MALE_SES_2014_T5 - DATA_D_MALE_SES_2014_T4)) / SES_TAU
  
  DATA_D_MALE_PC_PM25_2014_STD_T1 <- -1.732751
  DATA_D_MALE_PC_PM25_2014_STD_T2 <- -0.6177976
  DATA_D_MALE_PC_PM25_2014_STD_T3 <- 0.07424248
  DATA_D_MALE_PC_PM25_2014_STD_T4 <- 0.7662826
  DATA_D_MALE_PC_PM25_2014_STD_T5 <- 1.419876
  
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T2) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T3) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T4) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3)
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- (PC_PM25_STD - DATA_D_MALE_PC_PM25_2014_STD_T5) ** 3
  PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <- ifelse(PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3 <= 0,
                                                                   0,
                                                                   PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3)
  
  PC_PM25_STD_TAU <- (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) ** 2
  
  PC_PM25_STD_RCS5K_1 <- PC_PM25_STD / PC_PM25_STD_TAU
  PC_PM25_STD_RCS5K_2 <- (PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T1_TRP3 - PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T1) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / PC_PM25_STD_TAU
  PC_PM25_STD_RCS5K_3 <- (PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T2_TRP3 - PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T2) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / PC_PM25_STD_TAU
  PC_PM25_STD_RCS5K_4 <- (PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T3_TRP3 - PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T4_TRP3 * (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4) + PC_PM25_STD_MINUS_DATA_D_MALE_PC_PM25_2014_STD_T5_TRP3  * (DATA_D_MALE_PC_PM25_2014_STD_T4 - DATA_D_MALE_PC_PM25_2014_STD_T3) / (DATA_D_MALE_PC_PM25_2014_STD_T5 - DATA_D_MALE_PC_PM25_2014_STD_T4)) / PC_PM25_STD_TAU
  
  # Linear predictor
  
  LP <- 1.4618 * AGE_STD +
       -3.4776 * AGE_STD_RCS5K_2 +
        10.1494 * AGE_STD_RCS5K_3 + 
       -10.5380 * AGE_STD_RCS5K_4 + 
       -0.1522 * SES +
        0.0818 * SES_RCS5K_2 +
        0.2130 * SES_RCS5K_3 +
       -0.9444 * SES_RCS5K_4 +
        0.1855 * PC_PM25_STD +
       -0.5144 * PC_PM25_STD_RCS5K_2 +
        2.7768 * PC_PM25_STD_RCS5K_3 +
       -5.2801 * PC_PM25_STD_RCS5K_4
  
  # Time 
  
  if (TIME == 1) {
    PRED_ASCVD_RISK <- 1 - 0.9760018 ** exp(LP)
  } else if (TIME == 2) {
    PRED_ASCVD_RISK <- 1 - 0.9581361 ** exp(LP)
  } else if (TIME == 3) {
    PRED_ASCVD_RISK <- 1 - 0.9394763 ** exp(LP)
  } else if (TIME == 4) {
    PRED_ASCVD_RISK <- 1 - 0.9180089 ** exp(LP) 
  } else {
    print("Please specify a time-point of 1 year, 2 years, 3 years, or 4 years.")
  }
  
  # Return
  
  return(PRED_ASCVD_RISK)
}

# Rounding error 

DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_1Y <- predictRisk(MALE_SDH_8, DATA_D_MALE, 1)
DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_1Y_FUNCTION <- MALE_SDH_8_FUNCTION(AGE = DATA_D_MALE$AGE,
                                                                     WEALTH_IMP = DATA_D_MALE$WEALTH_2014_IMP,
                                                                     EDUCATION_LOW_IMP = DATA_D_MALE$EDUCATION_LOW_2014_IMP,
                                                                     EDUCATION_INTERMEDIATE_IMP = DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                     EDUCATION_HIGH_IMP = DATA_D_MALE$EDUCATION_HIGH_2014_IMP,
                                                                     PC_PM25 = DATA_D_MALE$PC_PM25_2014,
                                                                     TIME = 1)
MALE_SDH_8_ASCVD_RISK_1Y_FUNCTION_ROUNDING_ERROR <- DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_1Y - DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_1Y_FUNCTION
summary(MALE_SDH_8_ASCVD_RISK_1Y_FUNCTION_ROUNDING_ERROR)
sd(MALE_SDH_8_ASCVD_RISK_1Y_FUNCTION_ROUNDING_ERROR)

DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_2Y <- predictRisk(MALE_SDH_8, DATA_D_MALE, 2)
DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_2Y_FUNCTION <- MALE_SDH_8_FUNCTION(AGE = DATA_D_MALE$AGE,
                                                                     WEALTH_IMP = DATA_D_MALE$WEALTH_2014_IMP,
                                                                     EDUCATION_LOW_IMP = DATA_D_MALE$EDUCATION_LOW_2014_IMP,
                                                                     EDUCATION_INTERMEDIATE_IMP = DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                     EDUCATION_HIGH_IMP = DATA_D_MALE$EDUCATION_HIGH_2014_IMP,
                                                                     PC_PM25 = DATA_D_MALE$PC_PM25_2014,
                                                                     TIME = 2)
MALE_SDH_8_ASCVD_RISK_2Y_FUNCTION_ROUNDING_ERROR <- DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_2Y - DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_2Y_FUNCTION
summary(MALE_SDH_8_ASCVD_RISK_2Y_FUNCTION_ROUNDING_ERROR)
sd(MALE_SDH_8_ASCVD_RISK_2Y_FUNCTION_ROUNDING_ERROR)

DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_3Y <- predictRisk(MALE_SDH_8, DATA_D_MALE, 3)
DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_3Y_FUNCTION <- MALE_SDH_8_FUNCTION(AGE = DATA_D_MALE$AGE,
                                                                     WEALTH_IMP = DATA_D_MALE$WEALTH_2014_IMP,
                                                                     EDUCATION_LOW_IMP = DATA_D_MALE$EDUCATION_LOW_2014_IMP,
                                                                     EDUCATION_INTERMEDIATE_IMP = DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                     EDUCATION_HIGH_IMP = DATA_D_MALE$EDUCATION_HIGH_2014_IMP,
                                                                     PC_PM25 = DATA_D_MALE$PC_PM25_2014,
                                                                     TIME = 3)
MALE_SDH_8_ASCVD_RISK_3Y_FUNCTION_ROUNDING_ERROR <- DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_3Y - DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_3Y_FUNCTION
summary(MALE_SDH_8_ASCVD_RISK_3Y_FUNCTION_ROUNDING_ERROR)
sd(MALE_SDH_8_ASCVD_RISK_3Y_FUNCTION_ROUNDING_ERROR)

DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_4Y <- predictRisk(MALE_SDH_8, DATA_D_MALE, 4)
DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_4Y_FUNCTION <- MALE_SDH_8_FUNCTION(AGE = DATA_D_MALE$AGE,
                                                                     WEALTH_IMP = DATA_D_MALE$WEALTH_2014_IMP,
                                                                     EDUCATION_LOW_IMP = DATA_D_MALE$EDUCATION_LOW_2014_IMP,
                                                                     EDUCATION_INTERMEDIATE_IMP = DATA_D_MALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                     EDUCATION_HIGH_IMP = DATA_D_MALE$EDUCATION_HIGH_2014_IMP,
                                                                     PC_PM25 = DATA_D_MALE$PC_PM25_2014,
                                                                     TIME = 4)
MALE_SDH_8_ASCVD_RISK_4Y_FUNCTION_ROUNDING_ERROR <- DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_4Y - DATA_D_MALE$MALE_SDH_8_ASCVD_RISK_4Y_FUNCTION
summary(MALE_SDH_8_ASCVD_RISK_4Y_FUNCTION_ROUNDING_ERROR)
sd(MALE_SDH_8_ASCVD_RISK_4Y_FUNCTION_ROUNDING_ERROR)

## FEMALE_SDH_4_FUNCTION ----

# Baseline 

NEW_DATA <- data.frame(matrix(data = 0, 
                              nrow = 1,
                              ncol = ncol(DATA_D_FEMALE)))
colnames(NEW_DATA) <- colnames(DATA_D_FEMALE)

FEMALE_SDH_4_1Y_BASELINE <- predictRisk(FEMALE_SDH_4, newdata = NEW_DATA, times = 1)
1 - FEMALE_SDH_4_1Y_BASELINE

FEMALE_SDH_4_2Y_BASELINE <- predictRisk(FEMALE_SDH_4, newdata = NEW_DATA, times = 2)
1 - FEMALE_SDH_4_2Y_BASELINE

FEMALE_SDH_4_3Y_BASELINE <- predictRisk(FEMALE_SDH_4, newdata = NEW_DATA, times = 3)
1 - FEMALE_SDH_4_3Y_BASELINE

FEMALE_SDH_4_4Y_BASELINE <- predictRisk(FEMALE_SDH_4, newdata = NEW_DATA, times = 4)
1 - FEMALE_SDH_4_4Y_BASELINE

# Function

FEMALE_SDH_4_FUNCTION <- function(AGE,
                                  WEALTH_IMP,
                                  EDUCATION_LOW_IMP,
                                  EDUCATION_INTERMEDIATE_IMP,
                                  EDUCATION_HIGH_IMP,
                                  PC_PM25,
                                  TIME) {
  # Standardisation
  
  AGE_STD <- (AGE - 55.84) / 8.47 
  WEALTH_IMP_STD <- (WEALTH_IMP - 48.07) / 10.78
  EDUCATION_LOW_IMP_STD <- (EDUCATION_LOW_IMP - 28.21) / 7.57
  EDUCATION_INTERMEDIATE_IMP_STD <- (EDUCATION_INTERMEDIATE_IMP - 41.86) / 4.09
  EDUCATION_HIGH_IMP_STD <- (EDUCATION_HIGH_IMP - 29.93) / 9.43
  PC_PM25_STD <- (PC_PM25 - 59.99) / 25.90
  
  # SES
  
  SES <- 0.4955965 * WEALTH_IMP_STD +
        -0.529561 * EDUCATION_LOW_IMP_STD +
        -0.364728 * EDUCATION_INTERMEDIATE_IMP_STD +
         0.5838858 * EDUCATION_HIGH_IMP_STD
  
  # Linear predictor  
  
  LP <- 0.6196 * AGE_STD +
       -0.1401 * SES +
        0.0509 * PC_PM25_STD
  
  # Time
  
  if (TIME == 1) {
    PRED_ASCVD_RISK <- 1 - 0.9970609 ** exp(LP)
  } else if (TIME == 2) {
    PRED_ASCVD_RISK <- 1 - 0.9938334 ** exp(LP)
  } else if (TIME == 3) {
    PRED_ASCVD_RISK <- 1 - 0.9908327 ** exp(LP)
  } else if (TIME == 4) {
    PRED_ASCVD_RISK <- 1 - 0.9874609 ** exp(LP) 
  } else {
    print("Please specify a time-point of 1 year, 2 years, 3 years, or 4 years.")
  }
  
  # Return
  
  return(PRED_ASCVD_RISK)
}

# Rounding error

DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_1Y <- predictRisk(FEMALE_SDH_4, DATA_D_FEMALE, 1)
DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_1Y_FUNCTION <- FEMALE_SDH_4_FUNCTION(AGE = DATA_D_FEMALE$AGE,
                                                                           WEALTH_IMP = DATA_D_FEMALE$WEALTH_2014_IMP,
                                                                           EDUCATION_LOW_IMP = DATA_D_FEMALE$EDUCATION_LOW_2014_IMP,
                                                                           EDUCATION_INTERMEDIATE_IMP = DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                           EDUCATION_HIGH_IMP = DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP,
                                                                           PC_PM25 = DATA_D_FEMALE$PC_PM25_2014,
                                                                           TIME = 1)
FEMALE_SDH_4_ASCVD_RISK_1Y_FUNCTION_ROUNDING_ERROR <- DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_1Y - DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_1Y_FUNCTION
summary(FEMALE_SDH_4_ASCVD_RISK_1Y_FUNCTION_ROUNDING_ERROR)
sd(FEMALE_SDH_4_ASCVD_RISK_1Y_FUNCTION_ROUNDING_ERROR)

DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_2Y <- predictRisk(FEMALE_SDH_4, DATA_D_FEMALE, 2)
DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_2Y_FUNCTION <- FEMALE_SDH_4_FUNCTION(AGE = DATA_D_FEMALE$AGE,
                                                                           WEALTH_IMP = DATA_D_FEMALE$WEALTH_2014_IMP,
                                                                           EDUCATION_LOW_IMP = DATA_D_FEMALE$EDUCATION_LOW_2014_IMP,
                                                                           EDUCATION_INTERMEDIATE_IMP = DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                           EDUCATION_HIGH_IMP = DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP,
                                                                           PC_PM25 = DATA_D_FEMALE$PC_PM25_2014,
                                                                           TIME = 2)
FEMALE_SDH_4_ASCVD_RISK_2Y_FUNCTION_ROUNDING_ERROR <- DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_2Y - DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_2Y_FUNCTION
summary(FEMALE_SDH_4_ASCVD_RISK_2Y_FUNCTION_ROUNDING_ERROR)
sd(FEMALE_SDH_4_ASCVD_RISK_2Y_FUNCTION_ROUNDING_ERROR)

DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_3Y <- predictRisk(FEMALE_SDH_4, DATA_D_FEMALE, 3)
DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_3Y_FUNCTION <- FEMALE_SDH_4_FUNCTION(AGE = DATA_D_FEMALE$AGE,
                                                                           WEALTH_IMP = DATA_D_FEMALE$WEALTH_2014_IMP,
                                                                           EDUCATION_LOW_IMP = DATA_D_FEMALE$EDUCATION_LOW_2014_IMP,
                                                                           EDUCATION_INTERMEDIATE_IMP = DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                           EDUCATION_HIGH_IMP = DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP,
                                                                           PC_PM25 = DATA_D_FEMALE$PC_PM25_2014,
                                                                           TIME = 3)
FEMALE_SDH_4_ASCVD_RISK_3Y_FUNCTION_ROUNDING_ERROR <- DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_3Y - DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_3Y_FUNCTION
summary(FEMALE_SDH_4_ASCVD_RISK_3Y_FUNCTION_ROUNDING_ERROR)
sd(FEMALE_SDH_4_ASCVD_RISK_3Y_FUNCTION_ROUNDING_ERROR)

DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_4Y <- predictRisk(FEMALE_SDH_4, DATA_D_FEMALE, 4)
DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_4Y_FUNCTION <- FEMALE_SDH_4_FUNCTION(AGE = DATA_D_FEMALE$AGE,
                                                                           WEALTH_IMP = DATA_D_FEMALE$WEALTH_2014_IMP,
                                                                           EDUCATION_LOW_IMP = DATA_D_FEMALE$EDUCATION_LOW_2014_IMP,
                                                                           EDUCATION_INTERMEDIATE_IMP = DATA_D_FEMALE$EDUCATION_INTERMEDIATE_2014_IMP,
                                                                           EDUCATION_HIGH_IMP = DATA_D_FEMALE$EDUCATION_HIGH_2014_IMP,
                                                                           PC_PM25 = DATA_D_FEMALE$PC_PM25_2014,
                                                                           TIME = 4)
FEMALE_SDH_4_ASCVD_RISK_4Y_FUNCTION_ROUNDING_ERROR <- DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_4Y - DATA_D_FEMALE$FEMALE_SDH_4_ASCVD_RISK_4Y_FUNCTION
summary(FEMALE_SDH_4_ASCVD_RISK_4Y_FUNCTION_ROUNDING_ERROR)
sd(FEMALE_SDH_4_ASCVD_RISK_4Y_FUNCTION_ROUNDING_ERROR)

# Sensitivity analysis ----

## Subsets ----

### DATA_V_MALE_CC ----

DATA_V_MALE_CC <- DATA_V_MALE[complete.cases(DATA_V_MALE), ]
nrow(DATA_V_MALE_CC)

### DATA_V_MALE_IMP ----

DATA_V_MALE_IMP <- DATA_V_MALE[!complete.cases(DATA_V_MALE), ]
nrow(DATA_V_MALE_IMP)

### DATA_V_FEMALE_CC ----

DATA_V_FEMALE_CC <- DATA_V_FEMALE[complete.cases(DATA_V_FEMALE), ]
nrow(DATA_V_FEMALE_CC)

### DATA_V_FEMALE_IMP ----

DATA_V_FEMALE_IMP <- DATA_V_FEMALE[!complete.cases(DATA_V_FEMALE), ]
nrow(DATA_V_FEMALE_IMP)

## Discrimination ----

### V_MALE_CC_SDH_8_AUC ----

V_MALE_CC_SDH_8_AUC <- Score(list(MALE_SDH_8),
                             formula = Hist(TIME, EVENT) ~ 1,
                             data = data.frame(TIME = DATA_V_MALE_CC$TIME,
                                               EVENT = DATA_V_MALE_CC$EVENT,
                                               AGE_STD = DATA_V_MALE_CC$AGE_STD,
                                               AGE_STD_RCS5K_1 = DATA_V_MALE_CC$AGE_STD_RCS5K_1,
                                               AGE_STD_RCS5K_2 = DATA_V_MALE_CC$AGE_STD_RCS5K_2,
                                               AGE_STD_RCS5K_3 = DATA_V_MALE_CC$AGE_STD_RCS5K_3,
                                               AGE_STD_RCS5K_4 = DATA_V_MALE_CC$AGE_STD_RCS5K_4,
                                               SES_2014 = DATA_V_MALE_CC$SES_2015,
                                               SES_2014_RCS5K_1 = DATA_V_MALE_CC$SES_2015_RCS5K_1,
                                               SES_2014_RCS5K_2 = DATA_V_MALE_CC$SES_2015_RCS5K_2,
                                               SES_2014_RCS5K_3 = DATA_V_MALE_CC$SES_2015_RCS5K_3,
                                               SES_2014_RCS5K_4 = DATA_V_MALE_CC$SES_2015_RCS5K_4,
                                               PC_PM25_2014_STD = DATA_V_MALE_CC$PC_PM25_2015_STD,
                                               PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_1,
                                               PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_2,
                                               PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_3,
                                               PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_4),
                             metrics = "AUC",
                             cause = 1,
                             times = seq(1, 4, 1/12),
                             se.fit = FALSE)

saveRDS(...)

### V_MALE_IMP_SDH_8_AUC ----

V_MALE_IMP_SDH_8_AUC <- Score(list(MALE_SDH_8),
                                  formula = Hist(TIME, EVENT) ~ 1,
                                  data = data.frame(TIME = DATA_V_MALE_IMP$TIME,
                                                    EVENT = DATA_V_MALE_IMP$EVENT,
                                                    AGE_STD = DATA_V_MALE_IMP$AGE_STD,
                                                    AGE_STD_RCS5K_1 = DATA_V_MALE_IMP$AGE_STD_RCS5K_1,
                                                    AGE_STD_RCS5K_2 = DATA_V_MALE_IMP$AGE_STD_RCS5K_2,
                                                    AGE_STD_RCS5K_3 = DATA_V_MALE_IMP$AGE_STD_RCS5K_3,
                                                    AGE_STD_RCS5K_4 = DATA_V_MALE_IMP$AGE_STD_RCS5K_4,
                                                    SES_2014 = DATA_V_MALE_IMP$SES_2015,
                                                    SES_2014_RCS5K_1 = DATA_V_MALE_IMP$SES_2015_RCS5K_1,
                                                    SES_2014_RCS5K_2 = DATA_V_MALE_IMP$SES_2015_RCS5K_2,
                                                    SES_2014_RCS5K_3 = DATA_V_MALE_IMP$SES_2015_RCS5K_3,
                                                    SES_2014_RCS5K_4 = DATA_V_MALE_IMP$SES_2015_RCS5K_4,
                                                    PC_PM25_2014_STD = DATA_V_MALE_IMP$PC_PM25_2015_STD,
                                                    PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_1,
                                                    PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_2,
                                                    PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_3,
                                                    PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_4),
                                  metrics = "AUC",
                                  cause = 1,
                                  times = seq(1, 4, 1/12),
                                  se.fit = FALSE)

saveRDS(...)

### V_FEMALE_CC_SDH_4_AUC ----

V_FEMALE_CC_SDH_4_AUC <- Score(list(FEMALE_SDH_4),
                               formula = Hist(TIME, EVENT) ~ 1,
                               data = data.frame(TIME = DATA_V_FEMALE_CC$TIME,
                                                 EVENT = DATA_V_FEMALE_CC$EVENT,
                                                 AGE_STD = DATA_V_FEMALE_CC$AGE_STD,
                                                 AGE_STD_RCS5K_1 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_1,
                                                 AGE_STD_RCS5K_2 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_2,
                                                 AGE_STD_RCS5K_3 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_3,
                                                 AGE_STD_RCS5K_4 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_4,
                                                 SES_2014 = DATA_V_FEMALE_CC$SES_2015,
                                                 SES_2014_RCS5K_1 = DATA_V_FEMALE_CC$SES_2015_RCS5K_1,
                                                 SES_2014_RCS5K_2 = DATA_V_FEMALE_CC$SES_2015_RCS5K_2,
                                                 SES_2014_RCS5K_3 = DATA_V_FEMALE_CC$SES_2015_RCS5K_3,
                                                 SES_2014_RCS5K_4 = DATA_V_FEMALE_CC$SES_2015_RCS5K_4,
                                                 PC_PM25_2014_STD = DATA_V_FEMALE_CC$PC_PM25_2015_STD,
                                                 PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_1,
                                                 PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_2,
                                                 PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_3,
                                                 PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_4),
                               metrics = "AUC",
                               cause = 1,
                               times = seq(1, 4, 1/12),
                               se.fit = FALSE)

saveRDS(...)

### V_FEMALE_IMP_SDH_4_AUC ----

V_FEMALE_IMP_SDH_4_AUC <- Score(list(FEMALE_SDH_4),
                                formula = Hist(TIME, EVENT) ~ 1,
                                data = data.frame(TIME = DATA_V_FEMALE_IMP$TIME,
                                                  EVENT = DATA_V_FEMALE_IMP$EVENT,
                                                  AGE_STD = DATA_V_FEMALE_IMP$AGE_STD,
                                                  AGE_STD_RCS5K_1 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_1,
                                                  AGE_STD_RCS5K_2 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_2,
                                                  AGE_STD_RCS5K_3 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_3,
                                                  AGE_STD_RCS5K_4 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_4,
                                                  SES_2014 = DATA_V_FEMALE_IMP$SES_2015,
                                                  SES_2014_RCS5K_1 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_1,
                                                  SES_2014_RCS5K_2 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_2,
                                                  SES_2014_RCS5K_3 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_3,
                                                  SES_2014_RCS5K_4 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_4,
                                                  PC_PM25_2014_STD = DATA_V_FEMALE_IMP$PC_PM25_2015_STD,
                                                  PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_1,
                                                  PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_2,
                                                  PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_3,
                                                  PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_4),
                                metrics = "AUC",
                                cause = 1,
                                times = seq(1, 4, 1/12),
                                se.fit = FALSE)

saveRDS(...)

### FIG_V_CC_IMP_AUC_WO_LEGEND & FIG_V_CC_IMP_AUC_LEGEND ----

# FIG_V_MALE_CC_IMP_SDH_8_AUC

DATA_FIG_V_MALE_CC_SDH_8_AUC <- as.data.frame(V_MALE_CC_SDH_8_AUC[["AUC"]][["score"]])[, c("times", 
                                                                                           "AUC")]
colnames(DATA_FIG_V_MALE_CC_SDH_8_AUC)[colnames(DATA_FIG_V_MALE_CC_SDH_8_AUC) == "times"] <- "TIME"
DATA_FIG_V_MALE_CC_SDH_8_AUC$CC_IMP <- "CC"

DATA_FIG_V_MALE_IMP_SDH_8_AUC <- as.data.frame(V_MALE_IMP_SDH_8_AUC[["AUC"]][["score"]])[, c("times", 
                                                                                             "AUC")]
colnames(DATA_FIG_V_MALE_IMP_SDH_8_AUC)[colnames(DATA_FIG_V_MALE_IMP_SDH_8_AUC) == "times"] <- "TIME"
DATA_FIG_V_MALE_IMP_SDH_8_AUC$CC_IMP <- "IMP"

DATA_FIG_V_MALE_CC_IMP_SDH_8_AUC <- rbind(DATA_FIG_V_MALE_CC_SDH_8_AUC,
                                          DATA_FIG_V_MALE_IMP_SDH_8_AUC)

FIG_V_MALE_CC_IMP_SDH_8_AUC <- 
  ggplot(DATA_FIG_V_MALE_CC_IMP_SDH_8_AUC, aes(x = TIME, y = AUC, linetype = as.factor(CC_IMP))) +
  geom_line(colour = "violet") +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.635, 0.716),
                     breaks = seq(0.640, 0.710, 0.010),
                     labels = format(seq(0.640, 0.710, 0.010), digits = 3)) +
  scale_linetype_manual(name = "Complete cases or cases with imputations",
                        values = c("CC" = 1,
                                   "IMP" = 2),
                        labels = c("CC" = "Complete cases",
                                   "IMP" = "Cases with imputations")) +
  theme_minimal() +
  theme(legend.position = "none")

# FIG_V_FEMALE_CC_IMP_SDH_4_AUC

DATA_FIG_V_FEMALE_CC_SDH_4_AUC <- as.data.frame(V_FEMALE_CC_SDH_4_AUC[["AUC"]][["score"]])[, c("times", 
                                                                                               "AUC")]
colnames(DATA_FIG_V_FEMALE_CC_SDH_4_AUC)[colnames(DATA_FIG_V_FEMALE_CC_SDH_4_AUC) == "times"] <- "TIME"
DATA_FIG_V_FEMALE_CC_SDH_4_AUC$CC_IMP <- "CC"

DATA_FIG_V_FEMALE_IMP_SDH_4_AUC <- as.data.frame(V_FEMALE_IMP_SDH_4_AUC[["AUC"]][["score"]])[, c("times", 
                                                                                                 "AUC")]
colnames(DATA_FIG_V_FEMALE_IMP_SDH_4_AUC)[colnames(DATA_FIG_V_FEMALE_IMP_SDH_4_AUC) == "times"] <- "TIME"
DATA_FIG_V_FEMALE_IMP_SDH_4_AUC$CC_IMP <- "IMP"

DATA_FIG_V_FEMALE_CC_IMP_SDH_4_AUC <- rbind(DATA_FIG_V_FEMALE_CC_SDH_4_AUC,
                                            DATA_FIG_V_FEMALE_IMP_SDH_4_AUC)

FIG_V_FEMALE_CC_IMP_SDH_4_AUC <- 
  ggplot(DATA_FIG_V_FEMALE_CC_IMP_SDH_4_AUC, aes(x = TIME, y = AUC, linetype = as.factor(CC_IMP))) +
  geom_line(colour = "orange") +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.600, 0.685),
                     breaks = seq(0.600, 0.680, 0.010),
                     labels = format(seq(0.600, 0.680, 0.010), digits = 3)) +
  scale_linetype_manual(name = "Complete cases or cases with imputations",
                        values = c("CC" = 1,
                                   "IMP" = 2),
                        labels = c("CC" = "Complete cases",
                                   "IMP" = "Cases with imputations")) +
  theme_minimal() +
  theme(legend.position = "none")

# FIG_V_CC_IMP_AUC_WO_LEGEND

FIG_V_CC_IMP_AUC_WO_LEGEND <- plot_grid(FIG_V_MALE_CC_IMP_SDH_8_AUC,
                                        FIG_V_FEMALE_CC_IMP_SDH_4_AUC,
                                        ncol = 1,
                                        labels = c("A",
                                                   "B")) +
                                        panel_border(color = "black")
FIG_V_CC_IMP_AUC_WO_LEGEND

# FIG_V_CC_IMP_AUC_LEGEND

FIG_V_CC_IMP_AUC_LEGEND <- 
  ggplot(DATA_FIG_V_MALE_CC_IMP_SDH_8_AUC, aes(x = TIME, y = AUC, linetype = as.factor(CC_IMP))) +
  geom_line() +
  scale_x_continuous(name = "Time in years",
                     limits = c(1, 4),
                     breaks = seq(1, 4, 1),
                     labels = seq(1, 4, 1)) +
  scale_y_continuous(name = "AUROC",
                     limits = c(0.635, 0.716),
                     breaks = seq(0.640, 0.710, 0.010),
                     labels = format(seq(0.640, 0.710, 0.010), digits = 3)) +
  scale_linetype_manual(name = "Complete cases or cases with imputations",
                        values = c("CC" = 1,
                                   "IMP" = 2),
                        labels = c("CC" = "Complete cases",
                                   "IMP" = "Cases with imputations")) +
  theme_minimal()

FIG_V_CC_IMP_AUC_LEGEND <- get_legend(FIG_V_CC_IMP_AUC_LEGEND)

FIG_V_CC_IMP_AUC_LEGEND <- plot_grid(FIG_V_CC_IMP_AUC_LEGEND,
                                     labels = "Legend") + 
                                      panel_border(color = "black")

FIG_V_CC_IMP_AUC_LEGEND <- plot_grid(FIG_V_CC_IMP_AUC_LEGEND)
FIG_V_CC_IMP_AUC_LEGEND

## Calibration ----

### V_MALE_CC_SDH_8_EO ----

TIME <- seq(1, 4, 1/12)
V_MALE_CC_SDH_8_EO <- as.data.frame(matrix(nrow = 0,
                                           ncol = 3))
colnames(V_MALE_CC_SDH_8_EO) <- c("TIME",
                                  "MEAN_PRED_RISK",
                                  "AJ")
for (t in TIME) {
  TEMP_DATA <- data.frame(TIME = DATA_V_MALE_CC$TIME,
                          EVENT = DATA_V_MALE_CC$EVENT,
                          AGE_STD = DATA_V_MALE_CC$AGE_STD,
                          AGE_STD_RCS5K_1 = DATA_V_MALE_CC$AGE_STD_RCS5K_1,
                          AGE_STD_RCS5K_2 = DATA_V_MALE_CC$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_V_MALE_CC$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_V_MALE_CC$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_V_MALE_CC$SES_2015,
                          SES_2014_RCS5K_1 = DATA_V_MALE_CC$SES_2015_RCS5K_1,
                          SES_2014_RCS5K_2 = DATA_V_MALE_CC$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_V_MALE_CC$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_V_MALE_CC$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_V_MALE_CC$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_1,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE_CC$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(MALE_SDH_8,                                           
                                     TEMP_DATA,
                                     times = t,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
  
  TEMP_V_MALE_CC_SDH_8_EO <- data.frame(TIME = t,
                                        MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                        AJ = TEMP_AJ_TIMEPOINT)
  
  V_MALE_CC_SDH_8_EO <- rbind(V_MALE_CC_SDH_8_EO,
                              TEMP_V_MALE_CC_SDH_8_EO)
}

saveRDS(...)

### V_MALE_IMP_SDH_8_EO ----

TIME <- seq(1, 4, 1/12)
V_MALE_IMP_SDH_8_EO <- as.data.frame(matrix(nrow = 0,
                                            ncol = 3))
colnames(V_MALE_IMP_SDH_8_EO) <- c("TIME",
                                   "MEAN_PRED_RISK",
                                   "AJ")
for (t in TIME) {
  TEMP_DATA <- data.frame(TIME = DATA_V_MALE_IMP$TIME,
                          EVENT = DATA_V_MALE_IMP$EVENT,
                          AGE_STD = DATA_V_MALE_IMP$AGE_STD,
                          AGE_STD_RCS5K_1 = DATA_V_MALE_IMP$AGE_STD_RCS5K_1,
                          AGE_STD_RCS5K_2 = DATA_V_MALE_IMP$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_V_MALE_IMP$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_V_MALE_IMP$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_V_MALE_IMP$SES_2015,
                          SES_2014_RCS5K_1 = DATA_V_MALE_IMP$SES_2015_RCS5K_1,
                          SES_2014_RCS5K_2 = DATA_V_MALE_IMP$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_V_MALE_IMP$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_V_MALE_IMP$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_V_MALE_IMP$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_1 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_1,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_V_MALE_IMP$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(MALE_SDH_8,                                           
                                     TEMP_DATA,
                                     times = t,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
  
  TEMP_V_MALE_IMP_SDH_8_EO <- data.frame(TIME = t,
                                         MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                         AJ = TEMP_AJ_TIMEPOINT)
  
  V_MALE_IMP_SDH_8_EO <- rbind(V_MALE_IMP_SDH_8_EO,
                               TEMP_V_MALE_IMP_SDH_8_EO)
}

saveRDS(...)

### V_FEMALE_CC_SDH_4_EO ----

TIME <- seq(1, 4, 1/12)
V_FEMALE_CC_SDH_4_EO <- as.data.frame(matrix(nrow = 0,
                                             ncol = 3))
colnames(V_FEMALE_CC_SDH_4_EO) <- c("TIME",
                                    "MEAN_PRED_RISK",
                                    "AJ")
for (t in TIME) {
  TEMP_DATA <- data.frame(TIME = DATA_V_FEMALE_CC$TIME,
                          EVENT = DATA_V_FEMALE_CC$EVENT,
                          AGE_STD = DATA_V_FEMALE_CC$AGE_STD,
                          AGE_STD_RCS5K_1 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_1,
                          AGE_STD_RCS5K_2 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_V_FEMALE_CC$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_V_FEMALE_CC$SES_2015,
                          SES_2014_RCS5K_1 = DATA_V_FEMALE_CC$SES_2015_RCS5K_1,
                          SES_2014_RCS5K_2 = DATA_V_FEMALE_CC$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_V_FEMALE_CC$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_V_FEMALE_CC$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_V_FEMALE_CC$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_1,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE_CC$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(FEMALE_SDH_4,                                           
                                     TEMP_DATA,
                                     times = t,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
  
  TEMP_V_FEMALE_CC_SDH_4_EO <- data.frame(TIME = t,
                                          MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                          AJ = TEMP_AJ_TIMEPOINT)
  
  V_FEMALE_CC_SDH_4_EO <- rbind(V_FEMALE_CC_SDH_4_EO,
                                TEMP_V_FEMALE_CC_SDH_4_EO)
}

saveRDS(...)

### V_FEMALE_IMP_SDH_4_EO ----

TIME <- seq(1, 4, 1/12)
V_FEMALE_IMP_SDH_4_EO <- as.data.frame(matrix(nrow = 0,
                                              ncol = 3))
colnames(V_FEMALE_IMP_SDH_4_EO) <- c("TIME",
                                     "MEAN_PRED_RISK",
                                     "AJ")
for (t in TIME) {
  TEMP_DATA <- data.frame(TIME = DATA_V_FEMALE_IMP$TIME,
                          EVENT = DATA_V_FEMALE_IMP$EVENT,
                          AGE_STD = DATA_V_FEMALE_IMP$AGE_STD,
                          AGE_STD_RCS5K_1 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_1,
                          AGE_STD_RCS5K_2 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_2,
                          AGE_STD_RCS5K_3 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_3,
                          AGE_STD_RCS5K_4 = DATA_V_FEMALE_IMP$AGE_STD_RCS5K_4,
                          SES_2014 = DATA_V_FEMALE_IMP$SES_2015,
                          SES_2014_RCS5K_1 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_1,
                          SES_2014_RCS5K_2 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_2,
                          SES_2014_RCS5K_3 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_3,
                          SES_2014_RCS5K_4 = DATA_V_FEMALE_IMP$SES_2015_RCS5K_4,
                          PC_PM25_2014_STD = DATA_V_FEMALE_IMP$PC_PM25_2015_STD,
                          PC_PM25_2014_STD_RCS5K_1 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_1,
                          PC_PM25_2014_STD_RCS5K_2 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_2,
                          PC_PM25_2014_STD_RCS5K_3 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_3,
                          PC_PM25_2014_STD_RCS5K_4 = DATA_V_FEMALE_IMP$PC_PM25_2015_STD_RCS5K_4)
  
  TEMP_DATA$PRED_RISK <- predictRisk(FEMALE_SDH_4,                                           
                                     TEMP_DATA,
                                     times = t,
                                     cause = 1)
  
  TEMP_MEAN_PRED_RISK <- mean(TEMP_DATA$PRED_RISK, na.rm = TRUE)
  
  TEMP_AJ <- cuminc(ftime = TEMP_DATA$TIME,
                    fstatus = TEMP_DATA$EVENT,
                    cencode = 0)
  TEMP_AJ_TIMEPOINT <- timepoints(TEMP_AJ, t)[[1]][[1]]
  
  TEMP_V_FEMALE_IMP_SDH_4_EO <- data.frame(TIME = t,
                                          MEAN_PRED_RISK = TEMP_MEAN_PRED_RISK,
                                          AJ = TEMP_AJ_TIMEPOINT)
  
  V_FEMALE_IMP_SDH_4_EO <- rbind(V_FEMALE_IMP_SDH_4_EO,
                                TEMP_V_FEMALE_IMP_SDH_4_EO)
}

saveRDS(...)

### FIG_V_CC_IMP_EO_WO_LEGEND & FIG_V_CC_IMP_EO_LEGEND ----

# FIG_V_MALE_CC_IMP_SDH_8_EO 

V_MALE_CC_SDH_8_EO$CC_IMP <- "CC"
V_MALE_IMP_SDH_8_EO$CC_IMP <- "IMP"
DATA_FIG_V_MALE_CC_IMP_SDH_8_EO <- rbind(V_MALE_CC_SDH_8_EO,
                                         V_MALE_IMP_SDH_8_EO)

FIG_V_MALE_CC_IMP_SDH_8_EO <- 
  ggplot() +
  geom_line(data = DATA_FIG_V_MALE_CC_IMP_SDH_8_EO, aes(x = MEAN_PRED_RISK,
                                                        y = AJ,
                                                        linetype = as.factor(CC_IMP)),
            colour = "violet") +
  geom_abline(intercept = 0, slope = 1) +
  geom_point(data = subset(DATA_FIG_V_MALE_CC_IMP_SDH_8_EO, TIME == 1), aes(x = MEAN_PRED_RISK, 
                                                                            y = AJ),
             shape = 23,
             size = 2,
             fill = "violet") +
  geom_point(data = subset(DATA_FIG_V_MALE_CC_IMP_SDH_8_EO, TIME == 2), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ),
             shape = 23,
             size = 2,
             fill = "violet") +
  geom_point(data = subset(DATA_FIG_V_MALE_CC_IMP_SDH_8_EO, TIME == 3), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ),
             shape = 23,
             size = 2,
             fill = "violet") +
  geom_point(data = subset(DATA_FIG_V_MALE_CC_IMP_SDH_8_EO, TIME == 4), aes(x = MEAN_PRED_RISK, 
                                                          y = AJ),
             shape = 23,
             size = 2,
             fill = "violet") +
  annotate("text",
           x = 0.0070,
           y = 0.0080,
           label = "1 year") +
  annotate("text",
           x = 0.0090,
           y = 0.0085,
           label = "1 year") +
  annotate("text",
           x = 0.0130,
           y = 0.0175,
           label = "2 years") +
  annotate("text",
           x = 0.0155,
           y = 0.0165,
           label = "2 years") +
  annotate("text",
           x = 0.0195,
           y = 0.0235,
           label = "3 years") +
  annotate("text",
           x = 0.0230,
           y = 0.0250,
           label = "3 years") +
  annotate("text",
           x = 0.0265,
           y = 0.0325,
           label = "4 years") +
  annotate("text",
           x = 0.0310,
           y = 0.0325,
           label = "4 years") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.005, 0.033),
                     breaks = seq(0.005, 0.033, 0.001),
                     labels = format(seq(0.005, 0.033, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.005, 0.033),
                     breaks = seq(0.005, 0.033, 0.001),
                     labels = format(seq(0.005, 0.033, 0.001) * 100, digits = 1)) +
  scale_linetype_manual(name = "Complete cases or cases with imputations",
                        values = c("CC" = 1,
                                   "IMP" = 2),
                        labels = c("CC" = "Complete cases",
                                   "IMP" = "Cases with imputations")) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "none")

# FIG_V_FEMALE_CC_IMP_SDH_4_EO 

V_FEMALE_CC_SDH_4_EO$CC_IMP <- "CC"
V_FEMALE_IMP_SDH_4_EO$CC_IMP <- "IMP"
DATA_FIG_V_FEMALE_CC_IMP_SDH_4_EO <- rbind(V_FEMALE_CC_SDH_4_EO,
                                           V_FEMALE_IMP_SDH_4_EO)

FIG_V_FEMALE_CC_IMP_SDH_4_EO <- 
  ggplot() +
  geom_line(data = DATA_FIG_V_FEMALE_CC_IMP_SDH_4_EO, aes(x = MEAN_PRED_RISK, 
                                                          y = AJ,
                                                          linetype = as.factor(CC_IMP)),
            colour = "orange") +
  geom_abline(intercept = 0, slope = 1) +
  geom_point(data = subset(DATA_FIG_V_FEMALE_CC_IMP_SDH_4_EO, TIME == 1), aes(x = MEAN_PRED_RISK, 
                                                                              y = AJ),
             shape = 23,
             size = 2,
             fill = "orange") +
  geom_point(data = subset(DATA_FIG_V_FEMALE_CC_IMP_SDH_4_EO, TIME == 2), aes(x = MEAN_PRED_RISK, 
                                                                              y = AJ),
             shape = 23,
             size = 2,
             fill = "orange") +
  geom_point(data = subset(DATA_FIG_V_FEMALE_CC_IMP_SDH_4_EO, TIME == 3), aes(x = MEAN_PRED_RISK, 
                                                                              y = AJ),
             shape = 23,
             size = 2,
             fill = "orange") +
  geom_point(data = subset(DATA_FIG_V_FEMALE_CC_IMP_SDH_4_EO, TIME == 4), aes(x = MEAN_PRED_RISK, 
                                                                              y = AJ),
             shape = 23,
             size = 2,
             fill = "orange") +
  annotate("text",
           x = 0.0037,
           y = 0.0040,
           label = "1 year") +
  annotate("text",
           x = 0.0030,
           y = 0.0025,
           label = "1 year") +
  annotate("text",
           x = 0.0075,
           y = 0.0075,
           label = "2 years") +
  annotate("text",
           x = 0.0060,
           y = 0.0025,
           label = "2 years") +
  annotate("text",
           x = 0.0110,
           y = 0.0110,
           label = "3 years") +
  annotate("text",
           x = 0.0091,
           y = 0.0065,
           label = "3 years") +
  annotate("text",
           x = 0.0140,
           y = 0.0150,
           label = "4 years") +
  annotate("text",
           x = 0.0125,
           y = 0.0117,
           label = "4 years") +
  scale_x_continuous(name = "Predicted ASCVD risk (%)",
                     limits = c(0.002, 0.015),
                     breaks = seq(0.002, 0.015, 0.001),
                     labels = format(seq(0.002, 0.015, 0.001) * 100, digits = 1)) +
  scale_y_continuous(name = "Observed ASCVD risk (%)",
                     limits = c(0.002, 0.015),
                     breaks = seq(0.002, 0.015, 0.001),
                     labels = format(seq(0.002, 0.015, 0.001) * 100, digits = 1)) +
  scale_linetype_manual(name = "Complete cases or cases with imputations",
                        values = c("CC" = 1,
                                   "IMP" = 2),
                        labels = c("CC" = "Complete cases",
                                   "IMP" = "Cases with imputations")) +
  theme_minimal() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "none")

# FIG_V_CC_IMP_EO_WO_LEGEND 

FIG_V_CC_IMP_EO_WO_LEGEND <- plot_grid(FIG_V_MALE_CC_IMP_SDH_8_EO, 
                                       FIG_V_FEMALE_CC_IMP_SDH_4_EO,
                                       labels = c("A",
                                                  "B"),
                                       ncol = 1) + 
                                       panel_border(color = "black")
FIG_V_CC_IMP_EO_WO_LEGEND

# FIG_V_CC_IMP_EO_LEGEND 

FIG_V_CC_IMP_EO_LEGEND <- FIG_V_CC_IMP_AUC_LEGEND

# Session info ----

sessionInfo()
